<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ian McCarthy, Emory University and NBER">
<meta name="description" content="PhD Course on the Economics of Healthcare">

<title>A Quick Primer on Diff-in-Diff – Health Economics II</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="A Quick Primer on Diff-in-Diff – Health Economics II">
<meta property="og:image" content="https://econ771s24.classes.ianmccarthyecon.com//files/econ771-logo.png">
<meta property="og:site_name" content="Health Economics II">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="1024">
<meta property="og:image:width" content="512">
<meta name="twitter:title" content="A Quick Primer on Diff-in-Diff – Health Economics II">
<meta name="twitter:image" content="https://econ771s24.classes.ianmccarthyecon.com//files/econ771-logo.png">
<meta name="twitter:creator" content="@ianhealthecon">
<meta name="twitter:site" content="@ianhealthecon">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1024">
<meta name="twitter:image-width" content="512">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Health Economics II</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule/index.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignments/index.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources/index.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/imccart/econ771-spring2024"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#outline" id="toc-outline" class="nav-link active" data-scroll-target="#outline">Outline</a></li>
  <li><a href="#panel-data-and-fixed-effects" id="toc-panel-data-and-fixed-effects" class="nav-link" data-scroll-target="#panel-data-and-fixed-effects">Panel Data and Fixed Effects</a>
  <ul class="collapse">
  <li><a href="#basics-of-panel-data" id="toc-basics-of-panel-data" class="nav-link" data-scroll-target="#basics-of-panel-data">Basics of panel data</a></li>
  <li><a href="#benefits-of-panel-data" id="toc-benefits-of-panel-data" class="nav-link" data-scroll-target="#benefits-of-panel-data">Benefits of Panel Data</a></li>
  <li><a href="#some-textbook-settings" id="toc-some-textbook-settings" class="nav-link" data-scroll-target="#some-textbook-settings">Some textbook settings</a></li>
  <li><a href="#fixed-effects-and-regression" id="toc-fixed-effects-and-regression" class="nav-link" data-scroll-target="#fixed-effects-and-regression">Fixed effects and regression</a></li>
  <li><a href="#within-estimator" id="toc-within-estimator" class="nav-link" data-scroll-target="#within-estimator">Within Estimator</a></li>
  <li><a href="#first-difference" id="toc-first-difference" class="nav-link" data-scroll-target="#first-difference">First-difference</a></li>
  <li><a href="#keep-in-mind" id="toc-keep-in-mind" class="nav-link" data-scroll-target="#keep-in-mind">Keep in mind…</a></li>
  <li><a href="#within-estimator-default-in-practice" id="toc-within-estimator-default-in-practice" class="nav-link" data-scroll-target="#within-estimator-default-in-practice">Within Estimator (Default) in practice</a></li>
  <li><a href="#within-estimator-default-in-practice-1" id="toc-within-estimator-default-in-practice-1" class="nav-link" data-scroll-target="#within-estimator-default-in-practice-1">Within Estimator (Default) in practice</a></li>
  <li><a href="#within-estimator-manually-demean-in-practice" id="toc-within-estimator-manually-demean-in-practice" class="nav-link" data-scroll-target="#within-estimator-manually-demean-in-practice">Within Estimator (Manually Demean) in practice</a></li>
  <li><a href="#within-estimator-manually-demean-in-practice-1" id="toc-within-estimator-manually-demean-in-practice-1" class="nav-link" data-scroll-target="#within-estimator-manually-demean-in-practice-1">Within Estimator (Manually Demean) in practice</a></li>
  <li><a href="#first-differencing-default-in-practice" id="toc-first-differencing-default-in-practice" class="nav-link" data-scroll-target="#first-differencing-default-in-practice">First differencing (default) in practice</a></li>
  <li><a href="#first-differencing-manual-in-practice" id="toc-first-differencing-manual-in-practice" class="nav-link" data-scroll-target="#first-differencing-manual-in-practice">First differencing (manual) in practice</a></li>
  <li><a href="#first-differencing-manual-in-practice-1" id="toc-first-differencing-manual-in-practice-1" class="nav-link" data-scroll-target="#first-differencing-manual-in-practice-1">First differencing (manual) in practice</a></li>
  <li><a href="#first-differencing-manual-in-practice-2" id="toc-first-differencing-manual-in-practice-2" class="nav-link" data-scroll-target="#first-differencing-manual-in-practice-2">First differencing (manual) in practice</a></li>
  <li><a href="#fe-and-fd-with-same-time-period" id="toc-fe-and-fd-with-same-time-period" class="nav-link" data-scroll-target="#fe-and-fd-with-same-time-period">FE and FD with same time period</a></li>
  </ul></li>
  <li><a href="#difference-in-differences-yesterday" id="toc-difference-in-differences-yesterday" class="nav-link" data-scroll-target="#difference-in-differences-yesterday">Difference-in-Differences Yesterday</a>
  <ul class="collapse">
  <li><a href="#basic-2x2-setup" id="toc-basic-2x2-setup" class="nav-link" data-scroll-target="#basic-2x2-setup">Basic 2x2 Setup</a></li>
  <li><a href="#basic-2x2-setup-1" id="toc-basic-2x2-setup-1" class="nav-link" data-scroll-target="#basic-2x2-setup-1">Basic 2x2 Setup</a></li>
  <li><a href="#basic-2x2-setup-2" id="toc-basic-2x2-setup-2" class="nav-link" data-scroll-target="#basic-2x2-setup-2">Basic 2x2 Setup</a></li>
  <li><a href="#basic-2x2-setup-3" id="toc-basic-2x2-setup-3" class="nav-link" data-scroll-target="#basic-2x2-setup-3">Basic 2x2 Setup</a></li>
  <li><a href="#graphically" id="toc-graphically" class="nav-link" data-scroll-target="#graphically">Graphically</a></li>
  <li><a href="#animations" id="toc-animations" class="nav-link" data-scroll-target="#animations">Animations</a></li>
  <li><a href="#ate-estimates-with-dd" id="toc-ate-estimates-with-dd" class="nav-link" data-scroll-target="#ate-estimates-with-dd">ATE Estimates with DD</a></li>
  <li><a href="#estimation-sample-means" id="toc-estimation-sample-means" class="nav-link" data-scroll-target="#estimation-sample-means">Estimation: Sample Means</a></li>
  <li><a href="#estimation-regression" id="toc-estimation-regression" class="nav-link" data-scroll-target="#estimation-regression">Estimation: Regression</a></li>
  <li><a href="#simulated-data" id="toc-simulated-data" class="nav-link" data-scroll-target="#simulated-data">Simulated data</a></li>
  <li><a href="#mean-differences" id="toc-mean-differences" class="nav-link" data-scroll-target="#mean-differences">Mean differences</a></li>
  <li><a href="#mean-differences-1" id="toc-mean-differences-1" class="nav-link" data-scroll-target="#mean-differences-1">Mean differences</a></li>
  <li><a href="#regression-estimator" id="toc-regression-estimator" class="nav-link" data-scroll-target="#regression-estimator">Regression estimator</a></li>
  <li><a href="#application" id="toc-application" class="nav-link" data-scroll-target="#application">Application</a></li>
  <li><a href="#step-1-look-at-the-data" id="toc-step-1-look-at-the-data" class="nav-link" data-scroll-target="#step-1-look-at-the-data">Step 1: Look at the data</a></li>
  <li><a href="#step-1-look-at-the-data-1" id="toc-step-1-look-at-the-data-1" class="nav-link" data-scroll-target="#step-1-look-at-the-data-1">Step 1: Look at the data</a></li>
  <li><a href="#step-2-estimate-effects" id="toc-step-2-estimate-effects" class="nav-link" data-scroll-target="#step-2-estimate-effects">Step 2: Estimate effects</a></li>
  <li><a href="#step-2-estimate-effects-1" id="toc-step-2-estimate-effects-1" class="nav-link" data-scroll-target="#step-2-estimate-effects-1">Step 2: Estimate effects</a></li>
  <li><a href="#final-dd-thoughts" id="toc-final-dd-thoughts" class="nav-link" data-scroll-target="#final-dd-thoughts">Final DD thoughts</a></li>
  <li><a href="#dd-and-twfe" id="toc-dd-and-twfe" class="nav-link" data-scroll-target="#dd-and-twfe">DD and TWFE?</a></li>
  <li><a href="#what-is-twfe" id="toc-what-is-twfe" class="nav-link" data-scroll-target="#what-is-twfe">What is TWFE?</a></li>
  <li><a href="#twfe-in-practice" id="toc-twfe-in-practice" class="nav-link" data-scroll-target="#twfe-in-practice">TWFE in Practice</a></li>
  <li><a href="#twfe-in-practice-1" id="toc-twfe-in-practice-1" class="nav-link" data-scroll-target="#twfe-in-practice-1">TWFE in Practice</a></li>
  <li><a href="#event-study" id="toc-event-study" class="nav-link" data-scroll-target="#event-study">Event study</a></li>
  <li><a href="#why-show-an-event-study" id="toc-why-show-an-event-study" class="nav-link" data-scroll-target="#why-show-an-event-study">Why show an event study?</a></li>
  <li><a href="#how-to-do-an-event-study" id="toc-how-to-do-an-event-study" class="nav-link" data-scroll-target="#how-to-do-an-event-study">How to do an event study?</a></li>
  <li><a href="#how-to-do-an-event-study-1" id="toc-how-to-do-an-event-study-1" class="nav-link" data-scroll-target="#how-to-do-an-event-study-1">How to do an event study?</a></li>
  <li><a href="#things-to-address" id="toc-things-to-address" class="nav-link" data-scroll-target="#things-to-address">Things to address</a></li>
  <li><a href="#event-time-vs-calendar-time" id="toc-event-time-vs-calendar-time" class="nav-link" data-scroll-target="#event-time-vs-calendar-time">Event time vs calendar time</a></li>
  <li><a href="#define-baseline-period" id="toc-define-baseline-period" class="nav-link" data-scroll-target="#define-baseline-period">Define baseline period</a></li>
  <li><a href="#number-of-pre-treatment-and-post-treatment-periods" id="toc-number-of-pre-treatment-and-post-treatment-periods" class="nav-link" data-scroll-target="#number-of-pre-treatment-and-post-treatment-periods">Number of pre-treatment and post-treatment periods</a></li>
  <li><a href="#commont-treatment-timing" id="toc-commont-treatment-timing" class="nav-link" data-scroll-target="#commont-treatment-timing">Commont treatment timing</a></li>
  <li><a href="#common-treatment-timing" id="toc-common-treatment-timing" class="nav-link" data-scroll-target="#common-treatment-timing">Common treatment timing</a></li>
  <li><a href="#differential-treatment-timing" id="toc-differential-treatment-timing" class="nav-link" data-scroll-target="#differential-treatment-timing">Differential treatment timing</a></li>
  <li><a href="#differential-treatment-timing-1" id="toc-differential-treatment-timing-1" class="nav-link" data-scroll-target="#differential-treatment-timing-1">Differential treatment timing</a></li>
  <li><a href="#differential-treatment-timing-2" id="toc-differential-treatment-timing-2" class="nav-link" data-scroll-target="#differential-treatment-timing-2">Differential treatment timing</a></li>
  <li><a href="#problems-with-twfe" id="toc-problems-with-twfe" class="nav-link" data-scroll-target="#problems-with-twfe">Problems with TWFE</a></li>
  <li><a href="#intuition" id="toc-intuition" class="nav-link" data-scroll-target="#intuition">Intuition</a></li>
  <li><a href="#does-it-really-matter" id="toc-does-it-really-matter" class="nav-link" data-scroll-target="#does-it-really-matter">Does it really matter?</a></li>
  </ul></li>
  <li><a href="#diference-in-differences-today" id="toc-diference-in-differences-today" class="nav-link" data-scroll-target="#diference-in-differences-today">Diference-in-Differences Today</a>
  <ul class="collapse">
  <li><a href="#solution" id="toc-solution" class="nav-link" data-scroll-target="#solution">Solution</a></li>
  <li><a href="#changing-mindset-for-estimation" id="toc-changing-mindset-for-estimation" class="nav-link" data-scroll-target="#changing-mindset-for-estimation">Changing mindset for estimation</a></li>
  <li><a href="#incorporating-covariates" id="toc-incorporating-covariates" class="nav-link" data-scroll-target="#incorporating-covariates">Incorporating covariates</a></li>
  <li><a href="#outcome-regression-heckman-et-al-1997" id="toc-outcome-regression-heckman-et-al-1997" class="nav-link" data-scroll-target="#outcome-regression-heckman-et-al-1997">Outcome regression (Heckman et al 1997)</a></li>
  <li><a href="#ipw-abadie-2005" id="toc-ipw-abadie-2005" class="nav-link" data-scroll-target="#ipw-abadie-2005">IPW (Abadie, 2005)</a></li>
  <li><a href="#dr-santanna-and-zhou" id="toc-dr-santanna-and-zhou" class="nav-link" data-scroll-target="#dr-santanna-and-zhou">DR (Sant’Anna and Zhou)</a></li>
  <li><a href="#the-new-dd" id="toc-the-new-dd" class="nav-link" data-scroll-target="#the-new-dd">The New DD</a></li>
  <li><a href="#gt1-callaway-and-santanna" id="toc-gt1-callaway-and-santanna" class="nav-link" data-scroll-target="#gt1-callaway-and-santanna">GT1: Callaway and Sant’Anna</a></li>
  <li><a href="#gt1-cs-estimator-more-formally" id="toc-gt1-cs-estimator-more-formally" class="nav-link" data-scroll-target="#gt1-cs-estimator-more-formally">GT1: CS Estimator (More Formally)</a></li>
  <li><a href="#gt1-cs-estimator-more-formally-1" id="toc-gt1-cs-estimator-more-formally-1" class="nav-link" data-scroll-target="#gt1-cs-estimator-more-formally-1">GT1: CS Estimator (More Formally)</a></li>
  <li><a href="#gt1-cs-estimator-more-formally-2" id="toc-gt1-cs-estimator-more-formally-2" class="nav-link" data-scroll-target="#gt1-cs-estimator-more-formally-2">GT1: CS Estimator (More Formally)</a></li>
  <li><a href="#gt1-cs-estimator-more-formally-3" id="toc-gt1-cs-estimator-more-formally-3" class="nav-link" data-scroll-target="#gt1-cs-estimator-more-formally-3">GT1: CS Estimator (More Formally)</a></li>
  <li><a href="#gt1-cs-estimator-in-practice" id="toc-gt1-cs-estimator-in-practice" class="nav-link" data-scroll-target="#gt1-cs-estimator-in-practice">GT1: CS Estimator (in Practice)</a></li>
  <li><a href="#cs-in-practice" id="toc-cs-in-practice" class="nav-link" data-scroll-target="#cs-in-practice">CS in Practice</a></li>
  <li><a href="#gt2-sun-and-abraham" id="toc-gt2-sun-and-abraham" class="nav-link" data-scroll-target="#gt2-sun-and-abraham">GT2: Sun and Abraham</a></li>
  <li><a href="#gt2-sun-and-abraham-1" id="toc-gt2-sun-and-abraham-1" class="nav-link" data-scroll-target="#gt2-sun-and-abraham-1">GT2: Sun and Abraham</a></li>
  <li><a href="#gt2-sun-and-abraham-2" id="toc-gt2-sun-and-abraham-2" class="nav-link" data-scroll-target="#gt2-sun-and-abraham-2">GT2: Sun and Abraham</a></li>
  <li><a href="#gt2-sun-and-abraham-in-practice" id="toc-gt2-sun-and-abraham-in-practice" class="nav-link" data-scroll-target="#gt2-sun-and-abraham-in-practice">GT2: Sun and Abraham in Practice</a></li>
  <li><a href="#sun-and-abraham-in-practice" id="toc-sun-and-abraham-in-practice" class="nav-link" data-scroll-target="#sun-and-abraham-in-practice">Sun and Abraham in Practice</a></li>
  <li><a href="#gt3-de-chaisemartin-and-dhaultfoeuille-ch" id="toc-gt3-de-chaisemartin-and-dhaultfoeuille-ch" class="nav-link" data-scroll-target="#gt3-de-chaisemartin-and-dhaultfoeuille-ch">GT3: de Chaisemartin and D’Haultfoeuille (CH)</a></li>
  <li><a href="#gt3-ch-approach" id="toc-gt3-ch-approach" class="nav-link" data-scroll-target="#gt3-ch-approach">GT3: CH Approach</a></li>
  <li><a href="#ch-in-practice" id="toc-ch-in-practice" class="nav-link" data-scroll-target="#ch-in-practice">CH in Practice</a></li>
  <li><a href="#ch-in-practice-1" id="toc-ch-in-practice-1" class="nav-link" data-scroll-target="#ch-in-practice-1">CH in Practice</a></li>
  <li><a href="#ch-in-practice-2" id="toc-ch-in-practice-2" class="nav-link" data-scroll-target="#ch-in-practice-2">CH in practice</a></li>
  <li><a href="#cengiz-et-al.-2019-stacked-regression" id="toc-cengiz-et-al.-2019-stacked-regression" class="nav-link" data-scroll-target="#cengiz-et-al.-2019-stacked-regression">Cengiz et al.&nbsp;(2019): Stacked regression</a></li>
  <li><a href="#cengiz-et-al.-2019" id="toc-cengiz-et-al.-2019" class="nav-link" data-scroll-target="#cengiz-et-al.-2019">Cengiz et al.&nbsp;(2019)</a></li>
  <li><a href="#cengiz-et-al.-2019-1" id="toc-cengiz-et-al.-2019-1" class="nav-link" data-scroll-target="#cengiz-et-al.-2019-1">Cengiz et al.&nbsp;(2019)</a></li>
  <li><a href="#quick-comparison" id="toc-quick-comparison" class="nav-link" data-scroll-target="#quick-comparison">Quick comparison</a></li>
  <li><a href="#imputation-estimators" id="toc-imputation-estimators" class="nav-link" data-scroll-target="#imputation-estimators">Imputation estimators</a></li>
  <li><a href="#gardner-2021" id="toc-gardner-2021" class="nav-link" data-scroll-target="#gardner-2021">Gardner (2021)</a></li>
  <li><a href="#gardner-2021-in-practice" id="toc-gardner-2021-in-practice" class="nav-link" data-scroll-target="#gardner-2021-in-practice">Gardner (2021) in Practice</a></li>
  <li><a href="#borusyak-et-al.-2021" id="toc-borusyak-et-al.-2021" class="nav-link" data-scroll-target="#borusyak-et-al.-2021">Borusyak et al.&nbsp;(2021)</a></li>
  <li><a href="#borusyak-et-al.-in-practice" id="toc-borusyak-et-al.-in-practice" class="nav-link" data-scroll-target="#borusyak-et-al.-in-practice">Borusyak et al.&nbsp;in practice</a></li>
  <li><a href="#borusyak-et-al.-in-practice-1" id="toc-borusyak-et-al.-in-practice-1" class="nav-link" data-scroll-target="#borusyak-et-al.-in-practice-1">Borusyak et al.&nbsp;in practice</a></li>
  </ul></li>
  <li><a href="#discussion" id="toc-discussion" class="nav-link" data-scroll-target="#discussion">Discussion</a>
  <ul class="collapse">
  <li><a href="#seems-like-lots-of-solutions" id="toc-seems-like-lots-of-solutions" class="nav-link" data-scroll-target="#seems-like-lots-of-solutions">Seems like lots of “solutions”</a></li>
  <li><a href="#comparison" id="toc-comparison" class="nav-link" data-scroll-target="#comparison">Comparison</a></li>
  <li><a href="#comparison-1" id="toc-comparison-1" class="nav-link" data-scroll-target="#comparison-1">Comparison</a></li>
  <li><a href="#general-advice" id="toc-general-advice" class="nav-link" data-scroll-target="#general-advice">General advice</a></li>
  <li><a href="#other-topics" id="toc-other-topics" class="nav-link" data-scroll-target="#other-topics">Other topics</a></li>
  </ul></li>
  <li><a href="#some-points-on-the-dd-empirical-exercise" id="toc-some-points-on-the-dd-empirical-exercise" class="nav-link" data-scroll-target="#some-points-on-the-dd-empirical-exercise">Some points on the DD empirical exercise</a>
  <ul class="collapse">
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">1. The Data</a></li>
  <li><a href="#hcris" id="toc-hcris" class="nav-link" data-scroll-target="#hcris">HCRIS</a></li>
  <li><a href="#pos" id="toc-pos" class="nav-link" data-scroll-target="#pos">POS</a></li>
  <li><a href="#kff-medicaid-expansion" id="toc-kff-medicaid-expansion" class="nav-link" data-scroll-target="#kff-medicaid-expansion">KFF Medicaid Expansion</a></li>
  <li><a href="#the-analysis" id="toc-the-analysis" class="nav-link" data-scroll-target="#the-analysis">2. The analysis</a></li>
  <li><a href="#discussion-and-reflection" id="toc-discussion-and-reflection" class="nav-link" data-scroll-target="#discussion-and-reflection">3. Discussion and reflection</a></li>
  <li><a href="#expectations" id="toc-expectations" class="nav-link" data-scroll-target="#expectations">4. Expectations</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="class9.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A Quick Primer on Diff-in-Diff</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Ian McCarthy, Emory University and NBER </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Emory University, 2024
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="outline" class="level2">
<h2 class="anchored" data-anchor-id="outline">Outline</h2>
<ol type="1">
<li>Panel Data and Fixed Effects</li>
<li>Difference-in-Differences Yesterday</li>
<li>Difference-in-Differences Today</li>
<li>Brief Notes on Empirical Exercise</li>
</ol>
</section>
<section id="panel-data-and-fixed-effects" class="level1">
<h1>Panel Data and Fixed Effects</h1>
<hr>
<section id="basics-of-panel-data" class="level2">
<h2 class="anchored" data-anchor-id="basics-of-panel-data">Basics of panel data</h2>
<ul>
<li>Repeated observations of the same units over time (balanced vs unbalanced)</li>
<li>Identification due to variation <strong>within unit</strong></li>
</ul>
<div class="fragment">
<p><strong>Notation</strong></p>
<ul>
<li>Unit <span class="math inline">\(i=1,...,N\)</span> over several periods <span class="math inline">\(t=1,...,T\)</span>, which we denote <span class="math inline">\(y_{it}\)</span></li>
<li>Treatment status <span class="math inline">\(D_{it}\)</span></li>
<li>Regression model, <br> <span class="math inline">\(y_{it} = \delta D_{it} + \gamma_{i} + \gamma_{t} + \epsilon_{it}\)</span> for <span class="math inline">\(t=1,...,T\)</span> and <span class="math inline">\(i=1,...,N\)</span></li>
</ul>
</div>
<hr>
</section>
<section id="benefits-of-panel-data" class="level2">
<h2 class="anchored" data-anchor-id="benefits-of-panel-data">Benefits of Panel Data</h2>
<ul>
<li><em>May</em> overcome certain forms of omitted variable bias</li>
<li>Allows for unobserved but time-invariant factor, <span class="math inline">\(\gamma_{i}\)</span>, that affects both treatment and outcomes</li>
</ul>
<div class="fragment">
<p><strong>Still assumes</strong></p>
<ul>
<li>No time-varying confounders</li>
<li>Past outcomes do not directly affect current outcomes</li>
<li>Past outcomes do not affect treatment (reverse causality)</li>
</ul>
</div>
<hr>
</section>
<section id="some-textbook-settings" class="level2">
<h2 class="anchored" data-anchor-id="some-textbook-settings">Some textbook settings</h2>
<ul>
<li>Unobserved “ability” when studying schooling and wages</li>
<li>Unobserved “quality” when studying physicians or hospitals</li>
</ul>
<hr>
</section>
<section id="fixed-effects-and-regression" class="level2">
<h2 class="anchored" data-anchor-id="fixed-effects-and-regression">Fixed effects and regression</h2>
<p><span class="math inline">\(y_{it} = \delta D_{it} + \gamma_{i} + \gamma_{t} + \epsilon_{it}\)</span> for <span class="math inline">\(t=1,...,T\)</span> and <span class="math inline">\(i=1,...,N\)</span></p>
<div class="fragment">
<ul>
<li>Allows correlation between <span class="math inline">\(\gamma_{i}\)</span> and <span class="math inline">\(D_{it}\)</span></li>
<li>Physically estimate <span class="math inline">\(\gamma_{i}\)</span> in some cases via set of dummy variables</li>
<li>More generally, “remove” <span class="math inline">\(\gamma_{i}\)</span> via:
<ul>
<li>“within” estimator</li>
<li>first-difference estimator</li>
</ul></li>
</ul>
</div>
<hr>
</section>
<section id="within-estimator" class="level2">
<h2 class="anchored" data-anchor-id="within-estimator">Within Estimator</h2>
<p><span class="math inline">\(y_{it} = \delta D_{it} + \gamma_{i} + \gamma_{t} + \epsilon_{it}\)</span> for <span class="math inline">\(t=1,...,T\)</span> and <span class="math inline">\(i=1,...,N\)</span></p>
<div class="fragment">
<ul>
<li><p>Most common approach (default in most statistical software)</p></li>
<li><p>Equivalent to demeaned model: <span class="math display">\[y_{it} - \bar{y}_{i} = \delta (D_{it} - \bar{D}_{i}) + (\gamma_{i} - \bar{\gamma}_{i}) + (\gamma_{t} - \bar{\gamma}_{t}) + (\epsilon_{it} - \bar{\epsilon}_{i})\]</span></p></li>
<li><p><span class="math inline">\(\gamma_{i} - \bar{\gamma}_{i} = 0\)</span> since <span class="math inline">\(\gamma_{i}\)</span> is time-invariant</p></li>
<li><p>Requires <em>strict exogeneity</em> assumption (error is uncorrelated with <span class="math inline">\(D_{it}\)</span> for all time periods)</p></li>
</ul>
</div>
<hr>
</section>
<section id="first-difference" class="level2">
<h2 class="anchored" data-anchor-id="first-difference">First-difference</h2>
<p><span class="math inline">\(y_{it} = \delta D_{it} + \gamma_{i} + \gamma_{t} + \epsilon_{it}\)</span> for <span class="math inline">\(t=1,...,T\)</span> and <span class="math inline">\(i=1,...,N\)</span></p>
<div class="fragment">
<ul>
<li><p>Instead of subtracting the mean, subtract the prior period values <span class="math display">\[y_{it} - y_{i,t-1} = \delta(D_{it} - D_{i,t-1}) + (\gamma_{i} - \gamma_{i}) + (\gamma_{t} - \gamma_{t-1}) + (\epsilon_{it} - \epsilon_{i,t-1})\]</span></p></li>
<li><p>Requires exogeneity of <span class="math inline">\(\epsilon_{it}\)</span> and <span class="math inline">\(D_{it}\)</span> only for time <span class="math inline">\(t\)</span> and <span class="math inline">\(t-1\)</span> (weaker assumption than within estimator)</p></li>
<li><p>Sometimes useful to estimate both FE and FD just as a check</p></li>
</ul>
</div>
<hr>
</section>
<section id="keep-in-mind" class="level2">
<h2 class="anchored" data-anchor-id="keep-in-mind">Keep in mind…</h2>
<ul>
<li>Discussion only applies to linear case or very specific nonlinear models</li>
<li>Fixed effects at lower “levels” accommodate fixed effects at higher levels (e.g., FEs for hospital combine to form FEs for zip code, etc.)</li>
<li>Fixed effects can’t solve reverse causality</li>
<li>Fixed effects don’t address unobserved, time-varying confounders</li>
<li>Can’t estimate effects on time-invariant variables</li>
<li>May “absorb” a lot of the variation for variables that don’t change much over time</li>
</ul>
<hr>
</section>
<section id="within-estimator-default-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="within-estimator-default-in-practice">Within Estimator (Default) in practice</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install causaldata</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>causaldata gapminder.dta, <span class="kw">use</span> <span class="kw">clear</span> download</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> lgdp_pc=<span class="fu">log</span>(gdppercap)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">tsset</span> country <span class="fu">year</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">xtreg</span> lifeExp lgdp_pc, <span class="kw">fe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(causaldata)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lgdp_pc=</span><span class="fu">log</span>(gdpPercap))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">feols</span>(lifeExp<span class="sc">~</span>lgdp_pc <span class="sc">|</span> country, <span class="at">data=</span>reg.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="within-estimator-default-in-practice-1" class="level2">
<h2 class="anchored" data-anchor-id="within-estimator-default-in-practice-1">Within Estimator (Default) in practice</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(causaldata)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lgdp_pc=</span><span class="fu">log</span>(gdpPercap))</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">feols</span>(lifeExp <span class="sc">~</span> lgdp_pc <span class="sc">|</span> country, <span class="at">data=</span>reg.dat)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Default FE"</span><span class="ot">=</span>m1), </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span>term <span class="sc">+</span> statistic <span class="sc">~</span> model, </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_map=</span><span class="cn">NA</span>, </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">coef_rename=</span><span class="fu">c</span>(<span class="st">"lgdp_pc"</span><span class="ot">=</span><span class="st">"Log GDP per Capita"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_t6r6vy4oz6q7j4nbm2he(i, j, css_id) {
        var table = document.getElementById("tinytable_t6r6vy4oz6q7j4nbm2he");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_t6r6vy4oz6q7j4nbm2he');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_t6r6vy4oz6q7j4nbm2he(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_t6r6vy4oz6q7j4nbm2he");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_t6r6vy4oz6q7j4nbm2he(0, 0, 'tinytable_css_idvy13l67omjgk2i27pday') })
window.addEventListener('load', function () { styleCell_t6r6vy4oz6q7j4nbm2he(0, 1, 'tinytable_css_idtvt6yhdrrizf2ustifeo') })
window.addEventListener('load', function () { styleCell_t6r6vy4oz6q7j4nbm2he(1, 0, 'tinytable_css_idryw4xbswhl7svvmzg1co') })
window.addEventListener('load', function () { styleCell_t6r6vy4oz6q7j4nbm2he(1, 1, 'tinytable_css_id5uhxiinntny22gi10jh7') })
window.addEventListener('load', function () { styleCell_t6r6vy4oz6q7j4nbm2he(2, 0, 'tinytable_css_idryw4xbswhl7svvmzg1co') })
window.addEventListener('load', function () { styleCell_t6r6vy4oz6q7j4nbm2he(2, 1, 'tinytable_css_id5uhxiinntny22gi10jh7') })
    </script>

    <style>
    .table td.tinytable_css_idvy13l67omjgk2i27pday, .table th.tinytable_css_idvy13l67omjgk2i27pday {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idtvt6yhdrrizf2ustifeo, .table th.tinytable_css_idtvt6yhdrrizf2ustifeo {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idryw4xbswhl7svvmzg1co, .table th.tinytable_css_idryw4xbswhl7svvmzg1co {  text-align: left; }
    .table td.tinytable_css_id5uhxiinntny22gi10jh7, .table th.tinytable_css_id5uhxiinntny22gi10jh7 {  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_t6r6vy4oz6q7j4nbm2he" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Default FE</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Log GDP per Capita</td>
                  <td>9.769  </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(0.702)</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<hr>
</section>
<section id="within-estimator-manually-demean-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="within-estimator-manually-demean-in-practice">Within Estimator (Manually Demean) in practice</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>causaldata gapminder.dta, <span class="kw">use</span> <span class="kw">clear</span> download</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> lgdp_pc=<span class="fu">log</span>(gdppercap)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> x <span class="kw">of</span> <span class="kw">varlist</span> lifeExp lgdp_pc {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">egen</span> mean_<span class="ot">`x'</span>=<span class="kw">mean</span>(<span class="ot">`x'</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">egen</span> demean_<span class="ot">`x'</span>=<span class="ot">`x'</span>-mean_<span class="ot">`x'</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> demean_lifeExp demean_lgdp_pc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(causaldata)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lgdp_pc=</span><span class="fu">log</span>(gdpPercap)) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">demean_lifeexp=</span>lifeExp <span class="sc">-</span> <span class="fu">mean</span>(lifeExp, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">demean_gdp=</span>lgdp_pc <span class="sc">-</span> <span class="fu">mean</span>(lgdp_pc, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(demean_lifeexp<span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> demean_gdp, <span class="at">data=</span>reg.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="within-estimator-manually-demean-in-practice-1" class="level2">
<h2 class="anchored" data-anchor-id="within-estimator-manually-demean-in-practice-1">Within Estimator (Manually Demean) in practice</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lgdp_pc=</span><span class="fu">log</span>(gdpPercap),</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">lgdp_pc=</span>lgdp_pc <span class="sc">-</span> <span class="fu">mean</span>(lgdp_pc, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">lifeExp=</span>lifeExp <span class="sc">-</span> <span class="fu">mean</span>(lifeExp, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lifeExp<span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> lgdp_pc , <span class="at">data=</span>reg.dat)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Default FE"</span><span class="ot">=</span>m1, <span class="st">"Manual FE"</span><span class="ot">=</span>m2), </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span>term <span class="sc">+</span> statistic <span class="sc">~</span> model, </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_map=</span><span class="cn">NA</span>, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">coef_rename=</span><span class="fu">c</span>(<span class="st">"lgdp_pc"</span><span class="ot">=</span><span class="st">"Log GDP per Capita"</span>),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">vcov =</span> <span class="sc">~</span>country)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_3xgatogxvngba2q3trmh(i, j, css_id) {
        var table = document.getElementById("tinytable_3xgatogxvngba2q3trmh");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_3xgatogxvngba2q3trmh');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_3xgatogxvngba2q3trmh(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_3xgatogxvngba2q3trmh");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_3xgatogxvngba2q3trmh(0, 0, 'tinytable_css_idlct1vr5rc3v68a6vspvn') })
window.addEventListener('load', function () { styleCell_3xgatogxvngba2q3trmh(0, 1, 'tinytable_css_idwtn71sz5z56k1pbphvuy') })
window.addEventListener('load', function () { styleCell_3xgatogxvngba2q3trmh(0, 2, 'tinytable_css_idwtn71sz5z56k1pbphvuy') })
window.addEventListener('load', function () { styleCell_3xgatogxvngba2q3trmh(1, 0, 'tinytable_css_idavdqqqn4ok4xug4y9myr') })
window.addEventListener('load', function () { styleCell_3xgatogxvngba2q3trmh(1, 1, 'tinytable_css_idqi5zbg7vbcj9ffhh3ein') })
window.addEventListener('load', function () { styleCell_3xgatogxvngba2q3trmh(1, 2, 'tinytable_css_idqi5zbg7vbcj9ffhh3ein') })
window.addEventListener('load', function () { styleCell_3xgatogxvngba2q3trmh(2, 0, 'tinytable_css_idavdqqqn4ok4xug4y9myr') })
window.addEventListener('load', function () { styleCell_3xgatogxvngba2q3trmh(2, 1, 'tinytable_css_idqi5zbg7vbcj9ffhh3ein') })
window.addEventListener('load', function () { styleCell_3xgatogxvngba2q3trmh(2, 2, 'tinytable_css_idqi5zbg7vbcj9ffhh3ein') })
    </script>

    <style>
    .table td.tinytable_css_idlct1vr5rc3v68a6vspvn, .table th.tinytable_css_idlct1vr5rc3v68a6vspvn {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idwtn71sz5z56k1pbphvuy, .table th.tinytable_css_idwtn71sz5z56k1pbphvuy {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idavdqqqn4ok4xug4y9myr, .table th.tinytable_css_idavdqqqn4ok4xug4y9myr {  text-align: left; }
    .table td.tinytable_css_idqi5zbg7vbcj9ffhh3ein, .table th.tinytable_css_idqi5zbg7vbcj9ffhh3ein {  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_3xgatogxvngba2q3trmh" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Default FE</th>
                <th scope="col">Manual FE</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Log GDP per Capita</td>
                  <td>9.769  </td>
                  <td>9.769  </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(0.702)</td>
                  <td>(0.701)</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p><strong>Note:</strong> <code>feols</code> defaults to clustering at level of FE, <code>lm</code> requires our input</p>
<hr>
</section>
<section id="first-differencing-default-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="first-differencing-default-in-practice">First differencing (default) in practice</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>causaldata gapminder.dta, <span class="kw">use</span> <span class="kw">clear</span> download</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> lgdp_pc=<span class="fu">log</span>(gdppercap)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="kw">d</span>.lifeExp <span class="kw">d</span>.lgdp_pc, <span class="kw">noconstant</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plm)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lgdp_pc=</span><span class="fu">log</span>(gdpPercap))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plm</span>(lifeExp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> lgdp_pc, <span class="at">model=</span><span class="st">"fd"</span>, <span class="at">individual=</span><span class="st">"country"</span>, <span class="at">index=</span><span class="fu">c</span>(<span class="st">"country"</span>,<span class="st">"year"</span>), <span class="at">data=</span>reg.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="first-differencing-manual-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="first-differencing-manual-in-practice">First differencing (manual) in practice</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plm)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lgdp_pc=</span><span class="fu">log</span>(gdpPercap))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">plm</span>(lifeExp <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> lgdp_pc, <span class="at">model=</span><span class="st">"fd"</span>, <span class="at">index=</span><span class="fu">c</span>(<span class="st">"country"</span>,<span class="st">"year"</span>), <span class="at">data=</span>reg.dat)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Default FE"</span><span class="ot">=</span>m1, <span class="st">"Manual FE"</span><span class="ot">=</span>m2, <span class="st">"Default FD"</span><span class="ot">=</span>m3), </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span>term <span class="sc">+</span> statistic <span class="sc">~</span> model, </span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_map=</span><span class="cn">NA</span>, </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">coef_rename=</span><span class="fu">c</span>(<span class="st">"lgdp_pc"</span><span class="ot">=</span><span class="st">"Log GDP per Capita"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_c3bfghrafrwygl3igdef(i, j, css_id) {
        var table = document.getElementById("tinytable_c3bfghrafrwygl3igdef");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_c3bfghrafrwygl3igdef');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_c3bfghrafrwygl3igdef(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_c3bfghrafrwygl3igdef");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(0, 0, 'tinytable_css_idt6eumnkeidzaccdjmliq') })
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(0, 1, 'tinytable_css_idxx1maco2l6n78tjg6c8s') })
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(0, 2, 'tinytable_css_idxx1maco2l6n78tjg6c8s') })
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(0, 3, 'tinytable_css_idxx1maco2l6n78tjg6c8s') })
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(1, 0, 'tinytable_css_idr59aw1w0877f05mo4vtk') })
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(1, 1, 'tinytable_css_idrpj9nygihsxqbwn4hoxt') })
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(1, 2, 'tinytable_css_idrpj9nygihsxqbwn4hoxt') })
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(1, 3, 'tinytable_css_idrpj9nygihsxqbwn4hoxt') })
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(2, 0, 'tinytable_css_idr59aw1w0877f05mo4vtk') })
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(2, 1, 'tinytable_css_idrpj9nygihsxqbwn4hoxt') })
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(2, 2, 'tinytable_css_idrpj9nygihsxqbwn4hoxt') })
window.addEventListener('load', function () { styleCell_c3bfghrafrwygl3igdef(2, 3, 'tinytable_css_idrpj9nygihsxqbwn4hoxt') })
    </script>

    <style>
    .table td.tinytable_css_idt6eumnkeidzaccdjmliq, .table th.tinytable_css_idt6eumnkeidzaccdjmliq {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idxx1maco2l6n78tjg6c8s, .table th.tinytable_css_idxx1maco2l6n78tjg6c8s {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idr59aw1w0877f05mo4vtk, .table th.tinytable_css_idr59aw1w0877f05mo4vtk {  text-align: left; }
    .table td.tinytable_css_idrpj9nygihsxqbwn4hoxt, .table th.tinytable_css_idrpj9nygihsxqbwn4hoxt {  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_c3bfghrafrwygl3igdef" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Default FE</th>
                <th scope="col">Manual FE</th>
                <th scope="col">Default FD</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Log GDP per Capita</td>
                  <td>9.769  </td>
                  <td>9.769  </td>
                  <td>5.290  </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(0.702)</td>
                  <td>(0.284)</td>
                  <td>(0.291)</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<hr>
</section>
<section id="first-differencing-manual-in-practice-1" class="level2">
<h2 class="anchored" data-anchor-id="first-differencing-manual-in-practice-1">First differencing (manual) in practice</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>causaldata gapminder.dta, <span class="kw">use</span> <span class="kw">clear</span> download</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> lgdp_pc=<span class="fu">log</span>(gdppercap)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> <span class="kw">d</span>.lifeExp <span class="kw">d</span>.lgdp_pc, <span class="kw">noconstant</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lgdp_pc=</span><span class="fu">log</span>(gdpPercap)) <span class="sc">%&gt;%</span>  </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(country, year) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fd_lifeexp=</span>lifeExp <span class="sc">-</span> <span class="fu">lag</span>(lifeExp),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">lgdp_pc=</span>lgdp_pc <span class="sc">-</span> <span class="fu">lag</span>(lgdp_pc)) <span class="sc">%&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(fd_lifeexp<span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> lgdp_pc , <span class="at">data=</span>reg.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="first-differencing-manual-in-practice-2" class="level2">
<h2 class="anchored" data-anchor-id="first-differencing-manual-in-practice-2">First differencing (manual) in practice</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lgdp_pc=</span><span class="fu">log</span>(gdpPercap)) <span class="sc">%&gt;%</span>  </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(country, year) <span class="sc">%&gt;%</span>  </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fd_lifeexp=</span>lifeExp <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(lifeExp),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">lgdp_pc=</span>lgdp_pc <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(lgdp_pc)) <span class="sc">%&gt;%</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(fd_lifeexp<span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> lgdp_pc , <span class="at">data=</span>reg.dat)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Default FE"</span><span class="ot">=</span>m1, <span class="st">"Manual FE"</span><span class="ot">=</span>m2, <span class="st">"Default FD"</span><span class="ot">=</span>m3, <span class="st">"Manual FD"</span><span class="ot">=</span>m4), </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span>term <span class="sc">+</span> statistic <span class="sc">~</span> model, </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_map=</span><span class="cn">NA</span>, </span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">coef_rename=</span><span class="fu">c</span>(<span class="st">"lgdp_pc"</span><span class="ot">=</span><span class="st">"Log GDP per Capita"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_65i7pt7xwk53y3rneaih(i, j, css_id) {
        var table = document.getElementById("tinytable_65i7pt7xwk53y3rneaih");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_65i7pt7xwk53y3rneaih');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_65i7pt7xwk53y3rneaih(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_65i7pt7xwk53y3rneaih");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(0, 0, 'tinytable_css_id8c2m55urg8xjbku9mdyk') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(0, 1, 'tinytable_css_idpwd89yek95xy2b2wpivm') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(0, 2, 'tinytable_css_idpwd89yek95xy2b2wpivm') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(0, 3, 'tinytable_css_idpwd89yek95xy2b2wpivm') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(0, 4, 'tinytable_css_idpwd89yek95xy2b2wpivm') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(1, 0, 'tinytable_css_id4zrvga27i6f8oi0o2ac6') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(1, 1, 'tinytable_css_idf9hrzghcb0ommm2enpum') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(1, 2, 'tinytable_css_idf9hrzghcb0ommm2enpum') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(1, 3, 'tinytable_css_idf9hrzghcb0ommm2enpum') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(1, 4, 'tinytable_css_idf9hrzghcb0ommm2enpum') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(2, 0, 'tinytable_css_id4zrvga27i6f8oi0o2ac6') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(2, 1, 'tinytable_css_idf9hrzghcb0ommm2enpum') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(2, 2, 'tinytable_css_idf9hrzghcb0ommm2enpum') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(2, 3, 'tinytable_css_idf9hrzghcb0ommm2enpum') })
window.addEventListener('load', function () { styleCell_65i7pt7xwk53y3rneaih(2, 4, 'tinytable_css_idf9hrzghcb0ommm2enpum') })
    </script>

    <style>
    .table td.tinytable_css_id8c2m55urg8xjbku9mdyk, .table th.tinytable_css_id8c2m55urg8xjbku9mdyk {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idpwd89yek95xy2b2wpivm, .table th.tinytable_css_idpwd89yek95xy2b2wpivm {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_id4zrvga27i6f8oi0o2ac6, .table th.tinytable_css_id4zrvga27i6f8oi0o2ac6 {  text-align: left; }
    .table td.tinytable_css_idf9hrzghcb0ommm2enpum, .table th.tinytable_css_idf9hrzghcb0ommm2enpum {  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_65i7pt7xwk53y3rneaih" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Default FE</th>
                <th scope="col">Manual FE</th>
                <th scope="col">Default FD</th>
                <th scope="col">Manual FD</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Log GDP per Capita</td>
                  <td>9.769  </td>
                  <td>9.769  </td>
                  <td>5.290  </td>
                  <td>5.290  </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(0.702)</td>
                  <td>(0.284)</td>
                  <td>(0.291)</td>
                  <td>(0.291)</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<hr>
</section>
<section id="fe-and-fd-with-same-time-period" class="level2">
<h2 class="anchored" data-anchor-id="fe-and-fd-with-same-time-period">FE and FD with same time period</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>reg.dat2 <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>gapminder <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lgdp_pc=</span><span class="fu">log</span>(gdpPercap)) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(reg.dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(country, year), <span class="at">by=</span><span class="fu">c</span>(<span class="st">"country"</span>,<span class="st">"year"</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">feols</span>(lifeExp <span class="sc">~</span> lgdp_pc <span class="sc">|</span> country, <span class="at">data=</span>reg.dat2)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"Default FE"</span><span class="ot">=</span>m5, <span class="st">"Default FD"</span><span class="ot">=</span>m3, <span class="st">"Manual FD"</span><span class="ot">=</span>m4), </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span>term <span class="sc">+</span> statistic <span class="sc">~</span> model, </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_map=</span><span class="cn">NA</span>, </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">coef_rename=</span><span class="fu">c</span>(<span class="st">"lgdp_pc"</span><span class="ot">=</span><span class="st">"Log GDP per Capita"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_57o5mcp8d3i6l01gy9yd(i, j, css_id) {
        var table = document.getElementById("tinytable_57o5mcp8d3i6l01gy9yd");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_57o5mcp8d3i6l01gy9yd');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_57o5mcp8d3i6l01gy9yd(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_57o5mcp8d3i6l01gy9yd");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(0, 0, 'tinytable_css_idvre1h17k6zpetk6lufo9') })
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(0, 1, 'tinytable_css_idee96s73d8rzzktn1g06c') })
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(0, 2, 'tinytable_css_idee96s73d8rzzktn1g06c') })
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(0, 3, 'tinytable_css_idee96s73d8rzzktn1g06c') })
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(1, 0, 'tinytable_css_ids0tucq02he8tx8obc974') })
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(1, 1, 'tinytable_css_id98n960083e95f9l54dg7') })
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(1, 2, 'tinytable_css_id98n960083e95f9l54dg7') })
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(1, 3, 'tinytable_css_id98n960083e95f9l54dg7') })
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(2, 0, 'tinytable_css_ids0tucq02he8tx8obc974') })
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(2, 1, 'tinytable_css_id98n960083e95f9l54dg7') })
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(2, 2, 'tinytable_css_id98n960083e95f9l54dg7') })
window.addEventListener('load', function () { styleCell_57o5mcp8d3i6l01gy9yd(2, 3, 'tinytable_css_id98n960083e95f9l54dg7') })
    </script>

    <style>
    .table td.tinytable_css_idvre1h17k6zpetk6lufo9, .table th.tinytable_css_idvre1h17k6zpetk6lufo9 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idee96s73d8rzzktn1g06c, .table th.tinytable_css_idee96s73d8rzzktn1g06c {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_ids0tucq02he8tx8obc974, .table th.tinytable_css_ids0tucq02he8tx8obc974 {  text-align: left; }
    .table td.tinytable_css_id98n960083e95f9l54dg7, .table th.tinytable_css_id98n960083e95f9l54dg7 {  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_57o5mcp8d3i6l01gy9yd" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Default FE</th>
                <th scope="col">Default FD</th>
                <th scope="col">Manual FD</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>Log GDP per Capita</td>
                  <td>8.929  </td>
                  <td>5.290  </td>
                  <td>5.290  </td>
                </tr>
                <tr>
                  <td>                  </td>
                  <td>(0.741)</td>
                  <td>(0.291)</td>
                  <td>(0.291)</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Don’t want to read too much into this, but…</p>
<ul>
<li>Likely strong serial correlation in this case (almost certainly)</li>
<li>Mispecified model</li>
</ul>
</section>
</section>
<section id="difference-in-differences-yesterday" class="level1">
<h1>Difference-in-Differences Yesterday</h1>
<hr>
<section id="basic-2x2-setup" class="level2">
<h2 class="anchored" data-anchor-id="basic-2x2-setup">Basic 2x2 Setup</h2>
<p>Want to estimate <span class="math inline">\(ATT = E[Y_{1}(1)- Y_{0}(1) | D=1]\)</span></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">Pre-Period</th>
<th style="text-align: left;">Post-Period</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Treatment</td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(0)|D=1)\)</span></td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{1}(1)|D=1)\)</span></td>
</tr>
<tr class="even">
<td>Control</td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(0)|D=0)\)</span></td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(1)|D=0)\)</span></td>
</tr>
</tbody>
</table>
<div class="fragment">
<p><br></p>
<p><strong>Problem:</strong> We don’t see <span class="math inline">\(E[Y_{0}(1)|D=1]\)</span></p>
</div>
<hr>
</section>
<section id="basic-2x2-setup-1" class="level2">
<h2 class="anchored" data-anchor-id="basic-2x2-setup-1">Basic 2x2 Setup</h2>
<p>Want to estimate <span class="math inline">\(ATT = E[Y_{1}(1)- Y_{0}(1) | D=1]\)</span></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">Pre-Period</th>
<th style="text-align: left;">Post-Period</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Treatment</td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(0)|D=1)\)</span></td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{1}(1)|D=1)\)</span></td>
</tr>
<tr class="even">
<td>Control</td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(0)|D=0)\)</span></td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(1)|D=0)\)</span></td>
</tr>
</tbody>
</table>
<div class="fragment">
<p><br></p>
<p><strong>Strategy 1:</strong> Estimate <span class="math inline">\(E[Y_{0}(1)|D=1]\)</span> using <span class="math inline">\(E[Y_{0}(0)|D=1]\)</span> (before treatment outcome used to estimate post-treatment)</p>
</div>
<hr>
</section>
<section id="basic-2x2-setup-2" class="level2">
<h2 class="anchored" data-anchor-id="basic-2x2-setup-2">Basic 2x2 Setup</h2>
<p>Want to estimate <span class="math inline">\(ATT = E[Y_{1}(1)- Y_{0}(1) | D=1]\)</span></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">Pre-Period</th>
<th style="text-align: left;">Post-Period</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Treatment</td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(0)|D=1)\)</span></td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{1}(1)|D=1)\)</span></td>
</tr>
<tr class="even">
<td>Control</td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(0)|D=0)\)</span></td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(1)|D=0)\)</span></td>
</tr>
</tbody>
</table>
<div class="fragment">
<p><br></p>
<p><strong>Strategy 2:</strong> Estimate <span class="math inline">\(E[Y_{0}(1)|D=1]\)</span> using <span class="math inline">\(E[Y_{0}(1)|D=0]\)</span> (control group used to predict outcome for treatment)</p>
</div>
<hr>
</section>
<section id="basic-2x2-setup-3" class="level2">
<h2 class="anchored" data-anchor-id="basic-2x2-setup-3">Basic 2x2 Setup</h2>
<p>Want to estimate <span class="math inline">\(ATT = E[Y_{1}(1)- Y_{0}(1) | D=1]\)</span></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">Pre-Period</th>
<th style="text-align: left;">Post-Period</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Treatment</td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(0)|D=1)\)</span></td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{1}(1)|D=1)\)</span></td>
</tr>
<tr class="even">
<td>Control</td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(0)|D=0)\)</span></td>
<td style="text-align: left;"><span class="math inline">\(E(Y_{0}(1)|D=0)\)</span></td>
</tr>
</tbody>
</table>
<div class="fragment">
<p><br></p>
<p><strong>Strategy 3: DD</strong></p>
<p><br></p>
<p>Estimate <span class="math inline">\(E[Y_{1}(1)|D=1] - E[Y_{0}(1)|D=1]\)</span> using <span class="math inline">\(E[Y_{0}(1)|D=0] - E[Y_{0}(0)|D=0]\)</span> (pre-post difference in control group used to predict difference for treatment group)</p>
</div>
<hr>
</section>
<section id="graphically" class="level2">
<h2 class="anchored" data-anchor-id="graphically">Graphically</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="..\files/figures/standard-dd.png" class="img-fluid figure-img"></p>
<figcaption>Basic DD Graph</figcaption>
</figure>
</div>
<hr>
</section>
<section id="animations" class="level2">
<h2 class="anchored" data-anchor-id="animations">Animations</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="..\files/figures/dd_animate.gif" class="img-fluid figure-img"></p>
<figcaption>Basic DD Graph, Animated</figcaption>
</figure>
</div>
<hr>
</section>
<section id="ate-estimates-with-dd" class="level2">
<h2 class="anchored" data-anchor-id="ate-estimates-with-dd">ATE Estimates with DD</h2>
<p>Key identifying assumption is that of <em>parallel trends</em></p>
<p><span class="math display">\[E[Y_{0}(1) - Y_{0}(0)|D=1] = E[Y_{0}(1) - Y_{0}(0)|D=0]\]</span></p>
<hr>
</section>
<section id="estimation-sample-means" class="level2">
<h2 class="anchored" data-anchor-id="estimation-sample-means">Estimation: Sample Means</h2>
<p><span class="math display">\[\begin{align}
E[Y_{1}(1) - Y_{0}(1)|D=1] &amp;=&amp; \left( E[Y(1)|D=1] - E[Y(1)|D=0] \right) \\
&amp; &amp; - \left( E[Y(0)|D=1] - E[Y(0)|D=0]\right)
\end{align}\]</span></p>
<hr>
</section>
<section id="estimation-regression" class="level2">
<h2 class="anchored" data-anchor-id="estimation-regression">Estimation: Regression</h2>
<p><span class="math display">\[y_{it} = \alpha + \beta D_{i} + \lambda \times Post_{t} + \delta \times D_{i} \times Post_{t} + \varepsilon_{it}\]</span></p>
<div class="fragment">
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 21%">
<col style="width: 42%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">Pre</th>
<th style="text-align: left;">Post</th>
<th style="text-align: left;">Post - Pre</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Treatment</td>
<td style="text-align: left;"><span class="math inline">\(\alpha + \beta\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\alpha + \beta + \lambda + \delta\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\lambda + \delta\)</span></td>
</tr>
<tr class="even">
<td>Control</td>
<td style="text-align: left;"><span class="math inline">\(\alpha\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\alpha + \lambda\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\lambda\)</span></td>
</tr>
<tr class="odd">
<td>Diff</td>
<td style="text-align: left;"><span class="math inline">\(\beta\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\beta + \delta\)</span></td>
<td style="text-align: left;"><span class="math inline">\(\delta\)</span></td>
</tr>
</tbody>
</table>
</div>
<hr>
</section>
<section id="simulated-data" class="level2">
<h2 class="anchored" data-anchor-id="simulated-data">Simulated data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>dd.dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> (<span class="fu">runif</span>(N, <span class="dv">0</span>, <span class="dv">1</span>)<span class="sc">&gt;</span><span class="fl">0.5</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_pre =</span> <span class="st">"pre"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_post =</span> <span class="st">"post"</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>dd.dat <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(dd.dat, <span class="fu">c</span>(<span class="st">"time_pre"</span>,<span class="st">"time_post"</span>), <span class="at">values_to=</span><span class="st">"time"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(d, time) <span class="sc">%&gt;%</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">t=</span>(time<span class="sc">==</span><span class="st">"post"</span>),</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">y.out=</span><span class="fl">1.5</span><span class="sc">+</span><span class="dv">3</span><span class="sc">*</span>d <span class="sc">+</span> <span class="fl">1.5</span><span class="sc">*</span>t <span class="sc">+</span> <span class="dv">6</span><span class="sc">*</span>d<span class="sc">*</span>t <span class="sc">+</span> <span class="fu">rnorm</span>(N<span class="sc">*</span><span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="mean-differences" class="level2">
<h2 class="anchored" data-anchor-id="mean-differences">Mean differences</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>dd.means <span class="ot">&lt;-</span> dd.dat <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(d, t) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">mean_y =</span> <span class="fu">mean</span>(y.out)) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">d=</span><span class="fu">ifelse</span>(d<span class="sc">==</span><span class="cn">TRUE</span>, <span class="st">"Treated"</span>, <span class="st">"Control"</span>), <span class="at">t=</span><span class="fu">ifelse</span>(t<span class="sc">==</span><span class="cn">TRUE</span>, <span class="st">"Post"</span>, <span class="st">"Pre"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'd'. You can override using the `.groups`
argument.</code></pre>
</div>
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(dd.means, <span class="at">col.names=</span><span class="fu">c</span>(<span class="st">"Treated"</span>,<span class="st">"Period"</span>,<span class="st">"Mean"</span>), <span class="at">format=</span><span class="st">"html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Treated</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Period</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Control</td>
<td style="text-align: left;">Pre</td>
<td style="text-align: right;">1.525407</td>
</tr>
<tr class="even">
<td style="text-align: left;">Control</td>
<td style="text-align: left;">Post</td>
<td style="text-align: right;">2.985241</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Treated</td>
<td style="text-align: left;">Pre</td>
<td style="text-align: right;">4.486714</td>
</tr>
<tr class="even">
<td style="text-align: left;">Treated</td>
<td style="text-align: left;">Post</td>
<td style="text-align: right;">12.004374</td>
</tr>
</tbody>
</table>


</div>
</div>
<hr>
</section>
<section id="mean-differences-1" class="level2">
<h2 class="anchored" data-anchor-id="mean-differences-1">Mean differences</h2>
<p>In this example:</p>
<ul>
<li><span class="math inline">\(E[Y(1)|D=1] - E[Y(1)|D=0]\)</span> is 9.0191329</li>
<li><span class="math inline">\(E[Y(0)|D=1] - E[Y(0)|D=0]\)</span> is 2.9613066</li>
</ul>
<div class="fragment">
<p>So the ATT is 6.0578263</p>
</div>
<hr>
</section>
<section id="regression-estimator" class="level2">
<h2 class="anchored" data-anchor-id="regression-estimator">Regression estimator</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>dd.est <span class="ot">&lt;-</span> <span class="fu">lm</span>(y.out <span class="sc">~</span> d <span class="sc">+</span> t <span class="sc">+</span> d<span class="sc">*</span>t, <span class="at">data=</span>dd.dat)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(dd.est, <span class="at">gof_map=</span><span class="cn">NA</span>, <span class="at">coef_omit=</span><span class="st">'Intercept'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_6yq7ffc4dhcluyws6i2g(i, j, css_id) {
        var table = document.getElementById("tinytable_6yq7ffc4dhcluyws6i2g");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_6yq7ffc4dhcluyws6i2g');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_6yq7ffc4dhcluyws6i2g(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_6yq7ffc4dhcluyws6i2g");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(0, 0, 'tinytable_css_idb9hajx0mb8jwgvbhux3f') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(0, 1, 'tinytable_css_iddb05snrld3c3bmkxd7oi') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(1, 0, 'tinytable_css_idhcbhuptwtbqfvuygr7zq') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(1, 1, 'tinytable_css_id73gwiaxs11kcdqhaknue') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(2, 0, 'tinytable_css_idhcbhuptwtbqfvuygr7zq') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(2, 1, 'tinytable_css_id73gwiaxs11kcdqhaknue') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(3, 0, 'tinytable_css_idhcbhuptwtbqfvuygr7zq') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(3, 1, 'tinytable_css_id73gwiaxs11kcdqhaknue') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(4, 0, 'tinytable_css_idhcbhuptwtbqfvuygr7zq') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(4, 1, 'tinytable_css_id73gwiaxs11kcdqhaknue') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(5, 0, 'tinytable_css_idhcbhuptwtbqfvuygr7zq') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(5, 1, 'tinytable_css_id73gwiaxs11kcdqhaknue') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(6, 0, 'tinytable_css_idhcbhuptwtbqfvuygr7zq') })
window.addEventListener('load', function () { styleCell_6yq7ffc4dhcluyws6i2g(6, 1, 'tinytable_css_id73gwiaxs11kcdqhaknue') })
    </script>

    <style>
    .table td.tinytable_css_idb9hajx0mb8jwgvbhux3f, .table th.tinytable_css_idb9hajx0mb8jwgvbhux3f {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_iddb05snrld3c3bmkxd7oi, .table th.tinytable_css_iddb05snrld3c3bmkxd7oi {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idhcbhuptwtbqfvuygr7zq, .table th.tinytable_css_idhcbhuptwtbqfvuygr7zq {  text-align: left; }
    .table td.tinytable_css_id73gwiaxs11kcdqhaknue, .table th.tinytable_css_id73gwiaxs11kcdqhaknue {  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_6yq7ffc4dhcluyws6i2g" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">(1)</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>dTRUE        </td>
                  <td>2.961  </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.028)</td>
                </tr>
                <tr>
                  <td>tTRUE        </td>
                  <td>1.460  </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.028)</td>
                </tr>
                <tr>
                  <td>dTRUE × tTRUE</td>
                  <td>6.058  </td>
                </tr>
                <tr>
                  <td>             </td>
                  <td>(0.040)</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<hr>
</section>
<section id="application" class="level2">
<h2 class="anchored" data-anchor-id="application">Application</h2>
<ul>
<li>Try out some real data on Medicaid expansion following the ACA</li>
<li>Data is small part of DD empirical assignment</li>
<li><strong>Question:</strong> Did Medicaid expansion reduce uninsurance?</li>
</ul>
<hr>
</section>
<section id="step-1-look-at-the-data" class="level2">
<h2 class="anchored" data-anchor-id="step-1-look-at-the-data">Step 1: Look at the data</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">insheet</span> <span class="kw">using</span> <span class="st">"data/acs_medicaid.txt"</span>, <span class="kw">clear</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> perc_unins=uninsured/adult_pop</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> expand_year==<span class="st">"2014"</span> | expand_year==<span class="st">"NA"</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> expand_ever==<span class="st">"NA"</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="kw">collapse</span> (<span class="kw">mean</span>) perc_unins, <span class="kw">by</span>(<span class="fu">year</span> expand_ever)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="kw">graph</span> <span class="kw">twoway</span> (connected perc_unins <span class="fu">year</span> <span class="kw">if</span> expand_ever==<span class="st">"FALSE"</span>, <span class="kw">color</span>(<span class="bn">black</span>) lpattern(solid)) <span class="co">///</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  (connected perc_unins <span class="fu">year</span> <span class="kw">if</span> expand_ever==<span class="st">"TRUE"</span>, <span class="kw">color</span>(<span class="bn">black</span>) lpattern(<span class="kw">dash</span>)), <span class="co">///</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="bn">xline</span>(2013.5) <span class="co">///</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="bn">ytitle</span>(<span class="st">"Fraction Uninsured"</span>) <span class="bn">xtitle</span>(<span class="st">"Year"</span>) <span class="bn">legend</span>(<span class="kw">off</span>) <span class="bn">text</span>(0.15 2017 <span class="st">"Non-expansion"</span>, place(<span class="fu">e</span>)) <span class="bn">text</span>(0.08 2017 <span class="st">"Expansion"</span>, place(<span class="fu">e</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>mcaid.data <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"../files/data/acs/acs_medicaid.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 416 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (1): State
dbl  (8): year, adult_pop, ins_employer, ins_direct, ins_medicare, ins_medic...
lgl  (2): expand_ever, expand
date (1): date_adopted

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ins.plot.dat <span class="ot">&lt;-</span> mcaid.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(expand_year<span class="sc">==</span><span class="dv">2014</span> <span class="sc">|</span> <span class="fu">is.na</span>(expand_year), <span class="sc">!</span><span class="fu">is.na</span>(expand_ever)) <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_unins=</span>uninsured<span class="sc">/</span>adult_pop) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(expand_ever, year) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">mean=</span><span class="fu">mean</span>(perc_unins))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'expand_ever'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ins.plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data=</span>ins.plot.dat, <span class="fu">aes</span>(<span class="at">x=</span>year,<span class="at">y=</span>mean,<span class="at">group=</span>expand_ever,<span class="at">linetype=</span>expand_ever)) <span class="sc">+</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept=</span><span class="fl">2013.5</span>, <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> ins.plot.dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="dv">2016</span>), </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Non-expansion"</span>,<span class="st">"Expansion"</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">x =</span> year <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">linetype=</span><span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x=</span><span class="st">"Year"</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span><span class="st">"Fraction Uninsured"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title=</span><span class="st">"Share of Uninsured over Time"</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="step-1-look-at-the-data-1" class="level2">
<h2 class="anchored" data-anchor-id="step-1-look-at-the-data-1">Step 1: Look at the data</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="class9_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="step-2-estimate-effects" class="level2">
<h2 class="anchored" data-anchor-id="step-2-estimate-effects">Step 2: Estimate effects</h2>
<p>Interested in <span class="math inline">\(\delta\)</span> from:</p>
<p><span class="math display">\[y_{it} = \alpha + \beta \times Post_{t} + \lambda \times Expand_{i} + \delta \times Post_{t} \times Expand_{i} + \varepsilon_{it}\]</span></p>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">insheet</span> <span class="kw">using</span> <span class="st">"data/acs_medicaid.txt"</span>, <span class="kw">clear</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> perc_unins=uninsured/adult_pop</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> expand_year==<span class="st">"2014"</span> | expand_year==<span class="st">"NA"</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> expand_ever==<span class="st">"NA"</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="kw">post</span>=(<span class="fu">year</span>&gt;=2014)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> treat=(expand_ever==<span class="st">"TRUE"</span>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> treat_post=(expand==<span class="st">"TRUE"</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="kw">reg</span> perc_unins treat <span class="kw">post</span> treat_post</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>**also <span class="kw">try</span> didregress</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>mcaid.data <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"../files/data/acs/acs_medicaid.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 416 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (1): State
dbl  (8): year, adult_pop, ins_employer, ins_direct, ins_medicare, ins_medic...
lgl  (2): expand_ever, expand
date (1): date_adopted

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> mcaid.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(expand_year<span class="sc">==</span><span class="dv">2014</span> <span class="sc">|</span> <span class="fu">is.na</span>(expand_year), <span class="sc">!</span><span class="fu">is.na</span>(expand_ever)) <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_unins=</span>uninsured<span class="sc">/</span>adult_pop,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">post =</span> (year<span class="sc">&gt;=</span><span class="dv">2014</span>), </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat=</span>post<span class="sc">*</span>expand_ever)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>dd.ins.reg <span class="ot">&lt;-</span> <span class="fu">lm</span>(perc_unins <span class="sc">~</span> post <span class="sc">+</span> expand_ever <span class="sc">+</span> post<span class="sc">*</span>expand_ever, <span class="at">data=</span>reg.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="step-2-estimate-effects-1" class="level2">
<h2 class="anchored" data-anchor-id="step-2-estimate-effects-1">Step 2: Estimate effects</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(<span class="fu">list</span>(<span class="st">"DD (2014)"</span><span class="ot">=</span>dd.ins.reg),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape=</span>term <span class="sc">+</span> statistic <span class="sc">~</span> model, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">gof_map=</span><span class="cn">NA</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">coef_omit=</span><span class="st">'Intercept'</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">vcov=</span><span class="sc">~</span>State</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_gtcpvhty2np58k53uxgl(i, j, css_id) {
        var table = document.getElementById("tinytable_gtcpvhty2np58k53uxgl");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_gtcpvhty2np58k53uxgl');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_gtcpvhty2np58k53uxgl(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_gtcpvhty2np58k53uxgl");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(0, 0, 'tinytable_css_idtzm8m1mlf26ikvsajca9') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(0, 1, 'tinytable_css_idfm1rketouxkwbrrplnen') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(1, 0, 'tinytable_css_iddqz3dokvxb9morlhvby7') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(1, 1, 'tinytable_css_idlexg1wc9hdpzdbapywq6') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(2, 0, 'tinytable_css_iddqz3dokvxb9morlhvby7') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(2, 1, 'tinytable_css_idlexg1wc9hdpzdbapywq6') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(3, 0, 'tinytable_css_iddqz3dokvxb9morlhvby7') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(3, 1, 'tinytable_css_idlexg1wc9hdpzdbapywq6') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(4, 0, 'tinytable_css_iddqz3dokvxb9morlhvby7') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(4, 1, 'tinytable_css_idlexg1wc9hdpzdbapywq6') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(5, 0, 'tinytable_css_iddqz3dokvxb9morlhvby7') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(5, 1, 'tinytable_css_idlexg1wc9hdpzdbapywq6') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(6, 0, 'tinytable_css_iddqz3dokvxb9morlhvby7') })
window.addEventListener('load', function () { styleCell_gtcpvhty2np58k53uxgl(6, 1, 'tinytable_css_idlexg1wc9hdpzdbapywq6') })
    </script>

    <style>
    .table td.tinytable_css_idtzm8m1mlf26ikvsajca9, .table th.tinytable_css_idtzm8m1mlf26ikvsajca9 {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idfm1rketouxkwbrrplnen, .table th.tinytable_css_idfm1rketouxkwbrrplnen {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_iddqz3dokvxb9morlhvby7, .table th.tinytable_css_iddqz3dokvxb9morlhvby7 {  text-align: left; }
    .table td.tinytable_css_idlexg1wc9hdpzdbapywq6, .table th.tinytable_css_idlexg1wc9hdpzdbapywq6 {  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_gtcpvhty2np58k53uxgl" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">DD (2014)</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>postTRUE                  </td>
                  <td>-0.054 </td>
                </tr>
                <tr>
                  <td>                          </td>
                  <td>(0.003)</td>
                </tr>
                <tr>
                  <td>expand_everTRUE           </td>
                  <td>-0.046 </td>
                </tr>
                <tr>
                  <td>                          </td>
                  <td>(0.016)</td>
                </tr>
                <tr>
                  <td>postTRUE × expand_everTRUE</td>
                  <td>-0.019 </td>
                </tr>
                <tr>
                  <td>                          </td>
                  <td>(0.007)</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<hr>
</section>
<section id="final-dd-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="final-dd-thoughts">Final DD thoughts</h2>
<ul>
<li>Key identification assumption is <strong>parallel trends</strong></li>
<li>Inference: Typically want to cluster at unit-level to allow for correlation over time within units, but problems with small numbers of treated or control groups:
<ul>
<li>Conley-Taber CIs</li>
<li>Wild cluster bootstrap</li>
<li>Randomization inference</li>
</ul></li>
<li>“Extra” things like propensity score weighting and doubly robust estimation</li>
</ul>
<hr>
</section>
<section id="dd-and-twfe" class="level2">
<h2 class="anchored" data-anchor-id="dd-and-twfe">DD and TWFE?</h2>
<ul>
<li>Just a shorthand for a common regression specification</li>
<li>Fixed effects for each unit and each time period, <span class="math inline">\(\gamma_{i}\)</span> and <span class="math inline">\(\gamma_{t}\)</span></li>
<li>More general than 2x2 DD but same result</li>
</ul>
<hr>
</section>
<section id="what-is-twfe" class="level2">
<h2 class="anchored" data-anchor-id="what-is-twfe">What is TWFE?</h2>
<p>Want to estimate <span class="math inline">\(\delta\)</span>:</p>
<p><span class="math display">\[y_{it} = \alpha + \delta D_{it} + \gamma_{i} + \gamma_{t} + \varepsilon_{it},\]</span></p>
<p>where <span class="math inline">\(\gamma_{i}\)</span> and <span class="math inline">\(\gamma_{t}\)</span> denote a set of unit <span class="math inline">\(i\)</span> and time period <span class="math inline">\(t\)</span> dummy variables (or fixed effects).</p>
<hr>
</section>
<section id="twfe-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="twfe-in-practice">TWFE in Practice</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>2x2 DD</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>mcaid.data <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"../files/data/acs/acs_medicaid.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 416 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (1): State
dbl  (8): year, adult_pop, ins_employer, ins_direct, ins_medicare, ins_medic...
lgl  (2): expand_ever, expand
date (1): date_adopted

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> mcaid.data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(expand_year<span class="sc">==</span><span class="dv">2014</span> <span class="sc">|</span> <span class="fu">is.na</span>(expand_year), <span class="sc">!</span><span class="fu">is.na</span>(expand_ever)) <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_unins=</span>uninsured<span class="sc">/</span>adult_pop,</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">post =</span> (year<span class="sc">&gt;=</span><span class="dv">2014</span>), </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat=</span>post<span class="sc">*</span>expand_ever)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>m.dd <span class="ot">&lt;-</span> <span class="fu">lm</span>(perc_unins <span class="sc">~</span> post <span class="sc">+</span> expand_ever <span class="sc">+</span> treat, <span class="at">data=</span>reg.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>TWFE</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>m.twfe <span class="ot">&lt;-</span> <span class="fu">feols</span>(perc_unins <span class="sc">~</span> treat <span class="sc">|</span> State <span class="sc">+</span> year, <span class="at">data=</span>reg.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="twfe-in-practice-1" class="level2">
<h2 class="anchored" data-anchor-id="twfe-in-practice-1">TWFE in Practice</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">msummary</span>(<span class="fu">list</span>(<span class="st">"DD"</span><span class="ot">=</span>m.dd, <span class="st">"TWFE"</span><span class="ot">=</span>m.twfe),</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">shape=</span>term <span class="sc">+</span> statistic <span class="sc">~</span> model, </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">gof_map=</span><span class="cn">NA</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">coef_omit=</span><span class="st">'Intercept'</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">vcov=</span><span class="sc">~</span>State</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>         )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_jvyqpgg84v5s2x2gwsig(i, j, css_id) {
        var table = document.getElementById("tinytable_jvyqpgg84v5s2x2gwsig");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_jvyqpgg84v5s2x2gwsig');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_jvyqpgg84v5s2x2gwsig(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_jvyqpgg84v5s2x2gwsig");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(0, 0, 'tinytable_css_id2m2pv3wv307nn6g39l2y') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(0, 1, 'tinytable_css_idlgt9rxzvwy0bnznw6jgz') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(0, 2, 'tinytable_css_idlgt9rxzvwy0bnznw6jgz') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(1, 0, 'tinytable_css_iduwi5p2gmfsii2ub5vy0n') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(1, 1, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(1, 2, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(2, 0, 'tinytable_css_iduwi5p2gmfsii2ub5vy0n') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(2, 1, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(2, 2, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(3, 0, 'tinytable_css_iduwi5p2gmfsii2ub5vy0n') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(3, 1, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(3, 2, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(4, 0, 'tinytable_css_iduwi5p2gmfsii2ub5vy0n') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(4, 1, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(4, 2, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(5, 0, 'tinytable_css_iduwi5p2gmfsii2ub5vy0n') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(5, 1, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(5, 2, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(6, 0, 'tinytable_css_iduwi5p2gmfsii2ub5vy0n') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(6, 1, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
window.addEventListener('load', function () { styleCell_jvyqpgg84v5s2x2gwsig(6, 2, 'tinytable_css_id3cjcjw15jlvz6hcd8m33') })
    </script>

    <style>
    .table td.tinytable_css_id2m2pv3wv307nn6g39l2y, .table th.tinytable_css_id2m2pv3wv307nn6g39l2y {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idlgt9rxzvwy0bnznw6jgz, .table th.tinytable_css_idlgt9rxzvwy0bnznw6jgz {  text-align: center;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_iduwi5p2gmfsii2ub5vy0n, .table th.tinytable_css_iduwi5p2gmfsii2ub5vy0n {  text-align: left; }
    .table td.tinytable_css_id3cjcjw15jlvz6hcd8m33, .table th.tinytable_css_id3cjcjw15jlvz6hcd8m33 {  text-align: center; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_jvyqpgg84v5s2x2gwsig" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">DD</th>
                <th scope="col">TWFE</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>postTRUE       </td>
                  <td>-0.054 </td>
                  <td>       </td>
                </tr>
                <tr>
                  <td>               </td>
                  <td>(0.003)</td>
                  <td>       </td>
                </tr>
                <tr>
                  <td>expand_everTRUE</td>
                  <td>-0.046 </td>
                  <td>       </td>
                </tr>
                <tr>
                  <td>               </td>
                  <td>(0.016)</td>
                  <td>       </td>
                </tr>
                <tr>
                  <td>treat          </td>
                  <td>-0.019 </td>
                  <td>-0.019 </td>
                </tr>
                <tr>
                  <td>               </td>
                  <td>(0.007)</td>
                  <td>(0.007)</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<hr>
</section>
<section id="event-study" class="level2">
<h2 class="anchored" data-anchor-id="event-study">Event study</h2>
<p>Event study is poorly named:</p>
<ul>
<li>In finance, even study is just an <em>interrupted time series</em></li>
<li>In econ and other areas, we usually have a treatment/control group <em>and</em> a break in time</li>
</ul>
<hr>
</section>
<section id="why-show-an-event-study" class="level2">
<h2 class="anchored" data-anchor-id="why-show-an-event-study">Why show an event study?</h2>
<ul>
<li>Allows for heterogeneous effects over time (maybe effects phase in over time or dissipate)</li>
<li>Visually very appealing</li>
<li>Offers easy evidence against or consistent with parallel trends assumption</li>
</ul>
<hr>
</section>
<section id="how-to-do-an-event-study" class="level2">
<h2 class="anchored" data-anchor-id="how-to-do-an-event-study">How to do an event study?</h2>
<p>Estimate something akin to… <span class="math display">\[y_{it} = \gamma_{i} + \gamma_{t} + \sum_{\tau = -q}^{-2}\delta_{\tau} D_{i \tau} + \sum_{\tau=0}^{m} \delta_{\tau}D_{i \tau} + \beta x_{it} + \epsilon_{it},\]</span></p>
<p>where <span class="math inline">\(q\)</span> captures the number of periods before the treatment occurs and <span class="math inline">\(m\)</span> captures periods after treatment occurs.</p>
<hr>
</section>
<section id="how-to-do-an-event-study-1" class="level2">
<h2 class="anchored" data-anchor-id="how-to-do-an-event-study-1">How to do an event study?</h2>
<ol type="1">
<li>Create all treatment/year interactions</li>
<li>Regressions with full set of interactions and group/year FEs</li>
<li>Plot coefficients and standard errors</li>
</ol>
<hr>
</section>
<section id="things-to-address" class="level2">
<h2 class="anchored" data-anchor-id="things-to-address">Things to address</h2>
<ol type="1">
<li>“Event time” vs calendar time</li>
<li>Define baseline period</li>
<li>Choose number of pre-treatment and post-treatment coefficients</li>
</ol>
<hr>
</section>
<section id="event-time-vs-calendar-time" class="level2">
<h2 class="anchored" data-anchor-id="event-time-vs-calendar-time">Event time vs calendar time</h2>
<p>Essentially two “flavors” of event studies</p>
<ol type="1">
<li>Common treatment timing</li>
<li>Differential treatment timing</li>
</ol>
<hr>
</section>
<section id="define-baseline-period" class="level2">
<h2 class="anchored" data-anchor-id="define-baseline-period">Define baseline period</h2>
<ul>
<li>Must choose an “excluded” time period (as in all cases of group dummy variables)</li>
<li>Common choice is <span class="math inline">\(t=-1\)</span> (period just before treatment)</li>
<li>Easy to understand with calendar time</li>
<li>For event time…manually set time to <span class="math inline">\(t=-1\)</span> for all untreated units</li>
</ul>
<hr>
</section>
<section id="number-of-pre-treatment-and-post-treatment-periods" class="level2">
<h2 class="anchored" data-anchor-id="number-of-pre-treatment-and-post-treatment-periods">Number of pre-treatment and post-treatment periods</h2>
<ul>
<li>On event time, sometimes very few observations for large lead or lag values</li>
<li>Medicaid expansion example: Late adopting states have fewer post-treatment periods</li>
<li>Norm is to group final lead/lag periods together</li>
</ul>
<hr>
</section>
<section id="commont-treatment-timing" class="level2">
<h2 class="anchored" data-anchor-id="commont-treatment-timing">Commont treatment timing</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install reghdfe</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">insheet</span> <span class="kw">using</span> <span class="st">"data/acs_medicaid.txt"</span>, <span class="kw">clear</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> perc_unins=uninsured/adult_pop</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> expand_year==<span class="st">"2014"</span> | expand_year==<span class="st">"NA"</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> expand_ever==<span class="st">"NA"</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="kw">post</span>=(<span class="fu">year</span>&gt;=2014)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> treat=(expand_ever==<span class="st">"TRUE"</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> treat_post=(expand==<span class="st">"TRUE"</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>reghdfe perc_unins treat##ib2013.<span class="fu">year</span>, absorb(state)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> coef = .</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> se = .</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 2012(1)2018 {</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> coef = _b[1.treat#<span class="ot">`i'</span>.<span class="fu">year</span>] <span class="kw">if</span> <span class="fu">year</span> == <span class="ot">`i'</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> se = _se[1.treat#<span class="ot">`i'</span>.<span class="fu">year</span>] <span class="kw">if</span> <span class="fu">year</span> == <span class="ot">`i'</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>* Make confidence intervals</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> ci_top = coef+1.96*se</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> ci_bottom = coef - 1.96*se</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>* Limit ourselves to one observation per <span class="fu">year</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">year</span> coef se ci_*</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="kw">duplicates</span> <span class="kw">drop</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>* Create connected scatterplot <span class="kw">of</span> coefficients</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>* with CIs included with rcap </span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>* and a <span class="kw">line</span> <span class="fu">at</span> 0 from <span class="kw">function</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> (<span class="kw">sc</span> coef <span class="fu">year</span>, <span class="kw">connect</span>(<span class="kw">line</span>)) (rcap ci_top ci_bottom <span class="fu">year</span>) <span class="co">///</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">function</span> <span class="fu">y</span> = 0, <span class="kw">range</span>(2012 2018)), <span class="bn">xtitle</span>(<span class="st">"Year"</span>) <span class="co">///</span></span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>    <span class="bn">caption</span>(<span class="st">"Estimates and 95% CI from Event Study"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>mcaid.data <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"../files/data/acs/acs_medicaid.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 416 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (1): State
dbl  (8): year, adult_pop, ins_employer, ins_direct, ins_medicare, ins_medic...
lgl  (2): expand_ever, expand
date (1): date_adopted

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> mcaid.data <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(expand_year<span class="sc">==</span><span class="dv">2014</span> <span class="sc">|</span> <span class="fu">is.na</span>(expand_year), <span class="sc">!</span><span class="fu">is.na</span>(expand_ever)) <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_unins=</span>uninsured<span class="sc">/</span>adult_pop,</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">post =</span> (year<span class="sc">&gt;=</span><span class="dv">2014</span>), </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat=</span>post<span class="sc">*</span>expand_ever)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>mod.twfe <span class="ot">&lt;-</span> <span class="fu">feols</span>(perc_unins<span class="sc">~</span><span class="fu">i</span>(year, expand_ever, <span class="at">ref=</span><span class="dv">2013</span>) <span class="sc">|</span> State <span class="sc">+</span> year,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cluster=</span><span class="sc">~</span>State,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>reg.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="common-treatment-timing" class="level2">
<h2 class="anchored" data-anchor-id="common-treatment-timing">Common treatment timing</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iplot</span>(mod.twfe, </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">'Time to treatment'</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">'Event study'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="class9_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="differential-treatment-timing" class="level2">
<h2 class="anchored" data-anchor-id="differential-treatment-timing">Differential treatment timing</h2>
<ul>
<li>Now let’s work with the full Medicaid expansion data</li>
<li>Includes late adopters</li>
<li>Requires putting observations on “event time”</li>
</ul>
<hr>
</section>
<section id="differential-treatment-timing-1" class="level2">
<h2 class="anchored" data-anchor-id="differential-treatment-timing-1">Differential treatment timing</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install reghdfe</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="kw">insheet</span> <span class="kw">using</span> <span class="st">"data/acs_medicaid.txt"</span>, <span class="kw">clear</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> perc_unins=uninsured/adult_pop</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> expand_ever==<span class="st">"NA"</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> expand_year=<span class="st">"."</span> <span class="kw">if</span> expand_year==<span class="st">"NA"</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="kw">destring</span> expand_year, <span class="kw">replace</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> event_time=<span class="fu">year</span>-expand_year</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> event_time=-1 <span class="kw">if</span> event_time==.</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> <span class="ot">l</span> = 0/4 {</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> L<span class="ot">`l'</span>event = (event_time==<span class="ot">`l'</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> <span class="ot">l</span> = 1/2 {</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> F<span class="ot">`l'</span>event = (event_time==-<span class="ot">`l'</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> F3event=(event_time&lt;=-3)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>reghdfe perc_unins F3event F2event L0event L1event L2event L3event L4event, absorb(state <span class="fu">year</span>) <span class="kw">cluster</span>(state)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> coef = .</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> se = .</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 2(1)3 {</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> coef = _b[F<span class="ot">`i'</span>event] <span class="kw">if</span> F<span class="ot">`i'</span>event==1</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> se = _se[F<span class="ot">`i'</span>event] <span class="kw">if</span> F<span class="ot">`i'</span>event==1</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> i = 0(1)4 {</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> coef = _b[L<span class="ot">`i'</span>event] <span class="kw">if</span> L<span class="ot">`i'</span>event==1</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    <span class="kw">replace</span> se = _se[L<span class="ot">`i'</span>event] <span class="kw">if</span> L<span class="ot">`i'</span>event==1</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> coef = 0 <span class="kw">if</span> F1event==1</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> se=0 <span class="kw">if</span> F1event==1</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>* Make confidence intervals</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> ci_top = coef+1.96*se</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> ci_bottom = coef - 1.96*se</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>* Limit ourselves to one observation per <span class="fu">year</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> event_time&gt;=-3 &amp; event_time&lt;=4</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> event_time coef se ci_*</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a><span class="kw">duplicates</span> <span class="kw">drop</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>* Create connected scatterplot <span class="kw">of</span> coefficients</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>* with CIs included with rcap </span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>* and a <span class="kw">line</span> <span class="fu">at</span> 0 from <span class="kw">function</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> event_time</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a><span class="kw">twoway</span> (<span class="kw">sc</span> coef event_time, <span class="kw">connect</span>(<span class="kw">line</span>)) (rcap ci_top ci_bottom event_time) <span class="co">///</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">function</span> <span class="fu">y</span> = 0, <span class="kw">range</span>(-3 4)), <span class="bn">xtitle</span>(<span class="st">"Time"</span>) <span class="co">///</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>    <span class="bn">caption</span>(<span class="st">"Estimates and 95% CI from Event Study"</span>) <span class="kw">xlabel</span>(-3(1)4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>mcaid.data <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"../files/data/acs/acs_medicaid.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 416 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (1): State
dbl  (8): year, adult_pop, ins_employer, ins_direct, ins_medicare, ins_medic...
lgl  (2): expand_ever, expand
date (1): date_adopted

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> mcaid.data <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(expand_ever)) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_unins=</span>uninsured<span class="sc">/</span>adult_pop,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">post =</span> (year<span class="sc">&gt;=</span><span class="dv">2014</span>), </span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat=</span>post<span class="sc">*</span>expand_ever,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_to_treat =</span> <span class="fu">ifelse</span>(expand_ever<span class="sc">==</span><span class="cn">FALSE</span>, <span class="dv">0</span>, year<span class="sc">-</span>expand_year),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_to_treat =</span> <span class="fu">ifelse</span>(time_to_treat <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, time_to_treat))</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>mod.twfe <span class="ot">&lt;-</span> <span class="fu">feols</span>(perc_unins<span class="sc">~</span><span class="fu">i</span>(time_to_treat, expand_ever, <span class="at">ref=</span><span class="sc">-</span><span class="dv">1</span>) <span class="sc">|</span> State <span class="sc">+</span> year,</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cluster=</span><span class="sc">~</span>State,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>reg.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="differential-treatment-timing-2" class="level2">
<h2 class="anchored" data-anchor-id="differential-treatment-timing-2">Differential treatment timing</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iplot</span>(mod.twfe, </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">'Time to treatment'</span>,</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">'Event study'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="class9_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="problems-with-twfe" class="level2">
<h2 class="anchored" data-anchor-id="problems-with-twfe">Problems with TWFE</h2>
<ul>
<li>Recall goal of estimating ATE or ATT</li>
<li>TWFE and 2x2 DD identical with homogeneous effects and common treatment timing</li>
<li>Otherwise…TWFE is biased and inconsistent for ATT</li>
</ul>
<p>Consider standard TWFE specification with a single treatment coefficient, <span class="math display">\[y_{it} = \alpha + \delta D_{it} + \gamma_{i} + \gamma_{t} + \varepsilon_{it}.\]</span> We can decompose <span class="math inline">\(\hat{\delta}\)</span> into three things:</p>
<p><span class="math display">\[\hat{\delta}_{twfe} = \text{VW} ATT + \text{VW} PT - \Delta ATT\]</span></p>
<ol type="1">
<li>A variance-weighted ATT</li>
<li>Violation of parallel trends</li>
<li>Heterogeneous effects over time</li>
</ol>
<hr>
</section>
<section id="intuition" class="level2">
<h2 class="anchored" data-anchor-id="intuition">Intuition</h2>
<p><strong>Problems come from heterogeneous effects and staggered treatment timing</strong></p>
<ul>
<li>OLS is a weighted average of all 2x2 DD groups</li>
<li>Weights are function of size of subsamples, size of treatment/control units, and timing of treatment</li>
<li>Units treated in middle of sample receive larger weights</li>
<li><strong>Best case:</strong> Variance-weighted ATT</li>
<li>Prior-treated units act as controls for late-treated units, so differential timing <strong>alone</strong> can introduce bias</li>
<li>Heterogeneity and differential timing introduces “contamination” via negative weights assigned to some underlying 2x2 DDs</li>
</ul>
<hr>
</section>
<section id="does-it-really-matter" class="level2">
<h2 class="anchored" data-anchor-id="does-it-really-matter">Does it really matter?</h2>
<ul>
<li>Definitely! But how much?</li>
<li>Large treatment effects for early treated units could reverse the sign of final estimate</li>
<li>Let’s explore this nice Shiny app from Kyle Butts: <a href="https://hhsievertsen.shinyapps.io/kylebutts_did_eventstudy/">Bacon-Decomposition Shiny App</a>.</li>
</ul>
</section>
</section>
<section id="diference-in-differences-today" class="level1">
<h1>Diference-in-Differences Today</h1>
<hr>
<section id="solution" class="level2">
<h2 class="anchored" data-anchor-id="solution">Solution</h2>
<p>Only consider “clean” comparisons:</p>
<ul>
<li>Separate event study for each treatment group vs never-treated or not-yet-treated</li>
<li>Callaway and Sant’Anna (2020)</li>
<li>Sun and Abraham (2020)</li>
<li>de Chaisemartin and D’Haultfoeuille (2020)</li>
<li>Stacking regression: Cengiz et al.&nbsp;(2019)</li>
<li>Imputation: Gardner (2021), and Borusyak et al.&nbsp;(2021)</li>
</ul>
<hr>
</section>
<section id="changing-mindset-for-estimation" class="level2">
<h2 class="anchored" data-anchor-id="changing-mindset-for-estimation">Changing mindset for estimation</h2>
<ol type="1">
<li>Define target parameter (e.g., ATT)…this is pretty new as a starting point</li>
<li>Identification</li>
<li>Estimation</li>
<li>Aggregation</li>
<li>Inference</li>
</ol>
<hr>
</section>
<section id="incorporating-covariates" class="level2">
<h2 class="anchored" data-anchor-id="incorporating-covariates">Incorporating covariates</h2>
<ul>
<li>“Easy” to do in regression setting, but risks of using outcomes as controls</li>
<li>Two general ways:
<ol type="1">
<li>Outcome regression (imputation-based)</li>
<li>Propensity score</li>
</ol></li>
</ul>
<hr>
</section>
<section id="outcome-regression-heckman-et-al-1997" class="level2">
<h2 class="anchored" data-anchor-id="outcome-regression-heckman-et-al-1997">Outcome regression (Heckman et al 1997)</h2>
<p><span class="math display">\[\small \hat{\delta}^{reg} = E[Y_{t=1}|D=1] - \left[ E[Y_{t=0}|D=1] + \frac{1}{n^{T}} \sum_{i \in N_{d=1}} \left(\hat{\mu}_{d=0, t=1}(X_{i}) - \hat{\mu}_{d=0, t=0}(X_{i})\right) \right],\]</span></p>
<p>where <span class="math inline">\(\hat{\mu}_{d,t}\)</span> is the prediction from a regression among the untreated group using baseline covariates.</p>
<ul>
<li>Heckman forms prediction as regression of <span class="math inline">\(\Delta Y\)</span> on <span class="math inline">\(X_{i}\)</span> among untreated group, although could also consider separate regressions on levels</li>
<li>Conceptually…take observed value among treatment group in post-period, subtract pre-period value and the predicted trend</li>
</ul>
<hr>
</section>
<section id="ipw-abadie-2005" class="level2">
<h2 class="anchored" data-anchor-id="ipw-abadie-2005">IPW (Abadie, 2005)</h2>
<p><span class="math display">\[\hat{\delta}^{ipw} = E \left[\frac{D - \hat{p}(D=1|X)}{1-\hat{p}(D=1|X)} \frac{Y_{t=1} - Y_{t=0}}{P(D=1)} \right]\]</span></p>
<ul>
<li><span class="math inline">\(Y_{t=1}\)</span> is the observed outcome at time <span class="math inline">\(t=1\)</span>, and similarly for <span class="math inline">\(Y_{t=0}\)</span></li>
<li><span class="math inline">\(\hat{p}\)</span> denotes the estimated propensity score from regression of <span class="math inline">\(D\)</span> on <span class="math inline">\(X\)</span> in pre-period</li>
<li>Conceptually…upweight change among treated that look a lot like the control group, downweight change among treated that look different than controls</li>
</ul>
<hr>
</section>
<section id="dr-santanna-and-zhou" class="level2">
<h2 class="anchored" data-anchor-id="dr-santanna-and-zhou">DR (Sant’Anna and Zhou)</h2>
<p><span class="math display">\[\scriptsize \hat{\delta}^{dr} = E \left[ \left(\frac{D}{P(D=1)} - \frac{\frac{\hat{p}(X)(1-D)}{1-\hat{p}(X)}}{E\left[\frac{\hat{p}(X)(1-D)}{1-\hat{p}(X)} \right]} \right) \left(E[Y_{t=1}|D=1] - E[Y_{t=0}|D=1] - \Delta \hat{\mu}_{0}(X)\right) \right]\]</span></p>
<ul>
<li>Notice how this combines Heckman’s outcome regression in the second part and Abadie’s IPW in the first part</li>
</ul>
<hr>
</section>
<section id="the-new-dd" class="level2">
<h2 class="anchored" data-anchor-id="the-new-dd">The New DD</h2>
<p>I’ll organize this into three types of estimators:</p>
<ol type="1">
<li>Group-time comparisons (GT)</li>
<li>Stacked</li>
<li>Imputation</li>
</ol>
<hr>
</section>
<section id="gt1-callaway-and-santanna" class="level2">
<h2 class="anchored" data-anchor-id="gt1-callaway-and-santanna">GT1: Callaway and Sant’Anna</h2>
<ul>
<li>“Manually” estimate group-specific treatment effects for each period</li>
<li>Each estimate is propensity-score weighted</li>
<li>Aggregate the treatment effect estimates (by time, group, or both)</li>
</ul>
<hr>
</section>
<section id="gt1-cs-estimator-more-formally" class="level2">
<h2 class="anchored" data-anchor-id="gt1-cs-estimator-more-formally">GT1: CS Estimator (More Formally)</h2>
<p>Group-specific treatment effects:</p>
<p><span class="math display">\[ATT(g,t) = E[Y_{1,t} - Y_{0,t} | G_{g}=1],\]</span> where <span class="math inline">\(G\)</span> denotes all feasible groups or cohorts (e.g., <span class="math inline">\(g=1\)</span> could mean states expanding in 2014, <span class="math inline">\(g=2\)</span> denotes states expanding in 2015, etc.)</p>
<hr>
</section>
<section id="gt1-cs-estimator-more-formally-1" class="level2">
<h2 class="anchored" data-anchor-id="gt1-cs-estimator-more-formally-1">GT1: CS Estimator (More Formally)</h2>
<p>With this <span class="math inline">\((g,t)\)</span> notation, CS show:</p>
<p><span class="math display">\[\scriptsize ATT(g,t; \tau)^{DR} = E \left[ \left(\frac{G_{g}}{P(G_{g}=1)} - \frac{\frac{\hat{p}_{g}(X)C}{1-\hat{p}_{g}(X)}}{E\left[\frac{\hat{p}_{g}(X)C}{1-\hat{p}_{g}(X)} \right]} \right) \left(E[Y_{t}|G_{g}=1] - E[Y_{g-\tau-1}|G_{g}=1] - \Delta \hat{\mu}_{g,t,\tau}(X)\right) \right]\]</span></p>
<ul>
<li><span class="math inline">\(\tau\)</span> denotes time from treatment, such that <span class="math inline">\(Y_{g - \tau - 1}\)</span> denotes the outcome for some reference time period, <span class="math inline">\(t=g - \tau -1\)</span></li>
<li><span class="math inline">\(\Delta \hat{\mu}\)</span> captures the predicted change from an outcome regression</li>
<li><span class="math inline">\(\hat{p}_{g}\)</span> denotes the predicted probability of being in the treatment cohort <span class="math inline">\(g\)</span></li>
</ul>
<hr>
</section>
<section id="gt1-cs-estimator-more-formally-2" class="level2">
<h2 class="anchored" data-anchor-id="gt1-cs-estimator-more-formally-2">GT1: CS Estimator (More Formally)</h2>
<ul>
<li>CS show a similar version of their estimator using a “not-yet-treated” control group rather than a never-treated.</li>
<li>Different versions include…
<ul>
<li>“regression” based: drop the propensity score part</li>
<li>“IPW”: drop <span class="math inline">\(\Delta \hat{\mu}\)</span></li>
</ul></li>
<li>Only time-invariant covariates allowed</li>
</ul>
<hr>
</section>
<section id="gt1-cs-estimator-more-formally-3" class="level2">
<h2 class="anchored" data-anchor-id="gt1-cs-estimator-more-formally-3">GT1: CS Estimator (More Formally)</h2>
<p>Finally, aggregate all of the <span class="math inline">\((g,t)\)</span> treatment effects:</p>
<p><span class="math display">\[\hat{\delta} = \sum_{g \in \mathcal{G}} \sum_{t=2}^{\mathcal{T}} w(g,t) \times ATT(g,t)\]</span></p>
<hr>
</section>
<section id="gt1-cs-estimator-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="gt1-cs-estimator-in-practice">GT1: CS Estimator (in Practice)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install csdid</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install event_plot</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install drdid</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="kw">insheet</span> <span class="kw">using</span> <span class="st">"data/acs_medicaid.txt"</span>, <span class="kw">clear</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> perc_unins=uninsured/adult_pop</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> stategroup=<span class="fu">group</span>(state)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> expand_ever==<span class="st">"NA"</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> expand_year=<span class="st">"0"</span> <span class="kw">if</span> expand_year==<span class="st">"NA"</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="kw">destring</span> expand_year, <span class="kw">replace</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>csdid perc_unins, ivar(stategroup) time(<span class="fu">year</span>) gvar(expand_year) notyet</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> event, estore(<span class="kw">cs</span>)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>event_plot <span class="kw">cs</span>, default_look graph_opt(<span class="bn">xtitle</span>(<span class="st">"Periods since the event"</span>) <span class="bn">ytitle</span>(<span class="st">"Average causal effect"</span>) <span class="kw">xlabel</span>(-6(1)4) <span class="bn">title</span>(<span class="st">"Callaway and Sant'Anna (2020)"</span>)) stub_lag(T+#) stub_lead(T-#) together</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(did)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DRDID)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>mcaid.data <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"../files/data/acs/acs_medicaid.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 416 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (1): State
dbl  (8): year, adult_pop, ins_employer, ins_direct, ins_medicare, ins_medic...
lgl  (2): expand_ever, expand
date (1): date_adopted

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> mcaid.data <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(expand_ever)) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_unins=</span>uninsured<span class="sc">/</span>adult_pop,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">post =</span> (year<span class="sc">&gt;=</span><span class="dv">2014</span>), </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat=</span>post<span class="sc">*</span>expand_ever,</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">expand_year=</span><span class="fu">ifelse</span>(<span class="fu">is.na</span>(expand_year),<span class="dv">0</span>,expand_year)) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(perc_unins)) <span class="sc">%&gt;%</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">%&gt;%</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stategroup=</span><span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>mod.cs <span class="ot">&lt;-</span> <span class="fu">att_gt</span>(<span class="at">yname=</span><span class="st">"perc_unins"</span>, <span class="at">tname=</span><span class="st">"year"</span>, <span class="at">idname=</span><span class="st">"stategroup"</span>,</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>                 <span class="at">gname=</span><span class="st">"expand_year"</span>,</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data=</span>reg.dat, <span class="at">panel=</span><span class="cn">TRUE</span>, <span class="at">est_method=</span><span class="st">"dr"</span>,</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">allow_unbalanced_panel=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in pre_process_did(yname = yname, tname = tname, idname = idname, : Be aware that there are some small groups in your dataset.
  Check groups: 2015,2016,2019.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in att_gt(yname = "perc_unins", tname = "year", idname = "stategroup",
: Not returning pre-test Wald statistic due to singular covariance matrix</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>mod.cs.event <span class="ot">&lt;-</span> <span class="fu">aggte</span>(mod.cs, <span class="at">type=</span><span class="st">"dynamic"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="cs-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="cs-in-practice">CS in Practice</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdid</span>(mod.cs.event,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="class9_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="gt2-sun-and-abraham" class="level2">
<h2 class="anchored" data-anchor-id="gt2-sun-and-abraham">GT2: Sun and Abraham</h2>
<ul>
<li>Standard event study problems:
<ul>
<li>coefficient estimates are potentially biased due to treatment/control group construction</li>
<li>i.e., “contamination” of individual <span class="math inline">\(\delta_{\tau}\)</span> from other leads/lags</li>
</ul></li>
<li>Solution: Estimate fully interacted model</li>
</ul>
<div class="fragment">
<p><span class="math display">\[y_{it} = \gamma_{i} + \gamma_{t} + \sum_{g} \sum_{\tau \neq -1} \delta_{g \tau} \times \text{1}(i \in C_{g}) \times D_{it}^{\tau} + \beta x_{it} + \epsilon_{it}\]</span></p>
</div>
<hr>
</section>
<section id="gt2-sun-and-abraham-1" class="level2">
<h2 class="anchored" data-anchor-id="gt2-sun-and-abraham-1">GT2: Sun and Abraham</h2>
<p><span class="math display">\[y_{it} = \gamma_{i} + \gamma_{t} + \sum_{g} \sum_{\tau \neq -1} \delta_{g \tau} \times \text{1}(i \in C_{g}) \times D_{it}^{\tau} + \beta x_{it} + \epsilon_{it}\]</span></p>
<div class="fragment">
<ul>
<li><span class="math inline">\(g\)</span> denotes a group and <span class="math inline">\(C_{g}\)</span> the set of individuals in group <span class="math inline">\(g\)</span></li>
<li><span class="math inline">\(\tau\)</span> denotes time periods</li>
<li><span class="math inline">\(D_{it}^{\tau}\)</span> denotes a relative time indicator</li>
</ul>
</div>
<hr>
</section>
<section id="gt2-sun-and-abraham-2" class="level2">
<h2 class="anchored" data-anchor-id="gt2-sun-and-abraham-2">GT2: Sun and Abraham</h2>
<p><span class="math display">\[y_{it} = \gamma_{i} + \gamma_{t} + \sum_{g} \sum_{\tau \neq -1} \delta_{g \tau} \times \text{1}(i \in C_{g}) \times D_{it}^{\tau} + \beta x_{it} + \epsilon_{it}\]</span></p>
<div class="fragment">
<ul>
<li>Intuition: Standard regression with different event study specifications for each treatment group</li>
<li>Aggregate <span class="math inline">\(\delta_{g\tau}\)</span> for standard event study coefficients and overall ATT</li>
</ul>
</div>
<hr>
</section>
<section id="gt2-sun-and-abraham-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="gt2-sun-and-abraham-in-practice">GT2: Sun and Abraham in Practice</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install eventstudyinteract</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install avar</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install event_plot</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="kw">insheet</span> <span class="kw">using</span> <span class="st">"data/acs_medicaid.txt"</span>, <span class="kw">clear</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> perc_unins=uninsured/adult_pop</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> expand_ever==<span class="st">"NA"</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> stategroup=<span class="fu">group</span>(state)</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> expand_year=<span class="st">"."</span> <span class="kw">if</span> expand_year==<span class="st">"NA"</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="kw">destring</span> expand_year, <span class="kw">replace</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> event_time=<span class="fu">year</span>-expand_year</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> nevertreated=(event_time==.)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> <span class="ot">l</span> = 0/4 {</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> L<span class="ot">`l'</span>event = (event_time==<span class="ot">`l'</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="kw">forvalues</span> <span class="ot">l</span> = 1/2 {</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">gen</span> F<span class="ot">`l'</span>event = (event_time==-<span class="ot">`l'</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> F3event=(event_time&lt;=-3)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>eventstudyinteract perc_unins F3event F2event L0event L1event L2event L3event L4event, <span class="kw">vce</span>(<span class="kw">cluster</span> stategroup) absorb(stategroup <span class="fu">year</span>) cohort(expand_year) control_cohort(nevertreated)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>event_plot <span class="fu">e</span>(b_iw)#e(V_iw), default_look graph_opt(<span class="bn">xtitle</span>(<span class="st">"Periods since the event"</span>) <span class="bn">ytitle</span>(<span class="st">"Average causal effect"</span>) <span class="kw">xlabel</span>(-3(1)4) <span class="bn">title</span>(<span class="st">"Sun and Abraham (2020)"</span>)) stub_lag(L#event) stub_lead(F#event) plottype(<span class="kw">scatter</span>) ciplottype(rcap) together</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>mcaid.data <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"../files/data/acs/acs_medicaid.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 416 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (1): State
dbl  (8): year, adult_pop, ins_employer, ins_direct, ins_medicare, ins_medic...
lgl  (2): expand_ever, expand
date (1): date_adopted

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> mcaid.data <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(expand_ever)) <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_unins=</span>uninsured<span class="sc">/</span>adult_pop,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">post =</span> (year<span class="sc">&gt;=</span><span class="dv">2014</span>), </span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat=</span>post<span class="sc">*</span>expand_ever,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">expand_year =</span> <span class="fu">ifelse</span>(expand_ever<span class="sc">==</span><span class="cn">FALSE</span>, <span class="dv">10000</span>, expand_year),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_to_treat =</span> <span class="fu">ifelse</span>(expand_ever<span class="sc">==</span><span class="cn">FALSE</span>, <span class="sc">-</span><span class="dv">1</span>, year<span class="sc">-</span>expand_year),</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_to_treat =</span> <span class="fu">ifelse</span>(time_to_treat <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">4</span>, <span class="sc">-</span><span class="dv">4</span>, time_to_treat))</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>mod.sa <span class="ot">&lt;-</span> <span class="fu">feols</span>(perc_unins<span class="sc">~</span><span class="fu">sunab</span>(expand_year, time_to_treat) <span class="sc">|</span> State <span class="sc">+</span> year,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cluster=</span><span class="sc">~</span>State,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>reg.dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="sun-and-abraham-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="sun-and-abraham-in-practice">Sun and Abraham in Practice</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iplot</span>(mod.sa,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlab =</span> <span class="st">'Time to treatment'</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">'SA Event study'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="class9_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="gt3-de-chaisemartin-and-dhaultfoeuille-ch" class="level2">
<h2 class="anchored" data-anchor-id="gt3-de-chaisemartin-and-dhaultfoeuille-ch">GT3: de Chaisemartin and D’Haultfoeuille (CH)</h2>
<ul>
<li>More general than other approaches</li>
<li>Considers “fuzzy” treatment (i.e., non-discrete treatment)</li>
<li>Considers fixed effects and first-differencing</li>
<li>Allows treatment to turn on and off (not allowed in CS or SA)</li>
</ul>
<div class="fragment">
<p>New paper from Callaway, Goodman-Bacon, and Sant’Anna also looks at DD with continuous treatment</p>
</div>
<hr>
</section>
<section id="gt3-ch-approach" class="level2">
<h2 class="anchored" data-anchor-id="gt3-ch-approach">GT3: CH Approach</h2>
<ul>
<li>Essentially a series of 2x2 comparisons</li>
<li>Aggregates up to overall effects</li>
</ul>
<hr>
</section>
<section id="ch-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="ch-in-practice">CH in Practice</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install did_multiplegt</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install event_plot</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="kw">insheet</span> <span class="kw">using</span> <span class="st">"data/acs_medicaid.txt"</span>, <span class="kw">clear</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> perc_unins=uninsured/adult_pop</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> expand_ever==<span class="st">"NA"</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="kw">egen</span> stategroup=<span class="fu">group</span>(state)</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> expand_year=<span class="st">"."</span> <span class="kw">if</span> expand_year==<span class="st">"NA"</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="kw">destring</span> expand_year, <span class="kw">replace</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> event_time=<span class="fu">year</span>-expand_year</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> nevertreated=(event_time==.)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> treat=(event_time&gt;=0 &amp; event_time!=.)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>did_multiplegt perc_unins stategroup <span class="fu">year</span> treat, robust_dynamic dynamic(4) placebo(3) breps(100) <span class="kw">cluster</span>(stategroup) </span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>event_plot <span class="fu">e</span>(<span class="kw">estimates</span>)#e(variances), default_look graph_opt(<span class="bn">xtitle</span>(<span class="st">"Periods since the event"</span>) <span class="bn">ytitle</span>(<span class="st">"Average causal effect"</span>) <span class="co">///</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="bn">title</span>(<span class="st">"de Chaisemartin and D'Haultfoeuille (2020)"</span>) <span class="kw">xlabel</span>(-3(1)4)) stub_lag(Effect_#) stub_lead(Placebo_#) together</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column" style="width:50%;">
<p><strong>R</strong>(not the same as in <strong>Stata</strong>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DIDmultiplegt)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>mcaid.data <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"../files/data/acs/acs_medicaid.txt"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> mcaid.data <span class="sc">%&gt;%</span> </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(expand_ever)) <span class="sc">%&gt;%</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_unins=</span>uninsured<span class="sc">/</span>adult_pop,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat=</span><span class="fu">case_when</span>(</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>           expand_ever<span class="sc">==</span><span class="cn">FALSE</span> <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>           expand_ever<span class="sc">==</span><span class="cn">TRUE</span> <span class="sc">&amp;</span> expand_year<span class="sc">&lt;</span>year <span class="sc">~</span> <span class="dv">0</span>,</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>           expand_ever<span class="sc">==</span><span class="cn">TRUE</span> <span class="sc">&amp;</span> expand_year<span class="sc">&gt;=</span>year <span class="sc">~</span> <span class="dv">1</span>))</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>mod.ch <span class="ot">&lt;-</span> <span class="fu">did_multiplegt</span>(<span class="at">df=</span>reg.dat, <span class="at">Y=</span><span class="st">"perc_unins"</span>, <span class="at">G=</span><span class="st">"State"</span>, <span class="at">T=</span><span class="st">"year"</span>, <span class="at">D=</span><span class="st">"treat"</span>,</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">placebo=</span><span class="dv">4</span>, <span class="at">dynamic=</span><span class="dv">5</span>, <span class="at">brep=</span><span class="dv">50</span>, <span class="at">cluster=</span><span class="st">'State'</span>, <span class="at">covariance=</span><span class="cn">TRUE</span>, </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">average_effect=</span><span class="st">"simple"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="ch-in-practice-1" class="level2">
<h2 class="anchored" data-anchor-id="ch-in-practice-1">CH in Practice</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a tidier for "multiplegt" objects</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>tidy.did_multiplegt <span class="ot">=</span> <span class="cf">function</span>(x, <span class="at">level =</span> <span class="fl">0.95</span>) {</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  ests <span class="ot">=</span> x[<span class="fu">grepl</span>(<span class="st">"^placebo_|^effect|^dynamic_"</span>, <span class="fu">names</span>(x))]</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">term      =</span> <span class="fu">names</span>(ests),</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">estimate  =</span> <span class="fu">as.numeric</span>(ests),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">std.error =</span> <span class="fu">as.numeric</span>(x[<span class="fu">grepl</span>(<span class="st">"^se_placebo|^se_effect|^se_dynamic"</span>, <span class="fu">names</span>(x))]),</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">N         =</span> <span class="fu">as.numeric</span>(x[<span class="fu">grepl</span>(<span class="st">"^N_placebo|^N_effect|^N_dynamic"</span>, <span class="fu">names</span>(x))])</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For CIs we'll assume standard normal distribution</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">within</span>({</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>      conf.low  <span class="ot">=</span> estimate <span class="sc">-</span> std.error<span class="sc">*</span>(<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>(<span class="dv">1</span><span class="sc">-</span>level)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>      conf.high <span class="ot">=</span> estimate <span class="sc">+</span> std.error<span class="sc">*</span>(<span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>(<span class="dv">1</span><span class="sc">-</span>level)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret)</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>tidy.mod.ch <span class="ot">&lt;-</span> <span class="fu">tidy.did_multiplegt</span>(mod.ch)</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_family =</span> <span class="st">"ArialNarrow"</span>)) <span class="co"># Optional</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>tidy.mod.ch <span class="sc">|&gt;</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">within</span>({</span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>    term <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"^placebo_"</span>, <span class="st">"-"</span>, term)</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>    term <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"^effect"</span>, <span class="st">"0"</span>, term)</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>    term <span class="ot">=</span> <span class="fu">gsub</span>(<span class="st">"^dynamic_"</span>, <span class="st">""</span>, term)</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>    term <span class="ot">=</span> <span class="fu">as.integer</span>(term)</span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">|&gt;</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> term, <span class="at">y =</span> estimate, <span class="at">ymin =</span> conf.low, <span class="at">ymax =</span> conf.high)) <span class="sc">+</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>() <span class="sc">+</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Time to treatment"</span>, <span class="at">y =</span> <span class="st">"Effect size"</span>, <span class="at">title =</span> <span class="st">"CH Event-study plot"</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
<section id="ch-in-practice-2" class="level2">
<h2 class="anchored" data-anchor-id="ch-in-practice-2">CH in practice</h2>
<p>Some barriers to this estimator in practice (at least, as implemented in <code>R</code> right now)</p>
<ul>
<li>Relatively slow</li>
<li>Not user friendly</li>
<li>Odd results</li>
</ul>
<hr>
</section>
<section id="cengiz-et-al.-2019-stacked-regression" class="level2">
<h2 class="anchored" data-anchor-id="cengiz-et-al.-2019-stacked-regression">Cengiz et al.&nbsp;(2019): Stacked regression</h2>
<ul>
<li>“Stacked” event studies</li>
<li>Estimate event study for every treatment group, using never-treated as controls</li>
<li>Aggregate to overall average effects</li>
</ul>
<hr>
</section>
<section id="cengiz-et-al.-2019" class="level2">
<h2 class="anchored" data-anchor-id="cengiz-et-al.-2019">Cengiz et al.&nbsp;(2019)</h2>
<ol type="1">
<li>Define event window, <span class="math inline">\(t\in [\kappa_{a}, \kappa_{b}]\)</span> (e.g., 3 pre-periods and 5 post-periods, <span class="math inline">\(\kappa_{a}=3\)</span> and <span class="math inline">\(\kappa_{b}=5\)</span>)</li>
<li>Split the data into <span class="math inline">\(g=1,...,G\)</span> different “groups”, as defined by treatment cohort, each with adoption date denoted by <span class="math inline">\(\omega_{g}\)</span>
<ul>
<li>observations outside of the <span class="math inline">\([\omega_{g} - \kappa_{a}, \omega_{g} + \kappa_{b}]\)</span> interval are dropped</li>
</ul></li>
<li>Append (i.e., stack) each <span class="math inline">\(g\)</span>th dataset</li>
<li>Run stacked event study allowing for different set of event study coefficients and fixed effects for every group <span class="math inline">\(g\)</span></li>
</ol>
<p><span class="math display">\[y_{itg} = \sum_{\tau=-\kappa_{a}}^{\kappa_{b}} \delta_{\tau} \times D_{ig} \times 1(t-\omega_{g} = \tau) + \gamma_{ig} + \gamma_{\tau g} + \varepsilon_{itg}\]</span></p>
<hr>
</section>
<section id="cengiz-et-al.-2019-1" class="level2">
<h2 class="anchored" data-anchor-id="cengiz-et-al.-2019-1">Cengiz et al.&nbsp;(2019)</h2>
<ul>
<li>Intuitively: run event study on every cohort, <span class="math inline">\(g\)</span></li>
<li>Control units (never treated or very late treated) will be duplicated over cohorts</li>
<li>Need to cluster at the unit or unit/cohort level (probably unit level otherwise not accounting for duplication)</li>
<li><strong>Alternative:</strong> Among controls included in multiple cohorts, randomly assign them to one cohort</li>
</ul>
<hr>
</section>
<section id="quick-comparison" class="level2">
<h2 class="anchored" data-anchor-id="quick-comparison">Quick comparison</h2>
<ul>
<li>Allows time-varying covariates</li>
<li>Inference is less clear</li>
<li>Likely estimating some variance-weighted ATT…not clear what those weights are anymore</li>
<li>Seemingly stronger parallel trends assumptions for each cohort</li>
</ul>
<hr>
</section>
<section id="imputation-estimators" class="level2">
<h2 class="anchored" data-anchor-id="imputation-estimators">Imputation estimators</h2>
<ol type="1">
<li>Estimate group and time fixed effects via first stage regression only among non-treated units</li>
<li>Predict outcome for all observations and residualize</li>
<li>Run standard event study specification on residualized outcome variable</li>
</ol>
<p>Note: Estimate with GMM to account for first-stage prediction</p>
<hr>
</section>
<section id="gardner-2021" class="level2">
<h2 class="anchored" data-anchor-id="gardner-2021">Gardner (2021)</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<p><code>did2s</code></p>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(did2s)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>did2s (v1.0.2). For more information on the methodology, visit &lt;https://www.kylebutts.github.io/did2s&gt;

To cite did2s in publications use:

  Butts, Kyle (2021).  did2s: Two-Stage Difference-in-Differences
  Following Gardner (2021). R package version 1.0.2.

A BibTeX entry for LaTeX users is

  @Manual{,
    title = {did2s: Two-Stage Difference-in-Differences Following Gardner (2021)},
    author = {Kyle Butts},
    year = {2021},
    url = {https://github.com/kylebutts/did2s/},
  }</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'did2s'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:causaldata':

    castle</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>mcaid.data <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"../files/data/acs/acs_medicaid.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 416 Columns: 12</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (1): State
dbl  (8): year, adult_pop, ins_employer, ins_direct, ins_medicare, ins_medic...
lgl  (2): expand_ever, expand
date (1): date_adopted

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> mcaid.data <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(expand_ever)) <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_unins=</span>uninsured<span class="sc">/</span>adult_pop,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">post =</span> (year<span class="sc">&gt;=</span><span class="dv">2014</span>), </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat=</span>post<span class="sc">*</span>expand_ever,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">expand_year =</span> <span class="fu">ifelse</span>(expand_ever<span class="sc">==</span><span class="cn">FALSE</span>, <span class="dv">10000</span>, expand_year),</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_to_treat =</span> <span class="fu">ifelse</span>(expand_ever<span class="sc">==</span><span class="cn">FALSE</span>, <span class="sc">-</span><span class="dv">1</span>, year<span class="sc">-</span>expand_year),</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_to_treat =</span> <span class="fu">ifelse</span>(time_to_treat <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, time_to_treat))</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>mod<span class="fl">.2</span>s <span class="ot">&lt;-</span> <span class="fu">did2s</span>(reg.dat, <span class="at">yname=</span><span class="st">"perc_unins"</span>, </span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">treatment=</span><span class="st">"treat"</span>, </span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">first_stage =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">|</span> State <span class="sc">+</span> year,</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">second_stage =</span> <span class="sc">~</span><span class="fu">i</span>(time_to_treat, <span class="at">ref=</span><span class="sc">-</span><span class="dv">1</span>),</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">cluster_var=</span><span class="st">"State"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Running Two-stage Difference-in-Differences
 - first stage formula `~ 0 | State + year`
 - second stage formula `~ i(time_to_treat, ref = -1)`
 - The indicator variable that denotes when treatment is on is `treat`
 - Standard errors will be clustered by `State`</code></pre>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="gardner-2021-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="gardner-2021-in-practice">Gardner (2021) in Practice</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">iplot</span>(mod<span class="fl">.2</span>s, <span class="at">main=</span><span class="st">"2SDID Event Study"</span>, <span class="at">xlab=</span><span class="st">"Event time"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="class9_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="borusyak-et-al.-2021" class="level2">
<h2 class="anchored" data-anchor-id="borusyak-et-al.-2021">Borusyak et al.&nbsp;(2021)</h2>
<ul>
<li>Estimate regression only for untreated observations</li>
<li>Predicted untreated outcome among the treated observations and take the difference</li>
<li>Aggregate differences to form overall weighted average effect</li>
</ul>
<hr>
</section>
<section id="borusyak-et-al.-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="borusyak-et-al.-in-practice">Borusyak et al.&nbsp;in practice</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Stata</strong></p>
<p><code>did_imputation</code></p>
</div><div class="column" style="width:50%;">
<p><strong>R</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(didimputation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: data.table</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'data.table'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:plm':

    between</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:zoo':

    yearmon, yearqtr</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:lubridate':

    hour, isoweek, mday, minute, month, quarter, second, wday, week,
    yday, year</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    between, first, last</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    transpose</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'didimputation'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:did2s':

    df_het, df_hom</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>mcaid.data <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"../files/data/acs/acs_medicaid.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 416 Columns: 12</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (1): State
dbl  (8): year, adult_pop, ins_employer, ins_direct, ins_medicare, ins_medic...
lgl  (2): expand_ever, expand
date (1): date_adopted

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> mcaid.data <span class="sc">%&gt;%</span> </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(expand_ever)) <span class="sc">%&gt;%</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_unins=</span>uninsured<span class="sc">/</span>adult_pop,</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">post =</span> (year<span class="sc">&gt;=</span><span class="dv">2014</span>), </span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat=</span>post<span class="sc">*</span>expand_ever,</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">expand_year =</span> <span class="fu">ifelse</span>(expand_ever<span class="sc">==</span><span class="cn">FALSE</span>, <span class="dv">0</span>, expand_year))</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>mod.bea <span class="ot">&lt;-</span> <span class="fu">did_imputation</span>(reg.dat, <span class="at">yname=</span><span class="st">"perc_unins"</span>, </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">gname=</span><span class="st">"expand_year"</span>,</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">tname=</span><span class="st">"year"</span>,</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">idname=</span><span class="st">"State"</span>,</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">first_stage =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">|</span> State <span class="sc">+</span> year,</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">cluster_var=</span><span class="st">"State"</span>,</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">horizon=</span><span class="cn">TRUE</span>,</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">pretrends=</span><span class="sc">-</span><span class="dv">3</span><span class="sc">:-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="borusyak-et-al.-in-practice-1" class="level2">
<h2 class="anchored" data-anchor-id="borusyak-et-al.-in-practice-1">Borusyak et al.&nbsp;in practice</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>coef.bea <span class="ot">&lt;-</span> mod.bea <span class="sc">%&gt;%</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">rel_year =</span> term, estimate, std.error) <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ci_lower =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error,</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">ci_upper =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error,</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">group =</span> <span class="st">"Borusyak et al Imputation"</span>,</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">rel_year =</span> <span class="fu">as.numeric</span>(rel_year)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coef.bea) <span class="sc">+</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> rel_year, <span class="at">ymin =</span> ci_lower, <span class="at">ymax =</span> ci_upper), <span class="at">color =</span> <span class="st">"grey30"</span>) <span class="sc">+</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> rel_year, <span class="at">y =</span> estimate, <span class="at">color =</span> group), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">minor_breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">minor_breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Relative Time"</span>, <span class="at">y =</span> <span class="st">"Estimate"</span>, <span class="at">color =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="class9_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<hr>
<section id="seems-like-lots-of-solutions" class="level2">
<h2 class="anchored" data-anchor-id="seems-like-lots-of-solutions">Seems like lots of “solutions”</h2>
<ul>
<li>Callaway and Sant’Anna (2020)</li>
<li>Sun and Abraham (2020)</li>
<li>de Chaisemartin and D’Haultfoeuille (2020)</li>
<li>Cengiz et al (2019)</li>
<li>Gardner (2021) and Borusyak et al.&nbsp;(2021)</li>
</ul>
<div class="fragment">
<p>Goodman-Bacon (2021) explores the problems but doesn’t really propose a solution (still very important work though!)</p>
</div>
<hr>
</section>
<section id="comparison" class="level2">
<h2 class="anchored" data-anchor-id="comparison">Comparison</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>mcaid.data <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">"../files/data/acs/acs_medicaid.txt"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 416 Columns: 12
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr  (1): State
dbl  (8): year, adult_pop, ins_employer, ins_direct, ins_medicare, ins_medic...
lgl  (2): expand_ever, expand
date (1): date_adopted

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>reg.dat <span class="ot">&lt;-</span> mcaid.data <span class="sc">%&gt;%</span> </span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(expand_ever)) <span class="sc">%&gt;%</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc_unins=</span>uninsured<span class="sc">/</span>adult_pop,</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">post =</span> (year<span class="sc">&gt;=</span><span class="dv">2014</span>), </span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">treat=</span>post<span class="sc">*</span>expand_ever,</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_to_treat =</span> <span class="fu">ifelse</span>(expand_ever<span class="sc">==</span><span class="cn">FALSE</span>, <span class="dv">0</span>, year<span class="sc">-</span>expand_year),</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">time_to_treat =</span> <span class="fu">ifelse</span>(time_to_treat <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">3</span>, time_to_treat))</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>mod.twfe <span class="ot">&lt;-</span> <span class="fu">feols</span>(perc_unins<span class="sc">~</span><span class="fu">i</span>(time_to_treat, expand_ever, <span class="at">ref=</span><span class="sc">-</span><span class="dv">1</span>) <span class="sc">|</span> State <span class="sc">+</span> year,</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">cluster=</span><span class="sc">~</span>State,</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">data=</span>reg.dat)</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>coef.twfe <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod.twfe) <span class="sc">%&gt;%</span></span>
<span id="cb88-15"><a href="#cb88-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term=</span><span class="fu">str_replace</span>(term,<span class="st">"time_to_treat::"</span>,<span class="st">""</span>),</span>
<span id="cb88-16"><a href="#cb88-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">term=</span><span class="fu">str_replace</span>(term,<span class="st">":expand_ever"</span>,<span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb88-17"><a href="#cb88-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">rel_year=</span>term) <span class="sc">%&gt;%</span></span>
<span id="cb88-18"><a href="#cb88-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rel_year, estimate, std.error) <span class="sc">%&gt;%</span></span>
<span id="cb88-19"><a href="#cb88-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">rel_year=</span><span class="st">"-1"</span>, <span class="at">estimate=</span><span class="dv">0</span>, <span class="at">std.error=</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb88-20"><a href="#cb88-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb88-21"><a href="#cb88-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_lower =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error,</span>
<span id="cb88-22"><a href="#cb88-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_upper =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error,</span>
<span id="cb88-23"><a href="#cb88-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">"TWFE"</span>,</span>
<span id="cb88-24"><a href="#cb88-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_year =</span> <span class="fu">as.numeric</span>(rel_year)</span>
<span id="cb88-25"><a href="#cb88-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb88-26"><a href="#cb88-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rel_year<span class="sc">&gt;=-</span><span class="dv">3</span>, rel_year<span class="sc">&lt;=</span><span class="dv">5</span>)</span>
<span id="cb88-27"><a href="#cb88-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-28"><a href="#cb88-28" aria-hidden="true" tabindex="-1"></a>coef<span class="fl">.2</span>s <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod<span class="fl">.2</span>s) <span class="sc">%&gt;%</span></span>
<span id="cb88-29"><a href="#cb88-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term=</span><span class="fu">str_replace</span>(term,<span class="st">"time_to_treat::"</span>,<span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb88-30"><a href="#cb88-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">rel_year=</span>term) <span class="sc">%&gt;%</span></span>
<span id="cb88-31"><a href="#cb88-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rel_year, estimate, std.error) <span class="sc">%&gt;%</span></span>
<span id="cb88-32"><a href="#cb88-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">rel_year=</span><span class="st">"-1"</span>, <span class="at">estimate=</span><span class="dv">0</span>, <span class="at">std.error=</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span>  </span>
<span id="cb88-33"><a href="#cb88-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb88-34"><a href="#cb88-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_lower =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error,</span>
<span id="cb88-35"><a href="#cb88-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_upper =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error,</span>
<span id="cb88-36"><a href="#cb88-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">"Gardner 2SDiD"</span>,</span>
<span id="cb88-37"><a href="#cb88-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_year =</span> <span class="fu">as.numeric</span>(rel_year)</span>
<span id="cb88-38"><a href="#cb88-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb88-39"><a href="#cb88-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-40"><a href="#cb88-40" aria-hidden="true" tabindex="-1"></a>coef.sa <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod.sa) <span class="sc">%&gt;%</span></span>
<span id="cb88-41"><a href="#cb88-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">term=</span><span class="fu">str_replace</span>(term,<span class="st">"time_to_treat::"</span>,<span class="st">""</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb88-42"><a href="#cb88-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">rel_year=</span>term) <span class="sc">%&gt;%</span></span>
<span id="cb88-43"><a href="#cb88-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rel_year, estimate, std.error) <span class="sc">%&gt;%</span></span>
<span id="cb88-44"><a href="#cb88-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble</span>(<span class="at">rel_year=</span><span class="st">"-1"</span>, <span class="at">estimate=</span><span class="dv">0</span>, <span class="at">std.error=</span><span class="dv">0</span>)) <span class="sc">%&gt;%</span>    </span>
<span id="cb88-45"><a href="#cb88-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb88-46"><a href="#cb88-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_lower =</span> estimate <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error,</span>
<span id="cb88-47"><a href="#cb88-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">ci_upper =</span> estimate <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> std.error,</span>
<span id="cb88-48"><a href="#cb88-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="st">"Sun and Abraham"</span>,</span>
<span id="cb88-49"><a href="#cb88-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">rel_year =</span> <span class="fu">as.numeric</span>(rel_year)</span>
<span id="cb88-50"><a href="#cb88-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb88-51"><a href="#cb88-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rel_year<span class="sc">&gt;=-</span><span class="dv">3</span>, rel_year<span class="sc">&lt;=</span><span class="dv">5</span>)</span>
<span id="cb88-52"><a href="#cb88-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-53"><a href="#cb88-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-54"><a href="#cb88-54" aria-hidden="true" tabindex="-1"></a>coef.cs <span class="ot">&lt;-</span> <span class="fu">tidy</span>(mod.cs.event) <span class="sc">%&gt;%</span></span>
<span id="cb88-55"><a href="#cb88-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">rel_year=</span>event.time, estimate, <span class="at">ci_lower=</span>conf.low, <span class="at">ci_upper=</span>conf.high) <span class="sc">%&gt;%</span></span>
<span id="cb88-56"><a href="#cb88-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rel_year=</span><span class="fu">as.numeric</span>(rel_year),</span>
<span id="cb88-57"><a href="#cb88-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="st">"Callaway and Sant'Anna"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb88-58"><a href="#cb88-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rel_year<span class="sc">&gt;=-</span><span class="dv">3</span>, rel_year<span class="sc">&lt;=</span><span class="dv">5</span>)</span>
<span id="cb88-59"><a href="#cb88-59" aria-hidden="true" tabindex="-1"></a>coef.cs <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(coef.cs)</span>
<span id="cb88-60"><a href="#cb88-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-61"><a href="#cb88-61" aria-hidden="true" tabindex="-1"></a>coef.all <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(coef.twfe, coef.cs, coef.sa, coef<span class="fl">.2</span>s, coef.bea) <span class="sc">%&gt;%</span></span>
<span id="cb88-62"><a href="#cb88-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(rel_year, estimate, ci_lower, ci_upper, group)</span>
<span id="cb88-63"><a href="#cb88-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-64"><a href="#cb88-64" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coef.all, <span class="fu">aes</span>(<span class="at">x=</span>rel_year, <span class="at">y=</span>estimate)) <span class="sc">+</span> </span>
<span id="cb88-65"><a href="#cb88-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>group), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">position=</span><span class="fu">position_dodge</span>(<span class="at">width=</span><span class="fl">0.7</span>))  <span class="sc">+</span></span>
<span id="cb88-66"><a href="#cb88-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ci_lower, <span class="at">ymax =</span> ci_upper), <span class="at">position=</span><span class="fu">position_dodge2</span>(<span class="at">width=</span><span class="fl">0.7</span>)) <span class="sc">+</span></span>
<span id="cb88-67"><a href="#cb88-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb88-68"><a href="#cb88-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb88-69"><a href="#cb88-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"bottom"</span>) <span class="sc">+</span></span>
<span id="cb88-70"><a href="#cb88-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color=</span><span class="fu">guide_legend</span>(<span class="at">ncol=</span><span class="dv">2</span>, <span class="at">title=</span><span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb88-71"><a href="#cb88-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="sc">-</span><span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">minor_breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb88-72"><a href="#cb88-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">minor_breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb88-73"><a href="#cb88-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Relative Time"</span>, <span class="at">y =</span> <span class="st">"Estimate"</span>, <span class="at">color =</span> <span class="cn">NULL</span>, <span class="at">title =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="class9_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="comparison-1" class="level2">
<h2 class="anchored" data-anchor-id="comparison-1">Comparison</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Similarities</strong></p>
<ul>
<li>Focus on clean treatment/control</li>
<li>Focus on event study framework (not a single overall effect)</li>
<li>Impose some form of parallel trends assumption</li>
</ul>
</div><div class="column" style="width:50%;">
<p><strong>Differences</strong></p>
<ul>
<li>Is there a “never treated” group?</li>
<li>Can treatment turn on and off?</li>
<li>How to include covariates?</li>
<li>How to do inference?</li>
</ul>
</div>
</div>
<hr>
</section>
<section id="general-advice" class="level2">
<h2 class="anchored" data-anchor-id="general-advice">General advice</h2>
<ol type="1">
<li>Do you have staggered treatment adoption? If so, will need to consider something beyond TWFE event study (even if it doesn’t change results)</li>
<li>Do you need time-varying covariates? If so, consider Sun and Abraham or stacked regression (2SDD and imputation can only use pre-treatment covariates). But also, why do you need time-varying covariates?</li>
<li>Is treatment “strict”? If not, CH is only option right now</li>
<li>Does treatment turn on and off again? If so, CH or perhaps focus on “clean” treatment adoptions</li>
<li>Inference? Stacked regression is harder here. (see <span class="citation" data-cites="wing2024wp">Wing, Freedman, and Hollingsworth (<a href="#ref-wing2024wp" role="doc-biblioref">2024</a>)</span> for recent work on this)</li>
</ol>
<hr>
</section>
<section id="other-topics" class="level2">
<h2 class="anchored" data-anchor-id="other-topics">Other topics</h2>
<ul>
<li>Can you test for parallel pre-trends?</li>
<li>Recent work says such tests are underpowered</li>
<li>Consider potential violations of parallel trends and assess results
<ul>
<li>Intuitively “easy” to do in manual <span class="math inline">\((g,t)\)</span> or imputation setting, harder in pure regression setting</li>
<li>See <span class="citation" data-cites="rambachan2023">Rambachan and Roth (<a href="#ref-rambachan2023" role="doc-biblioref">2023</a>)</span> and <span class="citation" data-cites="freyaldenhoven2021wp">Freyaldenhoven et al. (<a href="#ref-freyaldenhoven2021wp" role="doc-biblioref">2021</a>)</span> for recent work on this</li>
<li>Parallel trends sensitive to functional form, see <span class="citation" data-cites="roth2023emta">Roth and Sant’Anna (<a href="#ref-roth2023emta" role="doc-biblioref">2023</a>)</span></li>
</ul></li>
</ul>
</section>
</section>
<section id="some-points-on-the-dd-empirical-exercise" class="level1">
<h1>Some points on the DD empirical exercise</h1>
<hr>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">1. The Data</h2>
<ol type="1">
<li>HCRIS</li>
<li>POS</li>
<li>KFF Medicaid Expansion</li>
</ol>
<hr>
</section>
<section id="hcris" class="level2">
<h2 class="anchored" data-anchor-id="hcris">HCRIS</h2>
<ul>
<li>Comprehensive dataset on hospital financials and other details</li>
<li>Challenging to get information out of these reports</li>
<li>Very messy with lots of misreporting</li>
<li>Hospitals identified by “Medicare Provider Number” (also known as CMS Certification Number, or CCN) and “NPI”</li>
<li>We’ll work with the provider number in this assignment</li>
</ul>
<hr>
</section>
<section id="pos" class="level2">
<h2 class="anchored" data-anchor-id="pos">POS</h2>
<ul>
<li>“Cumulative” file listing all Medicare-approved facilities other than clinical labs (those are in separate files)</li>
<li>Duplicate observations in each year</li>
<li>Closed hospitals <strong>should</strong> stay in the data every year, with a termination date filled when closed</li>
<li><strong>LOTS</strong> more facilities than hospitals</li>
</ul>
<hr>
</section>
<section id="kff-medicaid-expansion" class="level2">
<h2 class="anchored" data-anchor-id="kff-medicaid-expansion">KFF Medicaid Expansion</h2>
<ul>
<li>List of states and dates in which Medicaid was implemented</li>
</ul>
<hr>
</section>
<section id="the-analysis" class="level2">
<h2 class="anchored" data-anchor-id="the-analysis">2. The analysis</h2>
<ol type="1">
<li>Summary statistics and figures</li>
<li>DD, TWFE, Event Studies</li>
<li>Sun and Abraham</li>
<li>Callaway and Sant’Anna</li>
<li>Callaway and Sant’Anna with “Honest” pre-trends</li>
</ol>
<hr>
</section>
<section id="discussion-and-reflection" class="level2">
<h2 class="anchored" data-anchor-id="discussion-and-reflection">3. Discussion and reflection</h2>
<ul>
<li>Discussion: Looking for overall takeaways here, nothing too formal.</li>
<li>Reflection: Explain something you found surprising. Maybe it was something that you enjoyed learning or implementing. Maybe it was something that you struggled with but that you thought, ex ante, would be easier. Or maybe you were surprised at how awesome you are! Anything goes really…just be genuine.</li>
</ul>
<hr>
</section>
<section id="expectations" class="level2">
<h2 class="anchored" data-anchor-id="expectations">4. Expectations</h2>
<ul>
<li>PDF should be more like a report than a research notebook (code goes in the repo, not in the report)</li>
<li>Separate your analysis from your writing (perhaps by cleaning and then saving your workspace, and importing it into your markdown doc)</li>
<li>Tables and Figures should be near-publication quality, with clean and clear variable names, axes, labels, etc.</li>
<li>Spend time on good workflow and professional looking products…you can re-use all of this code and workflow for the rest of your career!</li>
</ul>
</section>
<section id="references" class="level2">




</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-freyaldenhoven2021wp" class="csl-entry" role="listitem">
Freyaldenhoven, Simon, Christian Hansen, Jorge Pérez Pérez, and Jesse M. Shapiro. 2021. <span>“Visualization, <span>Identification</span>, and <span>Estimation</span> in the <span>Linear</span> <span>Panel</span> <span>Event</span>-<span>Study</span> <span>Design</span>.”</span> Working {Paper}. Working <span>Paper</span> <span>Series</span>. National Bureau of Economic Research. <a href="https://doi.org/10.3386/w29170">https://doi.org/10.3386/w29170</a>.
</div>
<div id="ref-rambachan2023" class="csl-entry" role="listitem">
Rambachan, Ashesh, and Jonathan Roth. 2023. <span>“A <span>More</span> <span>Credible</span> <span>Approach</span> to <span>Parallel</span> <span>Trends</span>.”</span> <em>The Review of Economic Studies</em> 90 (5): 2555–91. <a href="https://doi.org/10.1093/restud/rdad018">https://doi.org/10.1093/restud/rdad018</a>.
</div>
<div id="ref-roth2023emta" class="csl-entry" role="listitem">
Roth, Jonathan, and Pedro H. C. Sant’Anna. 2023. <span>“When <span>Is</span> <span>Parallel</span> <span>Trends</span> <span>Sensitive</span> to <span>Functional</span> <span>Form</span>?”</span> <em>Econometrica</em> 91 (2): 737–47. <a href="https://doi.org/10.3982/ECTA19402">https://doi.org/10.3982/ECTA19402</a>.
</div>
<div id="ref-wing2024wp" class="csl-entry" role="listitem">
Wing, Coady, Seth M. Freedman, and Alex Hollingsworth. 2024. <span>“Stacked <span>Difference</span>-in-<span>Differences</span>.”</span> Working {Paper}. Working <span>Paper</span> <span>Series</span>. National Bureau of Economic Research. <a href="https://doi.org/10.3386/w32054">https://doi.org/10.3386/w32054</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/econ771s24\.classes\.ianmccarthyecon\.com\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Content <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2024 by Ian McCarthy<br> All content licensed under a <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc" aria-label="creative-commons-nc"></i> <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a><br> <a href="https://github.com/imccart/econ771-spring2024">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></p>
</div>
  </div>
</footer>




</body></html>