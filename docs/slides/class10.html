<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ian McCarthy, Emory University and NBER">
<meta name="description" content="PhD Course on the Economics of Healthcare">

<title>A Quick Primer on Instrumental Variables – Health Economics II</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta property="og:title" content="A Quick Primer on Instrumental Variables – Health Economics II">
<meta property="og:image" content="https://econ771s24.classes.ianmccarthyecon.com//files/econ771-logo.png">
<meta property="og:site_name" content="Health Economics II">
<meta property="og:locale" content="en_US">
<meta property="og:image:height" content="1024">
<meta property="og:image:width" content="512">
<meta name="twitter:title" content="A Quick Primer on Instrumental Variables – Health Economics II">
<meta name="twitter:image" content="https://econ771s24.classes.ianmccarthyecon.com//files/econ771-logo.png">
<meta name="twitter:creator" content="@ianhealthecon">
<meta name="twitter:site" content="@ianhealthecon">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image-height" content="1024">
<meta name="twitter:image-width" content="512">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Health Economics II</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule/index.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignments/index.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../resources/index.html"> 
<span class="menu-text">Resources</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/imccart/econ771-spring2024"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#outline" id="toc-outline" class="nav-link active" data-scroll-target="#outline">Outline</a></li>
  <li><a href="#assessing-selection-on-unobservables" id="toc-assessing-selection-on-unobservables" class="nav-link" data-scroll-target="#assessing-selection-on-unobservables">Assessing Selection on Unobservables</a>
  <ul class="collapse">
  <li><a href="#oster2019" id="toc-oster2019" class="nav-link" data-scroll-target="#oster2019"><span class="citation" data-cites="oster2019">Oster (2019)</span></a></li>
  <li><a href="#oster2019-1" id="toc-oster2019-1" class="nav-link" data-scroll-target="#oster2019-1"><span class="citation" data-cites="oster2019">Oster (2019)</span></a></li>
  <li><a href="#augmented-regression-somewhat-out-of-place-here" id="toc-augmented-regression-somewhat-out-of-place-here" class="nav-link" data-scroll-target="#augmented-regression-somewhat-out-of-place-here">Augmented regression (somewhat out of place here)</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul></li>
  <li><a href="#instrumental-variables" id="toc-instrumental-variables" class="nav-link" data-scroll-target="#instrumental-variables">Instrumental Variables</a>
  <ul class="collapse">
  <li><a href="#what-is-instrumental-variables" id="toc-what-is-instrumental-variables" class="nav-link" data-scroll-target="#what-is-instrumental-variables">What is instrumental variables</a></li>
  <li><a href="#simple-example" id="toc-simple-example" class="nav-link" data-scroll-target="#simple-example">Simple example</a></li>
  <li><a href="#what-does-iv-do" id="toc-what-does-iv-do" class="nav-link" data-scroll-target="#what-does-iv-do">What does IV do?</a></li>
  <li><a href="#intuition" id="toc-intuition" class="nav-link" data-scroll-target="#intuition">Intuition</a></li>
  <li><a href="#more-formally" id="toc-more-formally" class="nav-link" data-scroll-target="#more-formally">More formally</a></li>
  <li><a href="#derivation" id="toc-derivation" class="nav-link" data-scroll-target="#derivation">Derivation</a></li>
  <li><a href="#derivation-1" id="toc-derivation-1" class="nav-link" data-scroll-target="#derivation-1">Derivation</a></li>
  <li><a href="#ivs-in-practice" id="toc-ivs-in-practice" class="nav-link" data-scroll-target="#ivs-in-practice">IVs in practice</a></li>
  <li><a href="#what-is-iv-really-doing" id="toc-what-is-iv-really-doing" class="nav-link" data-scroll-target="#what-is-iv-really-doing">What is IV <em>really</em> doing</a></li>
  <li><a href="#in-regression-terms" id="toc-in-regression-terms" class="nav-link" data-scroll-target="#in-regression-terms">In regression terms</a></li>
  <li><a href="#derivation-2" id="toc-derivation-2" class="nav-link" data-scroll-target="#derivation-2">Derivation</a></li>
  <li><a href="#animation-for-iv" id="toc-animation-for-iv" class="nav-link" data-scroll-target="#animation-for-iv">Animation for IV</a></li>
  <li><a href="#simulated-data" id="toc-simulated-data" class="nav-link" data-scroll-target="#simulated-data">Simulated data</a></li>
  <li><a href="#results-with-simulated-data" id="toc-results-with-simulated-data" class="nav-link" data-scroll-target="#results-with-simulated-data">Results with simulated data</a></li>
  <li><a href="#two-stage-equivalence" id="toc-two-stage-equivalence" class="nav-link" data-scroll-target="#two-stage-equivalence">Two-stage equivalence</a></li>
  </ul></li>
  <li><a href="#assumptions-of-iv" id="toc-assumptions-of-iv" class="nav-link" data-scroll-target="#assumptions-of-iv">Assumptions of IV</a>
  <ul class="collapse">
  <li><a href="#key-iv-assumptions" id="toc-key-iv-assumptions" class="nav-link" data-scroll-target="#key-iv-assumptions">Key IV assumptions</a></li>
  <li><a href="#checking-instrument" id="toc-checking-instrument" class="nav-link" data-scroll-target="#checking-instrument">Checking instrument</a></li>
  <li><a href="#do-we-need-iv" id="toc-do-we-need-iv" class="nav-link" data-scroll-target="#do-we-need-iv">Do we need IV?</a></li>
  <li><a href="#testing-exclusion" id="toc-testing-exclusion" class="nav-link" data-scroll-target="#testing-exclusion">Testing exclusion</a></li>
  <li><a href="#vankippersluis2018-beyond-plausibly-exogenous" id="toc-vankippersluis2018-beyond-plausibly-exogenous" class="nav-link" data-scroll-target="#vankippersluis2018-beyond-plausibly-exogenous"><span class="citation" data-cites="vankippersluis2018">Kippersluis and Rietveld (2018)</span>, “Beyond Plausibly Exogenous”</a></li>
  <li><a href="#beckert2020-a-note-on-specification-testing" id="toc-beckert2020-a-note-on-specification-testing" class="nav-link" data-scroll-target="#beckert2020-a-note-on-specification-testing"><span class="citation" data-cites="beckert2020">Beckert (2020)</span>, “A Note on Specification Testing…”</a></li>
  <li><a href="#solving-an-exclusion-problem" id="toc-solving-an-exclusion-problem" class="nav-link" data-scroll-target="#solving-an-exclusion-problem">Solving an Exclusion Problem</a></li>
  <li><a href="#solving-an-exclusion-problem-1" id="toc-solving-an-exclusion-problem-1" class="nav-link" data-scroll-target="#solving-an-exclusion-problem-1">Solving an Exclusion Problem</a></li>
  <li><a href="#instrument-validity" id="toc-instrument-validity" class="nav-link" data-scroll-target="#instrument-validity">Instrument Validity</a></li>
  <li><a href="#why-we-care-about-instrument-strength" id="toc-why-we-care-about-instrument-strength" class="nav-link" data-scroll-target="#why-we-care-about-instrument-strength">Why we care about instrument strength</a></li>
  <li><a href="#testing-strength-of-instruments" id="toc-testing-strength-of-instruments" class="nav-link" data-scroll-target="#testing-strength-of-instruments">Testing strength of instruments</a></li>
  <li><a href="#testing-strength-of-instruments-1" id="toc-testing-strength-of-instruments-1" class="nav-link" data-scroll-target="#testing-strength-of-instruments-1">Testing strength of instruments</a></li>
  <li><a href="#testing-strength-of-instruments-2" id="toc-testing-strength-of-instruments-2" class="nav-link" data-scroll-target="#testing-strength-of-instruments-2">Testing strength of instruments</a></li>
  <li><a href="#testing-strength-of-instruments-3" id="toc-testing-strength-of-instruments-3" class="nav-link" data-scroll-target="#testing-strength-of-instruments-3">Testing strength of instruments</a></li>
  <li><a href="#testing-strength-of-instruments-4" id="toc-testing-strength-of-instruments-4" class="nav-link" data-scroll-target="#testing-strength-of-instruments-4">Testing strength of instruments</a></li>
  <li><a href="#testing-strength-of-instruments-first-stage" id="toc-testing-strength-of-instruments-first-stage" class="nav-link" data-scroll-target="#testing-strength-of-instruments-first-stage">Testing strength of instruments: First-stage</a></li>
  <li><a href="#testing-strength-of-instruments-inference" id="toc-testing-strength-of-instruments-inference" class="nav-link" data-scroll-target="#testing-strength-of-instruments-inference">Testing strength of instruments: Inference</a></li>
  <li><a href="#making-sense-of-all-of-this" id="toc-making-sense-of-all-of-this" class="nav-link" data-scroll-target="#making-sense-of-all-of-this">Making sense of all of this…</a></li>
  </ul></li>
  <li><a href="#interpreting-instrumental-variables-results" id="toc-interpreting-instrumental-variables-results" class="nav-link" data-scroll-target="#interpreting-instrumental-variables-results">Interpreting Instrumental Variables Results</a>
  <ul class="collapse">
  <li><a href="#heterogenous-tes" id="toc-heterogenous-tes" class="nav-link" data-scroll-target="#heterogenous-tes">Heterogenous TEs</a></li>
  <li><a href="#monotonicity" id="toc-monotonicity" class="nav-link" data-scroll-target="#monotonicity">Monotonicity</a></li>
  <li><a href="#late-and-iv-interpretation" id="toc-late-and-iv-interpretation" class="nav-link" data-scroll-target="#late-and-iv-interpretation">LATE and IV Interpretation</a></li>
  <li><a href="#is-late-meaningful" id="toc-is-late-meaningful" class="nav-link" data-scroll-target="#is-late-meaningful">Is LATE meaningful?</a></li>
  <li><a href="#late-with-defiers" id="toc-late-with-defiers" class="nav-link" data-scroll-target="#late-with-defiers">LATE with defiers</a></li>
  <li><a href="#marginal-treatment-effects" id="toc-marginal-treatment-effects" class="nav-link" data-scroll-target="#marginal-treatment-effects">Marginal Treatment Effects</a></li>
  <li><a href="#marginal-treatment-effects-1" id="toc-marginal-treatment-effects-1" class="nav-link" data-scroll-target="#marginal-treatment-effects-1">Marginal Treatment Effects</a></li>
  <li><a href="#marginal-treatment-effects-2" id="toc-marginal-treatment-effects-2" class="nav-link" data-scroll-target="#marginal-treatment-effects-2">Marginal Treatment Effects</a></li>
  <li><a href="#marginal-treatment-effects-3" id="toc-marginal-treatment-effects-3" class="nav-link" data-scroll-target="#marginal-treatment-effects-3">Marginal Treatment Effects</a></li>
  <li><a href="#derivation-3" id="toc-derivation-3" class="nav-link" data-scroll-target="#derivation-3">Derivation</a></li>
  <li><a href="#derivation-4" id="toc-derivation-4" class="nav-link" data-scroll-target="#derivation-4">Derivation</a></li>
  <li><a href="#derivation-5" id="toc-derivation-5" class="nav-link" data-scroll-target="#derivation-5">Derivation</a></li>
  <li><a href="#mte-to-ate" id="toc-mte-to-ate" class="nav-link" data-scroll-target="#mte-to-ate">MTE to ATE</a></li>
  <li><a href="#mte-to-att" id="toc-mte-to-att" class="nav-link" data-scroll-target="#mte-to-att">MTE to ATT</a></li>
  <li><a href="#mte-to-late" id="toc-mte-to-late" class="nav-link" data-scroll-target="#mte-to-late">MTE to LATE</a></li>
  <li><a href="#mte-to-ols-and-iv" id="toc-mte-to-ols-and-iv" class="nav-link" data-scroll-target="#mte-to-ols-and-iv">MTE to OLS and IV</a></li>
  <li><a href="#mte-in-practice" id="toc-mte-in-practice" class="nav-link" data-scroll-target="#mte-in-practice">MTE in practice</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  </ul></li>
  <li><a href="#common-iv-designs-today" id="toc-common-iv-designs-today" class="nav-link" data-scroll-target="#common-iv-designs-today">Common IV Designs Today</a>
  <ul class="collapse">
  <li><a href="#judge-fixed-effects" id="toc-judge-fixed-effects" class="nav-link" data-scroll-target="#judge-fixed-effects">Judge Fixed Effects</a></li>
  <li><a href="#judge-fixed-effects-1" id="toc-judge-fixed-effects-1" class="nav-link" data-scroll-target="#judge-fixed-effects-1">Judge Fixed Effects</a></li>
  <li><a href="#judge-fixed-effects-2" id="toc-judge-fixed-effects-2" class="nav-link" data-scroll-target="#judge-fixed-effects-2">Judge Fixed Effects</a></li>
  <li><a href="#judge-fixed-effects-3" id="toc-judge-fixed-effects-3" class="nav-link" data-scroll-target="#judge-fixed-effects-3">Judge Fixed Effects</a></li>
  <li><a href="#bartik-shift-share-instruments" id="toc-bartik-shift-share-instruments" class="nav-link" data-scroll-target="#bartik-shift-share-instruments">Bartik (shift-share) Instruments</a></li>
  <li><a href="#bartik-instruments" id="toc-bartik-instruments" class="nav-link" data-scroll-target="#bartik-instruments">Bartik Instruments</a></li>
  <li><a href="#bartik-instruments-1" id="toc-bartik-instruments-1" class="nav-link" data-scroll-target="#bartik-instruments-1">Bartik Instruments</a></li>
  <li><a href="#bartik-instruments-2" id="toc-bartik-instruments-2" class="nav-link" data-scroll-target="#bartik-instruments-2">Bartik Instruments</a></li>
  <li><a href="#other-examples" id="toc-other-examples" class="nav-link" data-scroll-target="#other-examples">Other Examples</a></li>
  <li><a href="#other-examples-1" id="toc-other-examples-1" class="nav-link" data-scroll-target="#other-examples-1">Other Examples</a></li>
  <li><a href="#other-examples-2" id="toc-other-examples-2" class="nav-link" data-scroll-target="#other-examples-2">Other Examples</a></li>
  <li><a href="#bartik-instruments-3" id="toc-bartik-instruments-3" class="nav-link" data-scroll-target="#bartik-instruments-3">Bartik Instruments</a></li>
  <li><a href="#shift-share-focusing-on-the-shift" id="toc-shift-share-focusing-on-the-shift" class="nav-link" data-scroll-target="#shift-share-focusing-on-the-shift">Shift-Share (focusing on the shift)</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="class10.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">A Quick Primer on Instrumental Variables</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Ian McCarthy, Emory University and NBER </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Emory University, 2024
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<section id="outline" class="level2">
<h2 class="anchored" data-anchor-id="outline">Outline</h2>
<ol type="1">
<li>Assessing Selection on Unobservables</li>
<li>Basics of Instrumental Variables</li>
<li>Testing IV Assumptions</li>
<li>Interpreting IV Results</li>
<li>Common IV Designs Today</li>
</ol>
</section>
<section id="assessing-selection-on-unobservables" class="level1">
<h1>Assessing Selection on Unobservables</h1>
<hr>
<ul>
<li>Say we estimate a regression like <span class="math display">\[y_{i} = \delta D_{i} + \beta_{1} x_{1i} + \varepsilon_{i}\]</span></li>
<li>But we are concerned that the “true” specification is <span class="math display">\[y_{i} = \delta D_{i} + \beta_{1} x_{1i} + \beta_{2} x_{2i} + \varepsilon_{i}\]</span></li>
<li><strong>Idea:</strong> Extending the work of Altonji and others, Oster (2019) aims to decompose outome into a treatment effect (<span class="math inline">\(\delta\)</span>), observed controls (<span class="math inline">\(x_{1}\)</span>), unobserved controls (<span class="math inline">\(x_{2i}\)</span>), and iid error</li>
</ul>
<hr>
<section id="oster2019" class="level2">
<h2 class="anchored" data-anchor-id="oster2019"><span class="citation" data-cites="oster2019">Oster (<a href="#ref-oster2019" role="doc-biblioref">2019</a>)</span></h2>
<p><strong>Key assumption:</strong> Selection on observables is informative about selection on unobservables</p>
<ol type="1">
<li>What is the maximum <span class="math inline">\(R^2\)</span> value we could obtain if we observed <span class="math inline">\(x_{2}\)</span>? Call this <span class="math inline">\(R_{\text{max}}^{2}\)</span> (naturally bounded above by 1, but likely smaller)</li>
<li>What is the degree of selection on observed variables relative to unobserved variables? Denote the proportional relationship as <span class="math inline">\(\rho\)</span> such that: <span class="math display">\[\rho \times \frac{Cov(x_{1},D)}{Var(x_{1})} = \frac{Cov(x_{2},D)}{Var(x_{2})}.\]</span></li>
</ol>
<hr>
</section>
<section id="oster2019-1" class="level2">
<h2 class="anchored" data-anchor-id="oster2019-1"><span class="citation" data-cites="oster2019">Oster (<a href="#ref-oster2019" role="doc-biblioref">2019</a>)</span></h2>
<ul>
<li>Under an “equal relative contributions” assumption, we can write:</li>
</ul>
<p><span class="math display">\[\delta^{*} \approx \hat{\delta}_{D,x_{1}} - \rho \times \left[\hat{\delta}_{D} - \hat{\delta}_{D,x_{1}}\right] \times \frac{R_{\text{max}}^{2} - R_{D,x_{1}}^{2}}{R_{D,x_{1}}^{2} - R_{x_{1}}^{2}} \xrightarrow{p} \delta.\]</span></p>
<ul>
<li>Consider a range of <span class="math inline">\(R^{2}_{\text{max}}\)</span> and <span class="math inline">\(\rho\)</span> to bound the estimated treatment effect,</li>
</ul>
<p><span class="math display">\[\left[ \hat{\delta}_{D,x_{1}}, \delta^{*}(\bar{R}^{2}_{max}, \rho) \right]\]</span></p>
<hr>
</section>
<section id="augmented-regression-somewhat-out-of-place-here" class="level2">
<h2 class="anchored" data-anchor-id="augmented-regression-somewhat-out-of-place-here">Augmented regression (somewhat out of place here)</h2>
<ul>
<li>Oster (2019) and similar papers can say something about how bad selection on unobservables would need to be</li>
<li>But what kind of “improvement” do we really get in practice?</li>
</ul>
<hr>
<ul>
<li>Original test from Hausman (1978) not specific to endogeneity, just a general misspecification test</li>
<li>Compare estimates from one estimator (efficient under the null) to another estimator that is consistent but inefficient under the null</li>
<li>In IV context, also known as Durbin-Wu-Hausman test, due to the series of papers pre-dating Hausman (1978), including Durbin and Wu in the 1950s</li>
</ul>
<hr>
<ul>
<li>Easily implemented as an “artificial” or “augmented” regression</li>
<li>We want to estimate <span class="math inline">\(y=\beta_{1}x_{1} + \beta_{2}x_{2} + \varepsilon\)</span>, with exogenous variables <span class="math inline">\(x_{1}\)</span>, endogenous variables <span class="math inline">\(x_{2}\)</span>, and instruments <span class="math inline">\(z\)</span>
<ol type="1">
<li>Regress each of the variables in <span class="math inline">\(x_{2}\)</span> on <span class="math inline">\(x_{1}\)</span> and <span class="math inline">\(z\)</span> and form residuals, <span class="math inline">\(\hat{v}\)</span>, <span class="math inline">\(x_{2} = \lambda_{x} x_{1} + \lambda_{z} z + v\)</span></li>
<li>Include <span class="math inline">\(\hat{v}\)</span> in the standard OLS regression of <span class="math inline">\(y\)</span> on <span class="math inline">\(x_{1}\)</span>, <span class="math inline">\(x_{2}\)</span>, and <span class="math inline">\(\hat{v}\)</span>.</li>
<li>Test <span class="math inline">\(H_{0}: \beta_{\hat{v}} = 0\)</span>. Rejection implies OLS is inconsistent.</li>
</ol></li>
</ul>
<div class="fragment">
<p>Intuition: Only way for <span class="math inline">\(x_{2}\)</span> to be correlated with <span class="math inline">\(\varepsilon\)</span> is through <span class="math inline">\(v\)</span>, <strong>assuming <span class="math inline">\(z\)</span> is a “good” instrument</strong></p>
</div>
<hr>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<ul>
<li>Do we have an endogeneity problem?
<ul>
<li>Effects easily overcome by small selection on unobservables?</li>
<li>Clear reverse causality problem?</li>
</ul></li>
<li>What can we do about it?
<ul>
<li>Matching, weighting, regression? Only for selection on observables</li>
<li>DD, RD, differences in discontinuities? Specific designs and settings</li>
<li>Instrumental variables?</li>
</ul></li>
</ul>
</section>
</section>
<section id="instrumental-variables" class="level1">
<h1>Instrumental Variables</h1>
<hr>
<section id="what-is-instrumental-variables" class="level2">
<h2 class="anchored" data-anchor-id="what-is-instrumental-variables">What is instrumental variables</h2>
<p>Instrumental Variables (IV) is a way to identify causal effects using variation in treatment particpation that is due to an <em>exogenous</em> variable that is only related to the outcome through treatment.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="class10_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>DAG Selection</figcaption>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="simple-example" class="level2">
<h2 class="anchored" data-anchor-id="simple-example">Simple example</h2>
<ul>
<li><p><span class="math inline">\(y = \beta x + \varepsilon (x)\)</span>, where <span class="math inline">\(\varepsilon(x)\)</span> reflects the dependence between our observed variable and the error term.<br></p></li>
<li><p>Simple OLS will yield <span class="math inline">\(\frac{dy}{dx} = \beta + \frac{d\varepsilon}{dx} \neq \beta\)</span></p></li>
</ul>
<hr>
</section>
<section id="what-does-iv-do" class="level2">
<h2 class="anchored" data-anchor-id="what-does-iv-do">What does IV do?</h2>
<ul>
<li>The regression we want to do: <span class="math display">\[y_{i} = \alpha + \delta D_{i} + \gamma A_{i} + \epsilon_{i},\]</span> where <span class="math inline">\(D_{i}\)</span> is treatment (think of schooling for now) and <span class="math inline">\(A_{i}\)</span> is something like ability.</li>
<li><span class="math inline">\(A_{i}\)</span> is unobserved, so instead we run, <span class="math inline">\(y_{i} = \alpha + \beta D_{i} + \epsilon_{i}\)</span></li>
<li>From this “short” regression, we don’t actually estimate <span class="math inline">\(\delta\)</span>. Instead, we get an estimate of <span class="math display">\[\beta = \delta + \lambda_{ds}\gamma \neq \delta,\]</span> where <span class="math inline">\(\lambda_{ds}\)</span> is the coefficient of a regression of <span class="math inline">\(A_{i}\)</span> on <span class="math inline">\(D_{i}\)</span>.</li>
</ul>
<hr>
</section>
<section id="intuition" class="level2">
<h2 class="anchored" data-anchor-id="intuition">Intuition</h2>
<p>IV will recover the “long” regression without observing underlying ability</p>
<div class="fragment">
<p><em>IF</em> our IV satisfies all of the necessary assumptions.</p>
</div>
<hr>
</section>
<section id="more-formally" class="level2">
<h2 class="anchored" data-anchor-id="more-formally">More formally</h2>
<ul>
<li>We want to estimate <span class="math display">\[E[Y_{i} | D_{i}=1] - E[Y_{i} | D_{i}=0]\]</span></li>
<li>With instrument <span class="math inline">\(Z_{i}\)</span> that satisfies relevant assumptions, we can estimate this as <span class="math display">\[E[Y_{i} | D_{i}=1] - E[Y_{i} | D_{i}=0] = \frac{E[Y_{i} | Z_{i}=1] - E[Y_{i} | Z_{i}=0]}{E[D_{i} | Z_{i}=1] - E[D_{i} | Z_{i}=0]}\]</span></li>
<li>In words, this is effect of the instrument on the outcome (“reduced form”) divided by the effect of the instrument on treatment (“first stage”)</li>
</ul>
<hr>
</section>
<section id="derivation" class="level2">
<h2 class="anchored" data-anchor-id="derivation">Derivation</h2>
<p>Recall “long” regression: <span class="math inline">\(Y=\alpha + \delta S + \gamma A + \epsilon\)</span>.</p>
<p><span class="math display">\[\begin{align}
COV(Y,Z) &amp; = E[YZ] - E[Y] E[Z] \\
         &amp; = E[(\alpha + \delta S + \gamma A + \epsilon)\times Z] - E[\alpha + \delta S + \gamma A + \epsilon)]E[Z] \\
         &amp; = \alpha E[Z] + \delta E[SZ] + \gamma E[AZ] + E[\epsilon Z] \\
         &amp; \hspace{.2in} - \alpha E[Z] - \delta E[S]E[Z] - \gamma E[A] E[Z] - E[\epsilon]E[Z] \\
         &amp; = \delta (E[SZ] - E[S] E[Z]) + \gamma (E[AZ] - E[A] E[Z]) \\
         &amp; \hspace{.2in} + E[\epsilon Z] - E[\epsilon] E[Z] \\
         &amp; = \delta C(S,Z) + \gamma C(A,Z) + C(\epsilon, Z)
\end{align}\]</span></p>
<hr>
</section>
<section id="derivation-1" class="level2">
<h2 class="anchored" data-anchor-id="derivation-1">Derivation</h2>
<p>Working from <span class="math inline">\(COV(Y,Z) = \delta COV(S,Z) + \gamma COV(A,Z) + COV(\epsilon,Z)\)</span>, we find</p>
<p><span class="math display">\[\delta = \frac{COV(Y,Z)}{COV(S,Z)}\]</span></p>
<p>if <span class="math inline">\(COV(A,Z)=COV(\epsilon, Z)=0\)</span></p>
<hr>
</section>
<section id="ivs-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="ivs-in-practice">IVs in practice</h2>
<p>Easy to think of in terms of randomized controlled trial…</p>
<div class="fragment">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Measure</th>
<th>Offered Seat</th>
<th>Not Offered Seat</th>
<th>Difference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Score</td>
<td>-0.003</td>
<td>-0.358</td>
<td>0.355</td>
</tr>
<tr class="even">
<td>% Enrolled</td>
<td>0.787</td>
<td>0.046</td>
<td>0.741</td>
</tr>
<tr class="odd">
<td>Effect</td>
<td></td>
<td></td>
<td>0.48</td>
</tr>
</tbody>
</table>
<p>Angrist <em>et al.</em>, 2012. “Who Benefits from KIPP?” <em>Journal of Policy Analysis and Management</em>.</p>
</div>
<hr>
</section>
<section id="what-is-iv-really-doing" class="level2">
<h2 class="anchored" data-anchor-id="what-is-iv-really-doing">What is IV <em>really</em> doing</h2>
<p>Think of IV as two-steps:</p>
<ol type="1">
<li>Isolate variation due to the instrument only (not due to endogenous stuff)</li>
<li>Estimate effect on outcome using only this source of variation</li>
</ol>
<hr>
</section>
<section id="in-regression-terms" class="level2">
<h2 class="anchored" data-anchor-id="in-regression-terms">In regression terms</h2>
<p>Interested in estimating <span class="math inline">\(\delta\)</span> from <span class="math inline">\(y_{i} = \alpha + \beta x_{i} + \delta D_{i} + \varepsilon_{i}\)</span>, but <span class="math inline">\(D_{i}\)</span> is endogenous (no pure “selection on observables”).</p>
<div class="fragment">
<p><strong>Step 1:</strong> With instrument <span class="math inline">\(Z_{i}\)</span>, we can regress <span class="math inline">\(D_{i}\)</span> on <span class="math inline">\(Z_{i}\)</span> and <span class="math inline">\(x_{i}\)</span>, <span class="math display">\[D_{i} = \lambda + \theta Z_{i} + \kappa x_{i} + \nu,\]</span> and form prediction <span class="math inline">\(\hat{D}_{i}\)</span>.</p>
<p><strong>Step 2:</strong> Regress <span class="math inline">\(y_{i}\)</span> on <span class="math inline">\(x_{i}\)</span> and <span class="math inline">\(\hat{D}_{i}\)</span>, <span class="math display">\[y_{i} = \alpha + \beta x_{i} + \delta \hat{D}_{i} + \xi_{i}\]</span></p>
</div>
<hr>
</section>
<section id="derivation-2" class="level2">
<h2 class="anchored" data-anchor-id="derivation-2">Derivation</h2>
<p>Recall <span class="math inline">\(\hat{\theta}=\frac{C(Z,S)}{V(Z)}\)</span>, or <span class="math inline">\(\hat{\theta}V(Z) = C(S,Z)\)</span>. Then:</p>
<p><span class="math display">\[\begin{align}
\hat{\delta}  &amp; = \frac{COV(Y,Z)}{COV(S,Z)} \\
        &amp; = \frac{\hat{\theta}C(Y,Z)}{\hat{\theta}C(S,Z)} = \frac{\hat{\theta}C(Y,Z)}{\hat{\theta}^{2}V(Z)} \\
        &amp; = \frac{C(\hat{\theta}Z,Y)}{V(\hat{\theta}Z)} = \frac{C(\hat{S},Y)}{V(\hat{S})}
\end{align}\]</span></p>
<hr>
</section>
<section id="animation-for-iv" class="level2">
<h2 class="anchored" data-anchor-id="animation-for-iv">Animation for IV</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Z =</span> <span class="fu">as.integer</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span><span class="sc">&gt;</span><span class="dv">100</span>),</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">W =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">X =</span> .<span class="dv">5</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>W <span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>Z<span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">200</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> <span class="sc">-</span>X <span class="sc">+</span> <span class="dv">4</span><span class="sc">*</span>W <span class="sc">+</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">200</span>),<span class="at">time=</span><span class="st">"1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Z) <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_X=</span><span class="fu">mean</span>(X),<span class="at">mean_Y=</span><span class="fu">mean</span>(Y),<span class="at">YL=</span><span class="cn">NA</span>,<span class="at">XL=</span><span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate correlations</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>before_cor <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"1. Start with raw data. Correlation between X and Y: "</span>,<span class="fu">round</span>(<span class="fu">cor</span>(df<span class="sc">$</span>X,df<span class="sc">$</span>Y),<span class="dv">3</span>),<span class="at">sep=</span><span class="st">''</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>afterlab <span class="ot">&lt;-</span> <span class="st">'6. Draw a line between the points. The slope is the effect of X on Y.'</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>dffull <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Step 1: Raw data only</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">mean_X=</span><span class="cn">NA</span>,<span class="at">mean_Y=</span><span class="cn">NA</span>,<span class="at">time=</span>before_cor),</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Step 2: Add x-lines</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">mean_Y=</span><span class="cn">NA</span>,<span class="at">time=</span><span class="st">'2. Figure out what differences in X are explained by Z'</span>),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Step 3: X de-meaned </span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">X =</span> mean_X,<span class="at">mean_Y=</span><span class="cn">NA</span>,<span class="at">time=</span><span class="st">"3. Remove everything in X not explained by Z"</span>),</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Step 4: Remove X lines, add Y</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">X =</span> mean_X,<span class="at">mean_X=</span><span class="cn">NA</span>,<span class="at">time=</span><span class="st">"4. Figure out what differences in Y are explained by Z"</span>),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Step 5: Y de-meaned</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">X =</span> mean_X,<span class="at">Y =</span> mean_Y,<span class="at">mean_X=</span><span class="cn">NA</span>,<span class="at">time=</span><span class="st">"5. Remove everything in Y not explained by Z"</span>),</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Step 6: Raw demeaned data only</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">X =</span>  mean_X,<span class="at">Y =</span>mean_Y,<span class="at">mean_X=</span><span class="cn">NA</span>,<span class="at">mean_Y=</span><span class="cn">NA</span>,<span class="at">YL=</span>mean_Y,<span class="at">XL=</span>mean_X,<span class="at">time=</span>afterlab))</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#Get line segments</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>endpts <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Z) <span class="sc">%&gt;%</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_X=</span><span class="fu">mean</span>(mean_X),<span class="at">mean_Y=</span><span class="fu">mean</span>(mean_Y))</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dffull,<span class="fu">aes</span>(<span class="at">y=</span>Y,<span class="at">x=</span>X,<span class="at">color=</span><span class="fu">as.factor</span>(Z)))<span class="sc">+</span><span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept=</span>mean_X,<span class="at">color=</span><span class="fu">as.factor</span>(Z)))<span class="sc">+</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept=</span>mean_Y,<span class="at">color=</span><span class="fu">as.factor</span>(Z)))<span class="sc">+</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color=</span><span class="fu">guide_legend</span>(<span class="at">title=</span><span class="st">"Z"</span>))<span class="sc">+</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="fu">ifelse</span>(time<span class="sc">==</span>afterlab,endpts<span class="sc">$</span>mean_X[<span class="dv">1</span>],<span class="cn">NA</span>),</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y=</span>endpts<span class="sc">$</span>mean_Y[<span class="dv">1</span>],<span class="at">xend=</span>endpts<span class="sc">$</span>mean_X[<span class="dv">2</span>],</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yend=</span>endpts<span class="sc">$</span>mean_Y[<span class="dv">2</span>]),<span class="at">size=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">'blue'</span>)<span class="sc">+</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_colorblind</span>()<span class="sc">+</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'The Relationship between Y and X, With Binary Z as an Instrumental Variable </span><span class="sc">\n</span><span class="st">{next_state}'</span>)<span class="sc">+</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_states</span>(time,<span class="at">transition_length=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">16</span>,<span class="dv">6</span>,<span class="dv">16</span>,<span class="dv">6</span>,<span class="dv">6</span>),<span class="at">state_length=</span><span class="fu">c</span>(<span class="dv">50</span>,<span class="dv">22</span>,<span class="dv">12</span>,<span class="dv">22</span>,<span class="dv">12</span>,<span class="dv">50</span>),<span class="at">wrap=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ease_aes</span>(<span class="st">'sine-in-out'</span>)<span class="sc">+</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exit_fade</span>()<span class="sc">+</span><span class="fu">enter_fade</span>()</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="fu">animate</span>(p,<span class="at">nframes=</span><span class="dv">175</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="class10_files/figure-html/unnamed-chunk-3-1.gif" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
<section id="simulated-data" class="level2">
<h2 class="anchored" data-anchor-id="simulated-data">Simulated data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">5000</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>b.true <span class="ot">&lt;-</span> <span class="fl">5.25</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>iv.dat <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">2</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">eps =</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> (z <span class="sc">+</span> <span class="fl">1.5</span><span class="sc">*</span>eps <span class="sc">+</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">1</span>) <span class="sc">&gt;</span><span class="fl">0.25</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fl">2.5</span> <span class="sc">+</span> b.true<span class="sc">*</span>d <span class="sc">+</span> eps <span class="sc">+</span> <span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>endogenous <code>eps</code>: affects treatment and outcome</li>
<li><code>z</code> is an instrument: affects treatment but no direct effect on outcome</li>
</ul>
<hr>
</section>
<section id="results-with-simulated-data" class="level2">
<h2 class="anchored" data-anchor-id="results-with-simulated-data">Results with simulated data</h2>
<p>Recall that the <em>true</em> treatment effect is 5.25</p>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ d, data = iv.dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.6842 -0.6864 -0.0033  0.6899  4.3910 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.08624    0.01986   105.1   &lt;2e-16 ***
dTRUE        6.15766    0.02915   211.2   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.028 on 4998 degrees of freedom
Multiple R-squared:  0.8993,    Adjusted R-squared:  0.8992 
F-statistic: 4.462e+04 on 1 and 4998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>TSLS estimation - Dep. Var.: y
                  Endo.    : d
                  Instr.   : z
Second stage: Dep. Var.: y
Observations: 5,000
Standard-errors: IID 
            Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept)  2.50612   0.029812 84.0643 &lt; 2.2e-16 ***
fit_dTRUE    5.25274   0.054380 96.5941 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 1.12249   Adj. R2: 0.879822
F-test (1st stage), dTRUE: stat = 2,606.7, p &lt; 2.2e-16, on 1 and 4,998 DoF.
               Wu-Hausman: stat =   558.7, p &lt; 2.2e-16, on 1 and 4,997 DoF.</code></pre>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="two-stage-equivalence" class="level2">
<h2 class="anchored" data-anchor-id="two-stage-equivalence">Two-stage equivalence</h2>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>step1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(d <span class="sc">~</span> z, <span class="at">data=</span>iv.dat)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>d.hat <span class="ot">&lt;-</span> <span class="fu">predict</span>(step1)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>step2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> d.hat, <span class="at">data=</span>iv.dat)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(step2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ d.hat, data = iv.dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.2540 -2.1816 -0.1687  2.2333 10.7230 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.50612    0.07575   33.09   &lt;2e-16 ***
d.hat        5.25274    0.13817   38.02   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.853 on 4998 degrees of freedom
Multiple R-squared:  0.2243,    Adjusted R-squared:  0.2242 
F-statistic:  1445 on 1 and 4998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
</section>
<section id="assumptions-of-iv" class="level1">
<h1>Assumptions of IV</h1>
<hr>
<section id="key-iv-assumptions" class="level2">
<h2 class="anchored" data-anchor-id="key-iv-assumptions">Key IV assumptions</h2>
<ol type="1">
<li><em>Exclusion:</em> Instrument is uncorrelated with the error term</li>
<li><em>Validity:</em> Instrument is correlated with the endogenous variable</li>
<li><em>Monotonicity:</em> Treatment more (less) likely for those with higher (lower) values of the instrument<br></li>
</ol>
<div class="fragment">
<p>Assumptions 1 and 2 sometimes grouped into an <em>only through</em> condition.</p>
</div>
<hr>
</section>
<section id="checking-instrument" class="level2">
<h2 class="anchored" data-anchor-id="checking-instrument">Checking instrument</h2>
<p>Bare minimum (probably not even that) is to check first stage and reduced form:</p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>Check the ‘first stage’</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = d ~ z, data = iv.dat)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.06484 -0.33153 -0.02397  0.34092  1.40327 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 0.462255   0.005719   80.83   &lt;2e-16 ***
z           0.144829   0.002837   51.06   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4044 on 4998 degrees of freedom
Multiple R-squared:  0.3428,    Adjusted R-squared:  0.3426 
F-statistic:  2607 on 1 and 4998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div><div class="column" style="width:50%;">
<ul>
<li>Check the ‘reduced form’</li>
</ul>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ z, data = iv.dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-8.2540 -2.1816 -0.1687  2.2333 10.7230 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  4.93423    0.04034  122.31   &lt;2e-16 ***
z            0.76075    0.02001   38.02   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.853 on 4998 degrees of freedom
Multiple R-squared:  0.2243,    Adjusted R-squared:  0.2242 
F-statistic:  1445 on 1 and 4998 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="do-we-need-iv" class="level2">
<h2 class="anchored" data-anchor-id="do-we-need-iv">Do we need IV?</h2>
<ul>
<li>Let’s run an “augmented regression” to see if our OLS results are sufficiently different than IV</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>R Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>d.iv <span class="ot">&lt;-</span> <span class="fu">lm</span>(d <span class="sc">~</span> z, <span class="at">data=</span>iv.dat)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>d.resid <span class="ot">&lt;-</span> <span class="fu">residuals</span>(d.iv)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>haus.test <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> d <span class="sc">+</span> d.resid, <span class="at">data=</span>iv.dat)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(haus.test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ d + d.resid, data = iv.dat)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.3708 -0.6429 -0.0112  0.6636  4.1932 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.50612    0.02589   96.80   &lt;2e-16 ***
dTRUE        5.25274    0.04723  111.22   &lt;2e-16 ***
d.resid      1.37689    0.05825   23.64   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.975 on 4997 degrees of freedom
Multiple R-squared:  0.9094,    Adjusted R-squared:  0.9094 
F-statistic: 2.508e+04 on 2 and 4997 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<ul>
<li>Test for significance of <code>d.resid</code> suggests OLS is inconsistent in this case</li>
</ul>
<hr>
</section>
<section id="testing-exclusion" class="level2">
<h2 class="anchored" data-anchor-id="testing-exclusion">Testing exclusion</h2>
<ul>
<li>Exclusion restriction says that your instrument does not directly affect your outcome</li>
<li>Potential testing ideas:
<ul>
<li>“zero-first-stage” (subsample on which you know the instrument does not affect the endogenous variable)</li>
<li>augmented regression of reduced-form effect with subset of instruments (overidentified models only)</li>
<li>Sargan or Hansen’s J test (null hypothesis is that instruments are uncorrelated with residuals)</li>
</ul></li>
</ul>
<hr>
</section>
<section id="vankippersluis2018-beyond-plausibly-exogenous" class="level2">
<h2 class="anchored" data-anchor-id="vankippersluis2018-beyond-plausibly-exogenous"><span class="citation" data-cites="vankippersluis2018">Kippersluis and Rietveld (<a href="#ref-vankippersluis2018" role="doc-biblioref">2018</a>)</span>, “Beyond Plausibly Exogenous”</h2>
<ul>
<li>“zero-first-stage” test</li>
<li>Focus on subsample for which your instrument is not correlated with the endogenous variable of interest
<ol type="1">
<li>Regress the outcome on all covariates and the instruments among this subsample</li>
<li>Coefficient on the instruments captures any potential direct effect of the instruments on the outcome (since the correlation with the endogenous variable is 0 by assumption).</li>
</ol></li>
</ul>
<hr>
</section>
<section id="beckert2020-a-note-on-specification-testing" class="level2">
<h2 class="anchored" data-anchor-id="beckert2020-a-note-on-specification-testing"><span class="citation" data-cites="beckert2020">Beckert (<a href="#ref-beckert2020" role="doc-biblioref">2020</a>)</span>, “A Note on Specification Testing…”</h2>
<ul>
<li><p>With at least <span class="math inline">\(n\)</span> valid instruments, test if all instruments are valid against the alternative that up to <span class="math inline">\(m - n\)</span> instruments are valid</p>
<ol type="1">
<li>Estimate the first-stage regressions and save residuals, denoted <span class="math inline">\(\hat{u}\)</span>.</li>
<li>Estimate the “artificial” regression <span class="math display">\[y=\beta x + \delta \tilde{z} + \gamma \hat{u} + \varepsilon\]</span> where <span class="math inline">\(\tilde{z}\)</span> denotes a subset of <span class="math inline">\(m-n\)</span> instruments from the full instrument matrix <span class="math inline">\(z\)</span>.</li>
<li>Test the null that <span class="math inline">\(\delta=0\)</span> using a standard F-test</li>
</ol></li>
</ul>
<hr>
</section>
<section id="solving-an-exclusion-problem" class="level2">
<h2 class="anchored" data-anchor-id="solving-an-exclusion-problem">Solving an Exclusion Problem</h2>
<p><span class="citation" data-cites="conley2012">Conley, Hansen, and Rossi (<a href="#ref-conley2012" role="doc-biblioref">2012</a>)</span> and “plausible exogeneity”, union of confidence intervals approach:</p>
<ul>
<li>Suppose extent of violation is known in <span class="math inline">\(y_{i} = \beta x_{i} + \gamma z_{i} + \varepsilon_{i}\)</span>, so that <span class="math inline">\(\gamma = \gamma_{0}\)</span></li>
<li>IV/TSLS applied to <span class="math inline">\(y_{i} - \gamma_{0}z_{i} = \beta x_{i} + \varepsilon_{i}\)</span> works</li>
<li>With <span class="math inline">\(\gamma_{0}\)</span> unknown…do this a bunch of times!
<ul>
<li>Pick <span class="math inline">\(\gamma=\gamma^{b}\)</span> for <span class="math inline">\(b=1,...,B\)</span></li>
<li>Obtain <span class="math inline">\((1-\alpha)\)</span> % confidence interval for <span class="math inline">\(\beta\)</span>, denoted <span class="math inline">\(CI^{b}(1-\alpha)\)</span></li>
<li>Compute final CI as the union of all <span class="math inline">\(CI^{b}\)</span></li>
</ul></li>
</ul>
<hr>
</section>
<section id="solving-an-exclusion-problem-1" class="level2">
<h2 class="anchored" data-anchor-id="solving-an-exclusion-problem-1">Solving an Exclusion Problem</h2>
<p><span class="citation" data-cites="nevo2012">Nevo and Rosen (<a href="#ref-nevo2012" role="doc-biblioref">2012</a>)</span>:</p>
<p><span class="math display">\[y_{i} = \beta x_{i} + \delta D_{i} + \varepsilon_{i}\]</span></p>
<ul>
<li>Allow instrument, <span class="math inline">\(z\)</span>, to be correlated with <span class="math inline">\(\varepsilon\)</span>, but <span class="math inline">\(|\rho_{x, \varepsilon}| \geq |\rho_{z, \varepsilon}|\)</span></li>
<li>i.e., IV is better than just using the endogenous variable</li>
<li>Assume <span class="math inline">\(\rho_{x, \varepsilon} \times \rho_{z, \varepsilon} &gt;0\)</span> (same sign of correlation in the error)</li>
<li>Denote <span class="math inline">\(\lambda = \frac{\rho_{z, \varepsilon}}{\rho_{x, \varepsilon}}\)</span>, then valid <span class="math inline">\(IV\)</span> would be <span class="math inline">\(V(z) = \sigma_{x} z - \lambda \sigma_{z} x\)</span></li>
<li>Can bound <span class="math inline">\(\beta\)</span> using range of <span class="math inline">\(\lambda\)</span></li>
</ul>
<hr>
</section>
<section id="instrument-validity" class="level2">
<h2 class="anchored" data-anchor-id="instrument-validity">Instrument Validity</h2>
<p>Just says that your instrument is correlated with the endogenous variable, but what about the <strong>strength</strong> of the correlation?</p>
<p><img src="https://media.giphy.com/media/3oFzlXvco5Wt2gnMcg/giphy.gif" class="img-fluid"></p>
<hr>
</section>
<section id="why-we-care-about-instrument-strength" class="level2">
<h2 class="anchored" data-anchor-id="why-we-care-about-instrument-strength">Why we care about instrument strength</h2>
<p>Recall our schooling and wages equation, <span class="math display">\[y = \beta S + \epsilon.\]</span> Bias in IV can be represented as:</p>
<p><span class="math display">\[Bias_{IV} \approx \frac{Cov(S, \epsilon)}{V(S)} \frac{1}{F+1} = Bias_{OLS} \frac{1}{F+1}\]</span></p>
<ul>
<li>Bias in IV may be close to OLS, depending on instrument strength</li>
<li><strong>Bigger problem:</strong> Bias could be bigger than OLS if exclusion restriction not <em>fully</em> satisfied</li>
</ul>
<hr>
</section>
<section id="testing-strength-of-instruments" class="level2">
<h2 class="anchored" data-anchor-id="testing-strength-of-instruments">Testing strength of instruments</h2>
<p>Two things going on simultaneously:</p>
<ol type="1">
<li>Strength of the first-stage</li>
<li>Inference on coefficient of interest in the structural equation</li>
</ol>
<div class="fragment">
<p>Applied researchers tend to (wrongly) think of these as separate issues.</p>
</div>
<hr>
</section>
<section id="testing-strength-of-instruments-1" class="level2">
<h2 class="anchored" data-anchor-id="testing-strength-of-instruments-1">Testing strength of instruments</h2>
<p><strong>Many endogenous variables</strong></p>
<ul>
<li><span class="citation" data-cites="stock2005">Stock and Yogo (<a href="#ref-stock2005" role="doc-biblioref">2005</a>)</span> test based on Cragg &amp; Donald statistic (homoskedasticity only)</li>
<li><span class="citation" data-cites="kleibergen2006">Kleibergen and Paap (<a href="#ref-kleibergen2006" role="doc-biblioref">2006</a>)</span> Wald statistic</li>
<li><span class="citation" data-cites="sanderson2016">Sanderson and Windmeijer (<a href="#ref-sanderson2016" role="doc-biblioref">2016</a>)</span> extension</li>
<li>Effective F-statistic from <span class="citation" data-cites="olea2013">Olea and Pflueger (<a href="#ref-olea2013" role="doc-biblioref">2013</a>)</span> (as approximation)</li>
</ul>
<hr>
</section>
<section id="testing-strength-of-instruments-2" class="level2">
<h2 class="anchored" data-anchor-id="testing-strength-of-instruments-2">Testing strength of instruments</h2>
<p><strong>Single endogenous variable</strong></p>
<ul>
<li>Partial <span class="math inline">\(R^{2}\)</span> (never see this)</li>
<li><span class="citation" data-cites="stock2005">Stock and Yogo (<a href="#ref-stock2005" role="doc-biblioref">2005</a>)</span> test based on first-stage F-stat (homoskedasticity only)
<ul>
<li>Critical values in tables, based on number of instruments</li>
<li>Rule-of-thumb of 10 with single instrument (higher with more instruments)</li>
<li><span class="citation" data-cites="lee2021">Lee et al. (<a href="#ref-lee2021" role="doc-biblioref">2021</a>)</span>: With first-stage F-stat of 10, standard “95% confidence interval” for second stage is really an 85% confidence interval</li>
</ul></li>
</ul>
<hr>
</section>
<section id="testing-strength-of-instruments-3" class="level2">
<h2 class="anchored" data-anchor-id="testing-strength-of-instruments-3">Testing strength of instruments</h2>
<p><strong>Single endogenous variable</strong></p>
<ul>
<li>Partial <span class="math inline">\(R^{2}\)</span> (never see this)</li>
<li><span class="citation" data-cites="stock2005">Stock and Yogo (<a href="#ref-stock2005" role="doc-biblioref">2005</a>)</span> test based on first-stage F-stat (homoskedasticity only)</li>
<li><span class="citation" data-cites="kleibergen2006">Kleibergen and Paap (<a href="#ref-kleibergen2006" role="doc-biblioref">2006</a>)</span> Wald statistic</li>
<li>Effective F-statistic from <span class="citation" data-cites="olea2013">Olea and Pflueger (<a href="#ref-olea2013" role="doc-biblioref">2013</a>)</span></li>
</ul>
<hr>
</section>
<section id="testing-strength-of-instruments-4" class="level2">
<h2 class="anchored" data-anchor-id="testing-strength-of-instruments-4">Testing strength of instruments</h2>
<p><strong>Single endogenous variable</strong></p>
<ul>
<li>Inference with Anderson-Rubin CIs (homoskedastic)</li>
<li>Inference with <span class="citation" data-cites="lee2021">Lee et al. (<a href="#ref-lee2021" role="doc-biblioref">2021</a>)</span> tables (allows for more general error structure)</li>
</ul>
<hr>
</section>
<section id="testing-strength-of-instruments-first-stage" class="level2">
<h2 class="anchored" data-anchor-id="testing-strength-of-instruments-first-stage">Testing strength of instruments: First-stage</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Single endogenous variable</strong></p>
<ol type="1">
<li>Homoskedasticity: Stock &amp; Yogo, effective F-stat</li>
<li>Heteroskedasticity: Effective F-stat</li>
</ol>
</div><div class="column" style="width:50%;">
<p><strong>Many endogenous variables</strong></p>
<ol type="1">
<li>Homoskedasticity: Stock &amp; Yogo with Cragg &amp; Donald statistic, <span class="citation" data-cites="sanderson2016">Sanderson and Windmeijer (<a href="#ref-sanderson2016" role="doc-biblioref">2016</a>)</span>, effective F-stat from <span class="citation" data-cites="olea2013">Olea and Pflueger (<a href="#ref-olea2013" role="doc-biblioref">2013</a>)</span></li>
<li>Heteroskedasticity: Kleibergen &amp; Papp (<span class="citation" data-cites="kleibergen2006">Kleibergen and Paap (<a href="#ref-kleibergen2006" role="doc-biblioref">2006</a>)</span>) Wald is robust analog of Cragg &amp; Donald statistic, effective F-stat from <span class="citation" data-cites="olea2013">Olea and Pflueger (<a href="#ref-olea2013" role="doc-biblioref">2013</a>)</span></li>
</ol>
</div>
</div>
<hr>
</section>
<section id="testing-strength-of-instruments-inference" class="level2">
<h2 class="anchored" data-anchor-id="testing-strength-of-instruments-inference">Testing strength of instruments: Inference</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><strong>Single endogenous variable</strong></p>
<ol type="1">
<li>Homoskedasticity: Anderson-Rubin CIs, Lee tF, likelihood ratio test from <span class="citation" data-cites="moreira2003">Moreira (<a href="#ref-moreira2003" role="doc-biblioref">2003</a>)</span></li>
<li>Heteroskedasticity: Lee tF, <span class="citation" data-cites="lee2021">Lee et al. (<a href="#ref-lee2021" role="doc-biblioref">2021</a>)</span></li>
</ol>
</div><div class="column" style="width:50%;">
<p><strong>Many endogenous variables</strong></p>
<ol type="1">
<li>Homoskedasticity: Projection-based confidence sets using the Anderson-Rubin CI (Dufour &amp; Taamouti, 2005) but low power</li>
<li>Heteroskedasticity: Go figure it out!</li>
</ol>
</div>
</div>
<hr>
</section>
<section id="making-sense-of-all-of-this" class="level2">
<h2 class="anchored" data-anchor-id="making-sense-of-all-of-this">Making sense of all of this…</h2>
<ol type="1">
<li>Test first-stage using effective F-stat</li>
<li>Present weak-instrument-robust inference using Anderson-Rubin CIs or Lee tF tests</li>
</ol>
<div class="fragment">
<p>Many endogenous variables problematic because strength of instruments for one variable need not imply strength of instruments for others</p>
</div>
</section>
</section>
<section id="interpreting-instrumental-variables-results" class="level1">
<h1>Interpreting Instrumental Variables Results</h1>
<hr>
<section id="heterogenous-tes" class="level2">
<h2 class="anchored" data-anchor-id="heterogenous-tes">Heterogenous TEs</h2>
<ul>
<li>In constant treatment effects, <span class="math inline">\(Y_{i}(1) - Y_{i}(0) = \delta_{i} = \delta, \text{ } \forall i\)</span></li>
<li>Heterogeneous effects, <span class="math inline">\(\delta_{i} \neq \delta\)</span></li>
<li>With IV, what parameter did we just estimate? Need <strong>monotonicity</strong> assumption to answer this</li>
</ul>
<hr>
</section>
<section id="monotonicity" class="level2">
<h2 class="anchored" data-anchor-id="monotonicity">Monotonicity</h2>
<p>Assumption: Denote the effect of our instrument on treatment by <span class="math inline">\(\pi_{1i}\)</span>. Monotonicity states that <span class="math inline">\(\pi_{1i} \geq 0\)</span> or <span class="math inline">\(\pi_{1i} \leq 0,  \text{ } \forall i\)</span>.</p>
<ul>
<li>Allows for <span class="math inline">\(\pi_{1i}=0\)</span> (no effect on treatment for some people)</li>
<li>All those affected by the instrument are affected in the same “direction”</li>
<li>With heterogeneous ATE and monotonicity assumption, IV provides a “Local Average Treatment Effect” (LATE)</li>
</ul>
<hr>
</section>
<section id="late-and-iv-interpretation" class="level2">
<h2 class="anchored" data-anchor-id="late-and-iv-interpretation">LATE and IV Interpretation</h2>
<ul>
<li>LATE is the effect of treatment among those affected by the instrument (compliers only).</li>
<li>Recall original Wald estimator:</li>
</ul>
<p><span class="math display">\[\delta_{IV} = \frac{E[Y_{i} | Z_{i}=1] - E[Y_{i} | Z_{i}=0]}{E[D_{i} | Z_{i}=1] - E[D_{i} | Z_{i}=0]}=E[Y_{i}(1) - Y_{i}(0) | \text{complier}]\]</span></p>
<ul>
<li>Practically, monotonicity assumes there are no defiers and restricts us to learning only about compliers</li>
</ul>
<hr>
</section>
<section id="is-late-meaningful" class="level2">
<h2 class="anchored" data-anchor-id="is-late-meaningful">Is LATE meaningful?</h2>
<ul>
<li>Learn about average treatment effect for compliers</li>
<li>Different estimates for different compliers
<ul>
<li>IV based on merit scholarships</li>
<li>IV based on financial aid</li>
<li>Same compliers? Probably not</li>
</ul></li>
</ul>
<hr>
</section>
<section id="late-with-defiers" class="level2">
<h2 class="anchored" data-anchor-id="late-with-defiers">LATE with defiers</h2>
<ul>
<li>In presence of defiers, IV estimates a weighted difference between effect on compliers and defiers (in general)</li>
<li>LATE can be restored if subgroup of compliers accounts for the same percentage as defiers and has same LATE</li>
<li>Offsetting behavior of compliers and defiers, so that remaining compliers dictate LATE</li>
</ul>
<hr>
</section>
<section id="marginal-treatment-effects" class="level2">
<h2 class="anchored" data-anchor-id="marginal-treatment-effects">Marginal Treatment Effects</h2>
<ul>
<li>Lots of different treatment effects…ATT, ATU, LATE</li>
<li>Would be nice to have full distribution, <span class="math inline">\(f(\delta-{i})\)</span>, from which we could derive ATE, ATT, LATE, etc.</li>
<li>Marginal treatment effect (MTE) is nonparametric function that links all of these together
<ul>
<li>Treatment effect, <span class="math inline">\(\delta_{i} = Y_{i}(1) - Y_{i}(0)\)</span></li>
<li>Treatment governed by index, <span class="math inline">\(D_{i} = \mathbb{1}(\gamma z_{i} \geq v_{i})\)</span>, with instruments <span class="math inline">\(z\)</span></li>
</ul></li>
</ul>
<p><span class="math display">\[\delta^{MTE} (x, v_{i}) = E[\delta_{i} | x_{i} = x, \gamma z_{i} = v_{i}]\]</span></p>
<hr>
</section>
<section id="marginal-treatment-effects-1" class="level2">
<h2 class="anchored" data-anchor-id="marginal-treatment-effects-1">Marginal Treatment Effects</h2>
<p><span class="math display">\[\delta^{MTE} (x, v_{i}) = E[\delta_{i} | x_{i} = x, \gamma z_{i}=v_{i}]\]</span></p>
<ul>
<li><span class="math inline">\(\gamma z_{i} = v_{i}\)</span> captures indifference between treatment and no treatment</li>
<li>Instead of number (like ATT or LATE), <span class="math inline">\(\delta^{MTE}(x,v)\)</span> is a function of <span class="math inline">\(v\)</span></li>
<li>Average effect of treatment for everyone with the same <span class="math inline">\(\gamma z_{i}\)</span></li>
</ul>
<hr>
</section>
<section id="marginal-treatment-effects-2" class="level2">
<h2 class="anchored" data-anchor-id="marginal-treatment-effects-2">Marginal Treatment Effects</h2>
<p>What is <span class="math inline">\(\gamma z_{i}\)</span>?</p>
<p>For any single index model: <span class="math display">\[D_{i} = \mathbb{1}(\gamma z_{i} \geq v_{i}) = \mathbb{1}(u_{is} \leq F(\gamma z_{i})) \text{ for } u_{is} \in [0,1]\]</span></p>
<ul>
<li><span class="math inline">\(F(\gamma z_{i})\)</span> is CDF of <span class="math inline">\(v{i}\)</span></li>
<li>Inverse CDF transform to translate into uniform distribution</li>
<li>Yields propensity score, <span class="math inline">\(P(z_{i}) = Pr(D_{i}=1 | z_{i}) = F(\gamma z_{i})\)</span> (ranking all units according to probability of treatment)</li>
</ul>
<hr>
</section>
<section id="marginal-treatment-effects-3" class="level2">
<h2 class="anchored" data-anchor-id="marginal-treatment-effects-3">Marginal Treatment Effects</h2>
<ul>
<li>MTE is LATE as change in <span class="math inline">\(z\)</span> approaches 0 (Heckman, 1997)</li>
<li>MTE is Local IV:</li>
</ul>
<p><span class="math display">\[\delta^{LIV} (x,p) = \frac{\partial E[Y | x, P(z)=p]}{\partial p}\]</span></p>
<ul>
<li>How does outcome <span class="math inline">\(Y_{i}\)</span> change as we push one more person into treatment</li>
</ul>
<hr>
</section>
<section id="derivation-3" class="level2">
<h2 class="anchored" data-anchor-id="derivation-3">Derivation</h2>
<p><span class="math display">\[\begin{eqnarray*}
Y(0) &amp;=&amp; \gamma_0 x + u_0\\
Y(1) &amp;=&amp; \gamma_1 x + u_1
\end{eqnarray*}\]</span></p>
<p><span class="math inline">\(P(D=1 | z) = P(z)\)</span> works as our instrument with two assumptions:</p>
<ol type="1">
<li><span class="math inline">\((u_0, u_1, u_s) \perp P(z) | x\)</span>. (Exogeneity)</li>
<li>Conditional on <span class="math inline">\(z\)</span> there is enough variation in <span class="math inline">\(z\)</span> for <span class="math inline">\(P(z)\)</span> to take on all values <span class="math inline">\(\in(0,1)\)</span>.
<ul>
<li>Much stronger than typical validity assumption, akin to special regressor in Lewbel’s work</li>
<li>Binary variable, <span class="math inline">\(D=\mathbb{1}(V+W^{*}\geq 0)\)</span>. “If <span class="math inline">\(V\)</span> is independent of <span class="math inline">\(W\)</span>, then variation in <span class="math inline">\(V\)</span> changes the probability of <span class="math inline">\(D=1\)</span> in such a way that traces out the distribution of <span class="math inline">\(W^{*}\)</span></li>
</ul></li>
</ol>
<hr>
</section>
<section id="derivation-4" class="level2">
<h2 class="anchored" data-anchor-id="derivation-4">Derivation</h2>
<ul>
<li><p>Now we can write, <span class="math display">\[\small \begin{eqnarray*}
Y &amp;=&amp; \gamma_0' x + D(\gamma_1 - \gamma_0)' x + u_0 + D(u_1 - u_0)\\
E[Y| x,P(z)=p] &amp;=&amp; \gamma_0' x + p(\gamma_1 - \gamma_0)'x + E[D(u_1 - u_0)|x,P(z)=p]
\end{eqnarray*}\]</span></p></li>
<li><p>Observe <span class="math inline">\(D=1\)</span> over the interval <span class="math inline">\(u_s = [0,p]\)</span> and zero for higher values of <span class="math inline">\(u_s\)</span>. Let <span class="math inline">\(u_1-u_0 \equiv \eta\)</span>. <span class="math display">\[\small \begin{eqnarray*}
E[D(u_1 - u_0) | P(z) =p,x] &amp;=&amp; \int_{-\infty}^{\infty} \int_{0}^{p} (u_1 - u_0) f((u_1-u_0) | u_s) d u_s d(u_1 -u_0)\\
E[D(\eta) | P(z) =p,x] &amp;=&amp; \int_{-\infty}^{\infty} \int_{0}^{p} \eta f(\eta | u_s)  d\, \eta d\, u_s\\
\end{eqnarray*}\]</span></p></li>
</ul>
<hr>
</section>
<section id="derivation-5" class="level2">
<h2 class="anchored" data-anchor-id="derivation-5">Derivation</h2>
<p>Recall: <span class="math display">\[\begin{align*}
E[Y| x,P(z)=p] &amp;= \gamma_0' X + p(\gamma_1 - \gamma_0)'X + E[D(u_1 - u_0)|x,P(z)=p]\\
\end{align*}\]</span></p>
<p>And the derivative: <span class="math display">\[\begin{align*}
\delta^{MTE}(p) = \frac{\partial E[Y | x, P(z)=p]}{\partial p} &amp;= (\gamma_1 - \gamma_0)'x + \int_{-\infty}^{\infty} \eta f(\eta | u_s =p) d\, \eta\\
&amp;= \underbrace{(\gamma_1 - \gamma_0)'x}_{ATE(x)}+ E[\eta | u_s =p]
\end{align*}\]</span></p>
<p>What is <span class="math inline">\(E[\eta | u_s =p]\)</span>? The expected unobserved gain from treatment of those people who are on the treatment/no-treatment margin <span class="math inline">\(P(z)=p\)</span>.</p>
<hr>
</section>
<section id="mte-to-ate" class="level2">
<h2 class="anchored" data-anchor-id="mte-to-ate">MTE to ATE</h2>
<p>Calculate the outcome given <span class="math inline">\((x,z)\)</span> (actually <span class="math inline">\(z\)</span> and <span class="math inline">\(P(z)=p\)</span>).</p>
<p><span class="math display">\[\begin{align*}
\delta^{ATE}(x, T=1)&amp;=E\left(\delta^{MTE} | X=x \right)\\
\end{align*}\]</span></p>
<p>ATE: We treat everyone. <span class="math display">\[\begin{eqnarray*}
\int_{-\infty}^{\infty} \delta^{MTE}(p) = (\gamma_1 - \gamma_0)'x + \underbrace{\int_{-\infty}^{\infty} E(\eta | u_s) d\, u_s}_{0}
\end{eqnarray*}\]</span></p>
<hr>
</section>
<section id="mte-to-att" class="level2">
<h2 class="anchored" data-anchor-id="mte-to-att">MTE to ATT</h2>
<p>Calculate the outcome given <span class="math inline">\((x,z)\)</span> (actually <span class="math inline">\(z\)</span> and <span class="math inline">\(P(z)=p\)</span>).</p>
<p><span class="math display">\[\begin{align*}
\delta^{ATT}(x, P(z), T=1)&amp;=E\left(\delta^{MTE} | X=x, u_{s} \leq P(z)\right)\\
\end{align*}\]</span></p>
<p>ATT: Treat only those with a large enough propensity score <span class="math inline">\(P(z)&gt;p\)</span>: <span class="math display">\[\begin{eqnarray*}
\int_{-\infty}^{\infty} \delta^{MTE}(p,x) \frac{Pr(P(z | x) &gt; p)}{E[P(z | x)]} d\,p
\end{eqnarray*}\]</span></p>
<hr>
</section>
<section id="mte-to-late" class="level2">
<h2 class="anchored" data-anchor-id="mte-to-late">MTE to LATE</h2>
<p>Calculate the outcome given <span class="math inline">\((x,z)\)</span> (actually <span class="math inline">\(z\)</span> and <span class="math inline">\(P(z)=p\)</span>).</p>
<p><span class="math display">\[\begin{align*}
\delta^{L A T E}\left(x, P(z), P\left(z^{\prime}\right)\right)&amp;=E\left(\delta^{MTE} | X=x, P\left(z^{\prime}\right) \leq u_s \leq P(z)\right)
\end{align*}\]</span></p>
<p>LATE: Integrate over the compliers: <span class="math display">\[\begin{eqnarray*}
LATE(x,z,z')= \frac{1}{P(z) - P(z')} \int_{P(z')}^{P(z)} \delta^{MTE}(p,x)
\end{eqnarray*}\]</span></p>
<hr>
</section>
<section id="mte-to-ols-and-iv" class="level2">
<h2 class="anchored" data-anchor-id="mte-to-ols-and-iv">MTE to OLS and IV</h2>
<p>This is harder… <span class="math display">\[\begin{align*}
w^{I V}\left(u_{s}\right)=\left[E\left(P(z) | P(z)&gt;u_{s}\right)-E(P(z))\right] \frac{E(P(z))}{\operatorname{Var}(P(z))}\\
w^{O L S}\left(u_{s}\right)=1+\frac{E\left(u_{1} | u_{s}\right) h_{1}-E\left(u_{0} | u_{s}\right) h_{0}}{\delta^{M T E}\left(u_{s}\right)}\\
h_{1}=\frac{E\left(P(z) | P(z)&gt;u_{s}\right)}{ E(P(z))}, \quad h_{0}=\frac{E\left(P(z) | P(z)&lt;u_{s}\right)}{E(P(z))}
\end{align*}\]</span></p>
<hr>
</section>
<section id="mte-in-practice" class="level2">
<h2 class="anchored" data-anchor-id="mte-in-practice">MTE in practice</h2>
<ol type="1">
<li>Estimate <span class="math inline">\(P(z)= Pr(D=1 | z)\)</span> nonparametrically (<span class="math inline">\(z\)</span> includes instruments and all exogenous <span class="math inline">\(x\)</span> variables)</li>
<li>Flexible/nonparametric regression of <span class="math inline">\(Y\)</span> on <span class="math inline">\(x\)</span> and <span class="math inline">\(P(z)\)</span></li>
<li>Differentiate w.r.t. <span class="math inline">\(P(z)\)</span></li>
<li>Plot for all values of <span class="math inline">\(P(z)=p\)</span></li>
</ol>
<p>As long as <span class="math inline">\(P(z)\)</span> covers <span class="math inline">\((0,1)\)</span>, we can trace out the full distribution of <span class="math inline">\(\delta^{MTE}(p)\)</span></p>
<hr>
</section>
<section id="example" class="level2">
<h2 class="anchored" data-anchor-id="example">Example</h2>
<p><a href="https://www.stern.nyu.edu/sites/default/files/assets/documents/GMSC_nofreelunch.pdf">Grennan et al (2021)</a></p>
<ul>
<li>Idea: what is the effect of detailing in prescription drugs (statins)</li>
<li>IV: Restrictions on detailing from conflict-of-interest policies imposed by large Academic Medical Centers…spillover to other hospitals</li>
<li>Estimate MTE and examine welfare effects in structural framework</li>
</ul>
</section>
</section>
<section id="common-iv-designs-today" class="level1">
<h1>Common IV Designs Today</h1>
<hr>
<section id="judge-fixed-effects" class="level2">
<h2 class="anchored" data-anchor-id="judge-fixed-effects">Judge Fixed Effects</h2>
<ul>
<li>Many different possible decision makers</li>
<li>Individuals randomly assigned to one decision maker</li>
<li>Decision makers differ in leniency of assigning treatment</li>
<li>Common in crime studies due to random assignment of judges to defendants</li>
</ul>
<hr>
</section>
<section id="judge-fixed-effects-1" class="level2">
<h2 class="anchored" data-anchor-id="judge-fixed-effects-1">Judge Fixed Effects</h2>
<p><span class="citation" data-cites="aizer2015">Aizer and Doyle (<a href="#ref-aizer2015" role="doc-biblioref">2015</a>)</span>, QJE, “Juvenile Incarceration, Human Capital, and Future Crime: Evidence from Randomly Assigned Judges”</p>
<ul>
<li>Proposed instrument: propensity to convict by the judge</li>
<li>Idea: judge has some fixed leniency, and random assignment into judges introduces exogenous variation in probability of conviction</li>
<li>In practice: judge assignment isn’t truly random, but it <strong>is</strong> plausibly exogenous</li>
</ul>
<hr>
</section>
<section id="judge-fixed-effects-2" class="level2">
<h2 class="anchored" data-anchor-id="judge-fixed-effects-2">Judge Fixed Effects</h2>
<p>Constructing the instrument:</p>
<ul>
<li>Leave-one-out mean <span class="math display">\[z_{j} = \frac{1}{n_{j} - 1} \sum_{k \neq i}^{n_{j}-1} JI_{k}\]</span></li>
<li>This is the mean of incarceration rates for judge <span class="math inline">\(j\)</span> when excluding the current defendant, <span class="math inline">\(i\)</span></li>
<li>Could also residualize <span class="math inline">\(JI_{k}\)</span> (remove effects due to day of week, month, etc.)</li>
</ul>
<hr>
</section>
<section id="judge-fixed-effects-3" class="level2">
<h2 class="anchored" data-anchor-id="judge-fixed-effects-3">Judge Fixed Effects</h2>
<ul>
<li>Common design: possible in settings where some influential decision-makers exercise discretion and where individuals can’t control the match</li>
<li>Practical issue: Use jackknife IV (JIVE) to “fix” small-sample bias
<ul>
<li>JIVE more general than judge fixed effects design</li>
<li>Idea: estimate first-stage without observation <span class="math inline">\(i\)</span>, use coefficients for predicted endogeneous variable for observation <span class="math inline">\(i\)</span>, repeat</li>
<li>May improve finite-sample bias but also loses efficiency</li>
</ul></li>
<li>Biggest threat: monotonicity…judges may be more/less lenient in different situations or for different defendants</li>
</ul>
<hr>
</section>
<section id="bartik-shift-share-instruments" class="level2">
<h2 class="anchored" data-anchor-id="bartik-shift-share-instruments">Bartik (shift-share) Instruments</h2>
<ul>
<li>Named after Timothy Bartik, traced back to Perlof (1957)</li>
<li>Original idea: Estimate effect of employment growth rates on labor-market outcomes
<ul>
<li>Clear simultaneity problem</li>
<li>Seek IV to shift labor demand</li>
</ul></li>
</ul>
<hr>
</section>
<section id="bartik-instruments" class="level2">
<h2 class="anchored" data-anchor-id="bartik-instruments">Bartik Instruments</h2>
<p>Decompose observed growth rate into:</p>
<ol type="1">
<li>“Share” (what extra growth would have occurred if each industry in an area grew at their industry national average)</li>
<li>“Shift” (extra growth due to differential growth locally versus nationally)</li>
</ol>
<hr>
</section>
<section id="bartik-instruments-1" class="level2">
<h2 class="anchored" data-anchor-id="bartik-instruments-1">Bartik Instruments</h2>
<ul>
<li>Want to estimate <span class="math display">\[y_{l} = \alpha + \delta I_{l} + \beta w_{l} + \varepsilon_{l}\]</span> for location <span class="math inline">\(l\)</span> (possibly time <span class="math inline">\(t\)</span> as well)</li>
<li><span class="math inline">\(I_{l}\)</span> reflect immigration flows</li>
<li><span class="math inline">\(w_{l}\)</span> captures other observables and region/time fixed effects</li>
</ul>
<hr>
</section>
<section id="bartik-instruments-2" class="level2">
<h2 class="anchored" data-anchor-id="bartik-instruments-2">Bartik Instruments</h2>
<p>Instrument:</p>
<p><span class="math display">\[B_{l} = \sum_{k=1}^{K} z_{l,k} \Delta_{k},\]</span></p>
<ul>
<li><span class="math inline">\(l\)</span> denotes market location (e.g., Atlanta), country, etc. (wherever flows are coming <em>into</em>)</li>
<li><span class="math inline">\(k\)</span> reflects the source country (where flows are coming out)</li>
<li><span class="math inline">\(z_{lk}\)</span> denotes the <strong>share</strong> of immigrants from source <span class="math inline">\(k\)</span> in location <span class="math inline">\(l\)</span> (in a base period)</li>
<li><span class="math inline">\(\Delta_{k}\)</span> denotes the <strong>shift</strong> (i.e., change) from source country into the destination country as a whole (e.g., immigration into the U.S.)</li>
</ul>
<hr>
</section>
<section id="other-examples" class="level2">
<h2 class="anchored" data-anchor-id="other-examples">Other Examples</h2>
<p><span class="math display">\[\begin{align}
B_{l} &amp;= \sum_{k=1}^{K} z_{lk} \Delta_{k},\\
\Delta_{lk} &amp;= \Delta_{k} + \tilde{\Delta_{lk}}
\end{align}\]</span></p>
<p>China shock <span class="citation" data-cites="autor2013">Autor, Dorn, and Hanson (<a href="#ref-autor2013" role="doc-biblioref">2013</a>)</span>:</p>
<ul>
<li><span class="math inline">\(z_{lk}\)</span>: location, <span class="math inline">\(l\)</span>, and industry, <span class="math inline">\(k\)</span>, composition</li>
<li><span class="math inline">\(\Delta_{lk}\)</span>: location, <span class="math inline">\(l\)</span>, and industry, <span class="math inline">\(k\)</span>, growth in imports from China</li>
<li><span class="math inline">\(\Delta_{k}\)</span>: industry <span class="math inline">\(k\)</span> growth of imports from China</li>
</ul>
<hr>
</section>
<section id="other-examples-1" class="level2">
<h2 class="anchored" data-anchor-id="other-examples-1">Other Examples</h2>
<p><span class="math display">\[\begin{align}
B_{l} &amp;= \sum_{k=1}^{K} z_{lk} \Delta_{k},\\
\Delta_{lk} &amp;= \Delta_{k} + \tilde{\Delta_{lk}}
\end{align}\]</span></p>
<p>Immigrant enclave (Altonji and Card, 1991):</p>
<ul>
<li><span class="math inline">\(z_{lk}\)</span>: share of people from foreign country <span class="math inline">\(k\)</span> living in current location <span class="math inline">\(l\)</span> (in base period)</li>
<li><span class="math inline">\(\Delta_{lk}\)</span>: growth in the number of people from <span class="math inline">\(k\)</span> to <span class="math inline">\(l\)</span></li>
<li><span class="math inline">\(\Delta_{k}\)</span>: growth in people from <span class="math inline">\(k\)</span> nationally</li>
</ul>
<hr>
</section>
<section id="other-examples-2" class="level2">
<h2 class="anchored" data-anchor-id="other-examples-2">Other Examples</h2>
<p><span class="math display">\[\begin{align}
B_{l} &amp;= \sum_{k=1}^{K} z_{lk} \Delta_{k},\\
\Delta_{lk} &amp;= \Delta_{k} + \tilde{\Delta_{lk}}
\end{align}\]</span></p>
<p>Market size and demography (Acemoglu and Linn, 2004):</p>
<ul>
<li><span class="math inline">\(z_{lk}\)</span>: spending share on drug <span class="math inline">\(l\)</span> from age group <span class="math inline">\(k\)</span></li>
<li><span class="math inline">\(\Delta_{lk}\)</span>: growth in spending of group <span class="math inline">\(k\)</span> on drug <span class="math inline">\(l\)</span></li>
<li><span class="math inline">\(\Delta_{k}\)</span>: national growth in spending of group <span class="math inline">\(k\)</span> (e.g., due to population aging)</li>
</ul>
<hr>
</section>
<section id="bartik-instruments-3" class="level2">
<h2 class="anchored" data-anchor-id="bartik-instruments-3">Bartik Instruments</h2>
<ul>
<li><span class="citation" data-cites="goldsmith-pinkham2020">Goldsmith-Pinkham, Sorkin, and Swift (<a href="#ref-goldsmith-pinkham2020" role="doc-biblioref">2020</a>)</span> show that using <span class="math inline">\(B_{l}\)</span> as an instrument is equivalent to using local industry shares, <span class="math inline">\(z_{lk}\)</span>, as IVs</li>
<li>Can decompose Bartik-style IV estimates into weighted combination of estimates where each share is an instrument (Rotemberg weights)</li>
<li><span class="citation" data-cites="borusyak2021restud">Borusyak, Hull, and Jaravel (<a href="#ref-borusyak2021restud" role="doc-biblioref">2021</a>)</span>, ReStud, instead focus on situation in which the shifts are exogenous and the shares are potentially endogenous</li>
<li><span class="citation" data-cites="borusyak2023">Borusyak and Hull (<a href="#ref-borusyak2023" role="doc-biblioref">2023</a>)</span>, Econometrica, provide general approach when using exogenous shifts (recentering as in empirical exercise)</li>
</ul>
<p><strong>key:</strong> literature was vague as to the underlying source of variation in the instrument…recent papers help in understanding this (and thus defending your strategy)</p>
<hr>
</section>
<section id="shift-share-focusing-on-the-shift" class="level2">
<h2 class="anchored" data-anchor-id="shift-share-focusing-on-the-shift">Shift-Share (focusing on the shift)</h2>
<ul>
<li>Did ACA medicaid expansion affect insurance status?</li>
<li>Construct “simulated” IV (dummy for whether person <span class="math inline">\(i\)</span> is newly eligible given state expansion)</li>
<li>Instrument can be thought of as, <span class="math inline">\(z_{is} = f(x_{i}, e_{s})\)</span></li>
<li>Want to separate variation due to <span class="math inline">\(e_{s}\)</span> (the state policy changes) from variation in demographics, <span class="math inline">\(x_{i}\)</span>
<ul>
<li>Identify <span class="math inline">\(p(x)\)</span>, probability of eligibility on average across other states’ laws</li>
<li>Recenter, <span class="math inline">\(\tilde{z}_{is} = z_{is} - p(x)\)</span>. Can also just control for <span class="math inline">\(p(x)\)</span> in regression.</li>
</ul></li>
</ul>
</section>
<section id="references" class="level2">




</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-aizer2015" class="csl-entry" role="listitem">
Aizer, Anna, and Joseph J. Doyle Jr. 2015. <span>“Juvenile <span>Incarceration</span>, <span>Human</span> <span>Capital</span>, and <span>Future</span> <span>Crime</span>: <span>Evidence</span> from <span>Randomly</span> <span>Assigned</span> <span>Judges</span> *.”</span> <em>The Quarterly Journal of Economics</em> 130 (2): 759–803. <a href="https://doi.org/10.1093/qje/qjv003">https://doi.org/10.1093/qje/qjv003</a>.
</div>
<div id="ref-autor2013" class="csl-entry" role="listitem">
Autor, David H., David Dorn, and Gordon H. Hanson. 2013. <span>“The <span>China</span> <span>Syndrome</span>: <span>Local</span> <span>Labor</span> <span>Market</span> <span>Effects</span> of <span>Import</span> <span>Competition</span> in the <span>United</span> <span>States</span>.”</span> <em>American Economic Review</em> 103 (6): 2121–68. <a href="https://doi.org/10.1257/aer.103.6.2121">https://doi.org/10.1257/aer.103.6.2121</a>.
</div>
<div id="ref-beckert2020" class="csl-entry" role="listitem">
Beckert, Walter. 2020. <span>“A Note on Specification Testing in Some Structural Regression Models.”</span> <em>Oxford Bulletin of Economics and Statistics</em> 82 (3): 686–95.
</div>
<div id="ref-borusyak2023" class="csl-entry" role="listitem">
Borusyak, Kirill, and Peter Hull. 2023. <span>“Nonrandom <span>Exposure</span> to <span>Exogenous</span> <span>Shocks</span>.”</span> <em>Econometrica</em> 91 (6): 2155–85. <a href="https://doi.org/10.3982/ECTA19367">https://doi.org/10.3982/ECTA19367</a>.
</div>
<div id="ref-borusyak2021restud" class="csl-entry" role="listitem">
Borusyak, Kirill, Peter Hull, and Xavier Jaravel. 2021. <span>“Quasi-<span>Experimental</span> <span>Shift</span>-<span>Share</span> <span>Research</span> <span>Designs</span>.”</span> <em>Review of Economic Studies</em>.
</div>
<div id="ref-conley2012" class="csl-entry" role="listitem">
Conley, Timothy G, Christian B Hansen, and Peter E Rossi. 2012. <span>“Plausibly Exogenous.”</span> <em>Review of Economics and Statistics</em> 94 (1): 260–72.
</div>
<div id="ref-goldsmith-pinkham2020" class="csl-entry" role="listitem">
Goldsmith-Pinkham, Paul, Isaac Sorkin, and Henry Swift. 2020. <span>“Bartik <span>Instruments</span>: <span>What</span>, <span>When</span>, <span>Why</span>, and <span>How</span>.”</span> <em>American Economic Review</em> 110 (8): 2586–2624. <a href="https://doi.org/10.1257/aer.20181047">https://doi.org/10.1257/aer.20181047</a>.
</div>
<div id="ref-vankippersluis2018" class="csl-entry" role="listitem">
Kippersluis, Hans van, and Cornelius A Rietveld. 2018. <span>“Beyond Plausibly Exogenous.”</span> <em>The Econometrics Journal</em> 21 (3): 316–31.
</div>
<div id="ref-kleibergen2006" class="csl-entry" role="listitem">
Kleibergen, Frank, and Richard Paap. 2006. <span>“Generalized Reduced Rank Tests Using the Singular Value Decomposition.”</span> <em>Journal of Econometrics</em> 133 (1): 97–126.
</div>
<div id="ref-lee2021" class="csl-entry" role="listitem">
Lee, David S., Justin McCrary, Marcelo J. Moreira, and Jack R. Porter. 2021. <span>“Valid t-Ratio <span>Inference</span> for <span>IV</span>.”</span> Working {Paper}. Working <span>Paper</span> <span>Series</span>. National Bureau of Economic Research. <a href="https://doi.org/10.3386/w29124">https://doi.org/10.3386/w29124</a>.
</div>
<div id="ref-moreira2003" class="csl-entry" role="listitem">
Moreira, Marcelo J. 2003. <span>“A <span>Conditional</span> <span>Likelihood</span> <span>Ratio</span> <span>Test</span> for <span>Structural</span> <span>Models</span>.”</span> <em>Econometrica</em> 71 (4): 1027–48. <a href="https://doi.org/10.1111/1468-0262.00438">https://doi.org/10.1111/1468-0262.00438</a>.
</div>
<div id="ref-nevo2012" class="csl-entry" role="listitem">
Nevo, Aviv, and Adam M Rosen. 2012. <span>“Identification with Imperfect Instruments.”</span> <em>Review of Economics and Statistics</em> 94 (3): 659–71.
</div>
<div id="ref-olea2013" class="csl-entry" role="listitem">
Olea, José Luis Montiel, and Carolin Pflueger. 2013. <span>“A Robust Test for Weak Instruments.”</span> <em>Journal of Business &amp; Economic Statistics</em> 31 (3): 358–69.
</div>
<div id="ref-oster2019" class="csl-entry" role="listitem">
Oster, Emily. 2019. <span>“Unobservable <span>Selection</span> and <span>Coefficient</span> <span>Stability</span>: <span>Theory</span> and <span>Evidence</span>.”</span> <em>Journal of Business &amp; Economic Statistics</em> 37 (2): 187–204. <a href="https://doi.org/10.1080/07350015.2016.1227711">https://doi.org/10.1080/07350015.2016.1227711</a>.
</div>
<div id="ref-sanderson2016" class="csl-entry" role="listitem">
Sanderson, Eleanor, and Frank Windmeijer. 2016. <span>“A Weak Instrument <span>F</span>-Test in Linear <span>IV</span> Models with Multiple Endogenous Variables.”</span> <em>Journal of Econometrics</em> 190 (2): 212–21.
</div>
<div id="ref-stock2005" class="csl-entry" role="listitem">
Stock, James H, and Motohiro Yogo. 2005. <span>“Testing for <span>Weak</span> <span>Instruments</span> in <span>Linear</span> <span>IV</span> <span>Regression</span>.”</span> In <em>Identification and <span>Inference</span> for <span>Econometric</span> <span>Models</span>: <span>Essays</span> in <span>Honor</span> of <span>Thomas</span> <span>Rothenberg</span></em>. Cambridge University Press.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/econ771s24\.classes\.ianmccarthyecon\.com\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Content <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> 2024 by Ian McCarthy<br> All content licensed under a <i class="fa-brands fa-creative-commons" aria-label="creative-commons"></i> <i class="fa-brands fa-creative-commons-by" aria-label="creative-commons-by"></i> <i class="fa-brands fa-creative-commons-nc" aria-label="creative-commons-nc"></i> <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International license (CC BY-NC 4.0)</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Made with <i class="fa-brands fa-r-project" aria-label="r-project"></i> and <a href="https://quarto.org/">Quarto</a><br> <a href="https://github.com/imccart/econ771-spring2024">View the source at <i class="fa-brands fa-github" aria-label="github"></i> GitHub</a></p>
</div>
  </div>
</footer>




</body></html>